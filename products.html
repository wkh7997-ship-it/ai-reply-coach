<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI í”¼ë¶€ ì½”ì¹˜ - ì¶”ì²œ ì œí’ˆ</title>
  <style>
    :root {
      --primary: #9b8bff;
      --primary-strong: #5c6bff;
      --bg-deep: #050616;
      --bg-top: #11152b;
      --glass: rgba(10, 14, 32, 0.96);
      --text-main: #f9fafb;
      --text-sub: #cbd5f5;
      --border-soft: rgba(148, 163, 255, 0.35);
      --risk-low: #22c55e;
      --risk-mid: #eab308;
      --risk-high: #ef4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(88,101,242,0.32) 0, transparent 55%),
        radial-gradient(circle at bottom, rgba(59,130,246,0.26) 0, transparent 62%),
        linear-gradient(160deg, var(--bg-top), var(--bg-deep));
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px 14px;
    }

    .shell { width: 100%; max-width: 440px; }

    .card {
      background: var(--glass);
      border-radius: 26px;
      padding: 18px 16px 14px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 22px 50px rgba(0,0,0,0.9),
        0 0 0 1px rgba(15,23,42,0.7);
      backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
      max-height: calc(100vh - 32px);
      display: flex;
      flex-direction: column;
    }

    .card-inner-scroll {
      overflow-y: auto;
      padding-right: 2px;
      margin-right: -4px;
      flex: 1;
    }

    .top-accent {
      position: absolute;
      left: 14%; right: 14%; top: 10px;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(148,163,255,0.9), transparent);
      opacity: 0.95;
    }

    .header-wrap {
      margin-top: 12px;
      margin-bottom: 10px;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 10px;
    }

    .header-title {
      font-size: 1.3rem;
      font-weight: 750;
      line-height: 1.1;
    }

    .header-sub {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-top: 4px;
      line-height: 1.4;
    }

    .header-date {
      font-size: 0.72rem;
      color: rgba(203,213,255,0.9);
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,0.6);
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .badge {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,0.6);
      color: #e5e7eb;
      background: rgba(15,23,42,0.9);
    }

    .badge-risk-low {
      border-color: var(--risk-low);
      color: #bbf7d0;
      background: rgba(22,163,74,0.18);
    }

    .badge-risk-mid {
      border-color: var(--risk-mid);
      color: #fef9c3;
      background: rgba(202,138,4,0.18);
    }

    .badge-risk-high {
      border-color: var(--risk-high);
      color: #fee2e2;
      background: rgba(239,68,68,0.2);
    }

    .section {
      background: rgba(11,17,38,0.96);
      border-radius: 18px;
      padding: 11px 13px 9px;
      border: 1px solid rgba(148,163,255,0.3);
      margin-bottom: 10px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .section-title {
      font-size: 0.82rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #9ca3ff;
    }

    .section-tag {
      font-size: 0.72rem;
      color: rgba(209,213,255,0.9);
    }

    .section-body {
      font-size: 0.88rem;
      color: var(--text-sub);
      line-height: 1.6;
      margin-top: 3px;
    }

    .product-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .product-item {
      border-radius: 14px;
      padding: 8px 9px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,255,0.35);
    }

    .product-name {
      font-size: 0.9rem;
      font-weight: 650;
      margin-bottom: 2px;
      color: #e5e7ff;
    }

    .product-tags {
      font-size: 0.75rem;
      color: rgba(191,219,254,0.9);
      margin-bottom: 3px;
    }

    .product-desc {
      font-size: 0.8rem;
      color: var(--text-sub);
      line-height: 1.5;
    }

    .issues-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 5px;
    }

    .issue-pill {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(30,64,175,0.85);
      border: 1px solid rgba(191,219,254,0.7);
      color: #e0f2fe;
    }

    .footer-note {
      font-size: 0.74rem;
      color: rgba(148,163,255,0.9);
      text-align: center;
      margin-top: 4px;
      margin-bottom: 2px;
    }

    .btn-wrap {
      margin-top: 8px;
      padding-top: 6px;
      border-top: 1px solid rgba(15,23,42,0.9);
    }

    .action-btn {
      width: 100%;
      padding: 13px 14px;
      margin-top: 9px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,255,0.45);
      background:
        radial-gradient(circle at top left, rgba(148,163,255,0.18), transparent 60%),
        rgba(12,16,40,0.95);
      color: #e5e7ff;
      font-size: 0.95rem;
      font-weight: 620;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
      cursor: pointer;
      box-shadow:
        0 6px 18px rgba(0,0,0,0.45),
        0 0 0 1px rgba(15,23,42,0.8);
      transition: all 0.18s ease-out;
    }

    .action-btn:hover {
      background:
        radial-gradient(circle at top left, rgba(191,219,254,0.22), transparent 60%),
        rgba(16,22,54,0.98);
      transform: translateY(-2px);
      box-shadow:
        0 10px 26px rgba(0,0,0,0.55),
        0 0 0 1px rgba(129,140,248,0.9);
    }

    .action-icon {
      font-size: 1.25rem;
      opacity: 0.92;
    }

    .empty-text {
      font-size: 0.86rem;
      color: var(--text-sub);
      text-align: center;
      margin-top: 16px;
      line-height: 1.5;
    }
  </style>
</head>

<body>
<div class="shell">
  <div class="card">
    <div class="top-accent"></div>

    <div class="header-wrap">
      <div>
        <div class="header-title">ì¶”ì²œ ì œí’ˆ ê°€ì´ë“œ</div>
        <div class="header-sub" id="header-sub">
          ê°€ì¥ ìµœê·¼ AI ì§„ë‹¨ ê²°ê³¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ<br />
          ì¹´í…Œê³ ë¦¬ë³„ ì œí’ˆ íƒ€ì…ì„ ì¶”ì²œí•´ ë“œë ¤ìš”.
        </div>
        <div class="badge-row">
          <span id="badge-score" class="badge">ì ìˆ˜: -</span>
          <span id="badge-skin" class="badge">í”¼ë¶€íƒ€ì…: -</span>
          <span id="badge-risk" class="badge">ìœ„í—˜ë„: -</span>
        </div>
      </div>
      <div class="header-date" id="header-date">-</div>
    </div>

    <div class="card-inner-scroll" id="content-area">
      <!-- ì§„ë‹¨ ì—†ì„ ë•Œ ì•ˆë‚´ -->
      <div id="empty-state" class="empty-text" style="display:none;">
        ì•„ì§ ì €ì¥ëœ ì§„ë‹¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br />
        ë¨¼ì € AI í”¼ë¶€ ì§„ë‹¨ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.
      </div>

      <!-- ì¶”ì²œ ì„¹ì…˜ -->
      <div id="products-wrapper" style="display:none;">
        <!-- ì•„ì¹¨ ë£¨í‹´ -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">ì•„ì¹¨ ë£¨í‹´ ì¶”ì²œ</div>
            <div class="section-tag">Morning routine</div>
          </div>
          <div class="section-body">
            <div class="product-list" id="morning-list"></div>
          </div>
        </div>

        <!-- ì €ë… ë£¨í‹´ -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">ì €ë… ë£¨í‹´ ì¶”ì²œ</div>
            <div class="section-tag">Night routine</div>
          </div>
          <div class="section-body">
            <div class="product-list" id="night-list"></div>
          </div>
        </div>

        <!-- ê³ ë¯¼ ë¶€ìœ„ ì¤‘ì‹¬ ì¼€ì–´ -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">ê³ ë¯¼ ë¶€ìœ„ ì§‘ì¤‘ ì¼€ì–´</div>
            <div class="section-tag">Target care</div>
          </div>
          <div class="section-body">
            <div id="issues-helper-text">
              ì•„ë˜ ê³ ë¯¼ í‚¤ì›Œë“œì— ë§ì¶° ì œí’ˆ ì„¤ëª…ì„œë¥¼ ë¹„êµí•´ ë³´ì„¸ìš”.
            </div>
            <div class="issues-pills" id="issues-pills"></div>
          </div>
        </div>

        <div class="footer-note">
          * íŠ¹ì • ë¸Œëœë“œê°€ ì•„ë‹Œ, ì„±ë¶„Â·íƒ€ì… ê¸°ì¤€ì˜ ê°€ì´ë“œì…ë‹ˆë‹¤.<br />
          * í”¼ë¶€ê³¼ ì „ë¬¸ì˜ ìƒë‹´ì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ë³‘ì›ì„ ë¨¼ì € ì´ìš©í•´ ì£¼ì„¸ìš”.
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
    <div class="btn-wrap">
      <button class="action-btn" onclick="goResult()">
        <span class="action-icon">ğŸ“Š</span>
        <span>ì˜¤ëŠ˜ì˜ í”¼ë¶€ ë¦¬í¬íŠ¸ë¡œ ëŒì•„ê°€ê¸°</span>
      </button>

      <button class="action-btn" onclick="goChat()">
        <span class="action-icon">ğŸ’¬</span>
        <span>AI í”¼ë¶€ ìƒë‹´ ì±—ë´‡ìœ¼ë¡œ ì´ë™</span>
      </button>

      <button class="action-btn" onclick="goHome()">
        <span class="action-icon">ğŸ </span>
        <span>ì²« í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
      </button>
    </div>
  </div>
</div>

<script>
  function normalizeSkinType(skinType) {
    if (!skinType) return "ë³µí•©ì„±";
    if (skinType.includes("ê±´ì„±")) return "ê±´ì„±";
    if (skinType.includes("ì§€ì„±")) return "ì§€ì„±";
    if (skinType.includes("ë³µí•©")) return "ë³µí•©ì„±";
    if (skinType.includes("ë¯¼ê°")) return "ë¯¼ê°ì„±";
    return skinType;
  }

  function mapRiskBadge(riskLevel) {
    if (riskLevel === "low") {
      return { label: "ìœ„í—˜ë„ ë‚®ìŒ", className: "badge badge-risk-low" };
    }
    if (riskLevel === "high") {
      return { label: "ìœ„í—˜ë„ ë†’ìŒ", className: "badge badge-risk-high" };
    }
    return { label: "ìœ„í—˜ë„ ë³´í†µ", className: "badge badge-risk-mid" };
  }

  function setTodayLabel(dateStrFromHistory) {
    const el = document.getElementById("header-date");
    if (dateStrFromHistory) {
      el.innerText = dateStrFromHistory.replace(/-/g, ".");
      return;
    }
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, "0");
    const d = String(now.getDate()).padStart(2, "0");
    el.innerText = `${y}.${m}.${d}`;
  }

  function buildRecommendations(latest) {
    const skinType = normalizeSkinType(latest.skinType);
    const issues = Array.isArray(latest.issues) ? latest.issues : [];
    const riskLevel = latest.riskLevel || "mid";

    const morning = [];
    const night = [];

    // ê³µí†µ í´ë Œì €
    if (skinType === "ê±´ì„±" || skinType === "ë¯¼ê°ì„±") {
      morning.push({
        name: "ì €ìê·¹ ìˆ˜ë¶„ í´ë Œì €",
        tags: "ì•½ì‚°ì„± Â· ê³„ë©´í™œì„±ì œ ìˆœí•¨",
        desc: "ì•„ì¹¨ì—ëŠ” ìœ ë¶„ê³¼ ë…¸íì§€ë§Œ ê°€ë³ê²Œ ì œê±°í•  ìˆ˜ ìˆëŠ” ì ¤Â·í¼ íƒ€ì… ì•½ì‚°ì„± í´ë Œì €ë¥¼ ì¶”ì²œí•´ìš”. ì„¸ì•ˆ í›„ ì–¼êµ´ì´ ë‹¹ê¸°ì§€ ì•ŠëŠ” ì œí’ˆì´ ì¢‹ì•„ìš”."
      });
      night.push({
        name: "2ë‹¨ê³„ í´ë Œì§• (ì˜¤ì¼/ë°¤ â†’ í¼)",
        tags: "ë©”ì´í¬ì—…/ì„ í¬ë¦¼ ì œê±°ìš©",
        desc: "ìƒ‰ì¡° ë©”ì´í¬ì—…ì´ë‚˜ ì›Œí„°í”„ë£¨í”„ ì„ í¬ë¦¼ì„ ì‚¬ìš©í–ˆë‹¤ë©´ 1ì°¨ë¡œ ì˜¤ì¼/ë°¤ìœ¼ë¡œ ë…¹ì´ê³ , 2ì°¨ë¡œ ë¶€ë“œëŸ¬ìš´ ì•½ì‚°ì„± í¼ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•´ ì£¼ì„¸ìš”."
      });
    } else if (skinType === "ì§€ì„±" || skinType === "ë³µí•©ì„±") {
      morning.push({
        name: "í”¼ì§€ ì¡°ì ˆ ì•½ì‚°ì„± í´ë Œì €",
        tags: "ëª¨ê³µ Â· ìœ ë¶„ ì¼€ì–´",
        desc: "Tì¡´ ë²ˆë“¤ê±°ë¦¼ì´ ì‹ ê²½ ì“°ì¸ë‹¤ë©´, ê³¼í•˜ê²Œ ë½€ë“í•œ ëŠë‚Œë³´ë‹¤ëŠ” ì•½ì‚°ì„±ì¸ë°ë„ ë¯¸ì„¸ ê±°í’ˆì´ ì˜ ë‚˜ëŠ” íƒ€ì…ì„ ì„ íƒí•´ ì£¼ì„¸ìš”."
      });
      night.push({
        name: "ëª¨ê³µÂ·í”¼ì§€ ì§‘ì¤‘ í´ë Œì €(ì €ë… í•œ ë²ˆë§Œ)",
        tags: "ê³¼ë„í•œ ì‚¬ìš©ì€ ê¸ˆì§€",
        desc: "BHA/ì‚´ë¦¬ì‹¤ì‚° ì„±ë¶„ì´ ì†ŒëŸ‰ ë“¤ì–´ê°„ í´ë Œì €ë¥¼ ì €ë…ì—ë§Œ ì‚¬ìš©í•˜ë©´ ëª¨ê³µ ì£¼ë³€ í”¼ì§€ ì •ë¦¬ì— ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”."
      });
    } else {
      morning.push({
        name: "ìˆœí•œ ì ¤ íƒ€ì… í´ë Œì €",
        tags: "ëª¨ë“  í”¼ë¶€ ê³µí†µ",
        desc: "ìê·¹ê°ì´ ì ê³ , ì„¸ì•ˆ í›„ ë¯¸ì„¸í•˜ê²Œ ì´‰ì´‰í•¨ì´ ë‚¨ëŠ” ì œí˜• ìœ„ì£¼ë¡œ ê³¨ë¼ ì£¼ì„¸ìš”."
      });
      night.push({
        name: "ì„ í¬ë¦¼ê¹Œì§€ ì œê±° ê°€ëŠ¥í•œ í¼ í´ë Œì €",
        tags: "ê¸°ë³¸ ì„¸ì•ˆ",
        desc: "ì„ í¬ë¦¼ì„ ë§¤ì¼ ë°”ë¥¸ë‹¤ë©´, ë¯¸ì˜¨ìˆ˜ + ì¶©ë¶„í•œ ê±°í’ˆìœ¼ë¡œ 30ì´ˆ ì´ë‚´ë¡œ ë§ˆë¬´ë¦¬í•´ ì£¼ì„¸ìš”."
      });
    }

    // í† ë„ˆ / ë¯¸ìŠ¤íŠ¸
    if (riskLevel === "high" || issues.includes("í™ì¡°") || issues.includes("ìê·¹")) {
      morning.push({
        name: "ìˆ˜ë¶„Â·ì§„ì • í† ë„ˆ (ë¬´ì•Œì½”ì˜¬)",
        tags: "ì‹œì¹´ Â· íŒí…Œë†€ Â· ì›Œí„° íƒ€ì…",
        desc: "ì†œì— ë“¬ë¿ ì ì…” ê°•í•˜ê²Œ ë¬¸ì§€ë¥´ì§€ ë§ê³ , ì†ìœ¼ë¡œ ë‘ë“œë¦¬ë“¯ ì—¬ëŸ¬ ë²ˆ ê²¹ì³ ë°”ë¥´ê±°ë‚˜, ì§„ì • íŒ¨ë“œì²˜ëŸ¼ 3ë¶„ ì •ë„ ì˜¬ë ¤ë†” ì£¼ì„¸ìš”."
      });
      night.push({
        name: "ì¥ë²½ ê°•í™” í† ë„ˆ",
        tags: "ì„¸ë¼ë§ˆì´ë“œ Â· ì½œë ˆìŠ¤í…Œë¡¤",
        desc: "í”¼ë¶€ê°€ ì˜ˆë¯¼í•  ë•ŒëŠ” ê°ì§ˆ ì œê±° í† ë„ˆ ëŒ€ì‹ , ì¥ë²½ ì„±ë¶„ ìœ„ì£¼ì˜ í† ë„ˆë§Œ ì‚¬ìš©í•˜ê³  ë ˆí‹°ë†€Â·ì‚°ì„±ë¶„ì€ ì ì‹œ ì‰¬ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ì•„ìš”."
      });
    } else {
      morning.push({
        name: "ê°€ë²¼ìš´ ìˆ˜ë¶„ í† ë„ˆ",
        tags: "íˆì•Œë£¨ë¡ ì‚° Â· ê¸€ë¦¬ì„¸ë¦°",
        desc: "í”¼ë¶€ê²°ì„ ì •ë¦¬í•´ ì£¼ë˜, ëˆì ì„ë³´ë‹¤ëŠ” ì‚°ëœ»í•œ ìˆ˜ë¶„ê°ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê³¨ë¼ ì£¼ì„¸ìš”."
      });
      night.push({
        name: "ìˆ˜ë¶„+ì˜ì–‘ í† ë„ˆ",
        tags: "ì•½ê°„ ì ì„±ì´ ìˆëŠ” íƒ€ì…",
        desc: "ì €ë…ì—ëŠ” ì‚´ì§ ë” ì ì„±ì´ ëŠê»´ì§€ëŠ” í† ë„ˆë¡œ í•œ ë²ˆ ë” ë ˆì´ì–´ë§í•´ ì£¼ë©´ ë‹¤ìŒ ë‹¨ê³„ í¡ìˆ˜ì— ë„ì›€ì´ ë¼ìš”."
      });
    }

    // ì„¸ëŸ¼ / ì•°í”Œ
    if (issues.some(i => i.includes("ëª¨ê³µ") || i.includes("í”¼ì§€") || i.includes("ë¸”ë™í—¤ë“œ"))) {
      night.push({
        name: "í”¼ì§€Â·ëª¨ê³µ ì§‘ì¤‘ ì„¸ëŸ¼",
        tags: "ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ Â· BHA Â· ì§•í¬",
        desc: "Tì¡´ ìœ„ì£¼ë¡œë§Œ ì†ŒëŸ‰ ì‚¬ìš©í•˜ê³ , ê±´ì¡°í•œ ë³¼Â·ì…ê°€ì—ëŠ” í”¼í•´ì„œ ë°”ë¥´ëŠ” ê²Œ ì¢‹ì•„ìš”. ì²˜ìŒì—ëŠ” ì£¼ 2~3íšŒë§Œ ì‚¬ìš©í•´ ë°˜ì‘ì„ í™•ì¸í•´ ë³´ì„¸ìš”."
      });
    }

    if (issues.some(i => i.includes("ì”ì£¼ë¦„") || i.includes("íƒ„ë ¥"))) {
      night.push({
        name: "íƒ„ë ¥Â·ì£¼ë¦„ ì¼€ì–´ ì„¸ëŸ¼",
        tags: "í©íƒ€ì´ë“œ Â· ë ˆí‹°ë‚ /ë ˆí‹°ë†€(ì €ë†ë„)",
        desc: "ëˆˆê°€Â·íŒ”ìÂ·ì´ë§ˆ ì£¼ë¦„ì´ ì‹ ê²½ ì“¸ ë•Œ, ì €ë…ì—ë§Œ ì†ŒëŸ‰ ì‚¬ìš©í•´ ë³´ê³  í”¼ë¶€ê°€ ì˜ˆë¯¼í•´ì§€ë©´ ì‚¬ìš© ê°„ê²©ì„ ë„“í˜€ ì£¼ì„¸ìš”."
      });
    }

    if (issues.some(i => i.includes("ê±´ì¡°") || i.includes("ì†ë‹¹ê¹€"))) {
      morning.push({
        name: "ìˆ˜ë¶„ ì§‘ì¤‘ ì•°í”Œ",
        tags: "íˆì•Œë£¨ë¡ ì‚° Â· NMF Â· ë² íƒ€ì¸",
        desc: "ë©”ì´í¬ì—… ì „ì— ë°€ë¦¬ì§€ ì•ŠëŠ” ìˆ˜ë¶„ ìœ„ì£¼ì˜ ì•°í”Œì„ ì„ íƒí•˜ë©´, ë§ˆìŠ¤í¬ ì† ë‹µë‹µí•¨ì„ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”."
      });
      night.push({
        name: "ìˆ˜ë¶„+ì¥ë²½ ì•°í”Œ",
        tags: "ì„¸ë¼ë§ˆì´ë“œ Â· ì½œë ˆìŠ¤í…Œë¡¤ Â· ì§€ë°©ì‚°",
        desc: "ìˆ˜ë©´ ì „ì— ì¶©ë¶„íˆ ë„í†°í•˜ê²Œ ë°œë¼ ì£¼ë©´, ì•„ì¹¨ì— í”¼ë¶€ê°€ ì‰½ê²Œ ë•…ê¸°ì§€ ì•Šë„ë¡ ë„ì™€ì¤˜ìš”."
      });
    }

    // í¬ë¦¼
    if (skinType === "ê±´ì„±" || issues.some(i => i.includes("ê±´ì¡°"))) {
      night.push({
        name: "ë¦¬ì¹˜í•œ ì¥ë²½ í¬ë¦¼",
        tags: "ì‹œì–´ë²„í„° Â· ìŠ¤ì¿ ì•Œë€ Â· ì„¸ë¼ë§ˆì´ë“œ",
        desc: "ì½” ì˜†, ì…ê°€, ë³¼ ìª½ì´ ì˜ íŠ¸ëŠ” í¸ì´ë¼ë©´, í•´ë‹¹ ë¶€ìœ„ì— í•œ ë²ˆ ë” ë ˆì´ì–´ë§ í•´ì£¼ëŠ” ê²ƒë„ ì¢‹ì•„ìš”."
      });
    } else {
      night.push({
        name: "ê°€ë²¼ìš´ í¬ë¦¼ ë˜ëŠ” ì ¤ í¬ë¦¼",
        tags: "ì§€ë³µí•© Â· ì§€ì„±ìš©",
        desc: "ë²ˆë“¤ê±°ë¦¼ì´ ì‹¬í•œ Tì¡´ì—ëŠ” ì–‡ê²Œ, ì‰½ê²Œ ê±´ì¡°í•´ì§€ëŠ” Uì¡´ì—ëŠ” í•œ ë²ˆ ë” ë§ë°œë¼ì„œ ì–‘ ì¡°ì ˆì„ í•´ ì£¼ì„¸ìš”."
      });
    }

    // ì„ í¬ë¦¼ (ê³µí†µ)
    morning.push({
      name: "ì €ìê·¹ ìì™¸ì„  ì°¨ë‹¨ì œ",
      tags: "SPF 30~50 / PA+++ ì´ìƒ",
      desc: "ë°±íƒÂ·ëˆì ì„Â·ìê·¹ê°ì´ ì ì€ ì œí’ˆ ìœ„ì£¼ë¡œ, ì™¸ì¶œ 15~20ë¶„ ì „ì— ë„‰ë„‰í•œ ì–‘ì„ í´ ë°”ë¥´ê³ , ì¥ì‹œê°„ ì•¼ì™¸ í™œë™ ì‹œ 2~3ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ë§ë°œë¼ ì£¼ì„¸ìš”."
    });

    return { morning, night, skinType, issues, riskLevel };
  }

  function renderProductList(list, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    list.forEach((item) => {
      const div = document.createElement("div");
      div.className = "product-item";

      const name = document.createElement("div");
      name.className = "product-name";
      name.innerText = item.name;

      const tags = document.createElement("div");
      tags.className = "product-tags";
      tags.innerText = item.tags;

      const desc = document.createElement("div");
      desc.className = "product-desc";
      desc.innerText = item.desc;

      div.appendChild(name);
      div.appendChild(tags);
      div.appendChild(desc);
      container.appendChild(div);
    });
  }

  function renderIssuesPills(issues) {
    const pills = document.getElementById("issues-pills");
    pills.innerHTML = "";
    if (!issues || !issues.length) {
      document.getElementById("issues-helper-text").innerText =
        "íŠ¹ë³„íˆ ê°•ì¡°ëœ ê³ ë¯¼ í‚¤ì›Œë“œê°€ í¬ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ë³¸ ìˆ˜ë¶„Â·ìì™¸ì„  ì°¨ë‹¨ ìœ„ì£¼ë¡œ ê´€ë¦¬í•´ ì£¼ì„¸ìš”.";
      return;
    }

    issues.forEach((iss) => {
      const span = document.createElement("span");
      span.className = "issue-pill";
      span.innerText = iss;
      pills.appendChild(span);
    });
  }

  function goResult() {
    window.location.href = "result.html";
  }

  function goHome() {
    window.location.href = "index.html";
  }

  function goChat() {
    const raw = localStorage.getItem("diagnosisHistory");
    if (!raw) {
      alert("ë¨¼ì € AI ì§„ë‹¨ì„ ì§„í–‰í•´ì£¼ì„¸ìš”!");
      return;
    }
    window.location.href = "chat.html";
  }

  function initProductsPage() {
    const raw = localStorage.getItem("diagnosisHistory");
    const emptyState = document.getElementById("empty-state");
    const wrapper = document.getElementById("products-wrapper");

    if (!raw) {
      emptyState.style.display = "block";
      wrapper.style.display = "none";
      return;
    }

    let history;
    try {
      history = JSON.parse(raw);
    } catch (e) {
      console.error("diagnosisHistory JSON íŒŒì‹± ì˜¤ë¥˜:", e);
      emptyState.style.display = "block";
      wrapper.style.display = "none";
      return;
    }

    if (!Array.isArray(history) || !history.length) {
      emptyState.style.display = "block";
      wrapper.style.display = "none";
      return;
    }

    const latest = history[0];
    setTodayLabel(latest.date);

    // í—¤ë” ë°°ì§€ ì„¸íŒ…
    const score = typeof latest.score === "number" ? latest.score : "-";
    const skinType = normalizeSkinType(latest.skinType || "ë³µí•©ì„±");
    const riskInfo = mapRiskBadge(latest.riskLevel || "mid");

    document.getElementById("badge-score").innerText = `ì ìˆ˜: ${score}/100`;
    document.getElementById("badge-skin").innerText = `í”¼ë¶€íƒ€ì…: ${skinType}`;
    const riskEl = document.getElementById("badge-risk");
    riskEl.innerText = riskInfo.label;
    riskEl.className = riskInfo.className;

    const { morning, night, issues } = buildRecommendations({
      skinType: latest.skinType,
      issues: latest.issues,
      riskLevel: latest.riskLevel
    });

    renderProductList(morning, "morning-list");
    renderProductList(night, "night-list");
    renderIssuesPills(issues);

    emptyState.style.display = "none";
    wrapper.style.display = "block";
  }

  window.addEventListener("DOMContentLoaded", () => {
    initProductsPage();
  });
</script>

</body>
</html>
