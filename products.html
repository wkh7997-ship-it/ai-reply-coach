<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI í”¼ë¶€ ì½”ì¹˜ - ì¶”ì²œ ì œí’ˆ</title>
  <style>
    :root {
      --primary: #9b8bff;
      --primary-strong: #5c6bff;
      --bg-deep: #050616;
      --bg-top: #11152b;
      --glass: rgba(10, 14, 32, 0.96);
      --text-main: #f9fafb;
      --text-sub: #cbd5f5;
      --border-soft: rgba(148, 163, 255, 0.35);
      --badge-low: #22c55e;
      --badge-mid: #eab308;
      --badge-high: #ef4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(88,101,242,0.32) 0, transparent 55%),
        radial-gradient(circle at bottom, rgba(59,130,246,0.26) 0, transparent 62%),
        linear-gradient(160deg, var(--bg-top), var(--bg-deep));
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px 14px;
    }

    .shell { width: 100%; max-width: 440px; }

    .card {
      background: var(--glass);
      border-radius: 26px;
      padding: 18px 16px 14px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 22px 50px rgba(0,0,0,0.9),
        0 0 0 1px rgba(15,23,42,0.7);
      backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
      max-height: calc(100vh - 32px);
      display: flex;
      flex-direction: column;
    }

    .card-inner-scroll {
      overflow-y: auto;
      padding-right: 2px;
      margin-right: -4px;
      flex: 1;
    }

    .top-accent {
      position: absolute;
      left: 14%; right: 14%; top: 10px;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(148,163,255,0.9), transparent);
      opacity: 0.95;
    }

    .header-wrap {
      margin-top: 12px;
      margin-bottom: 10px;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 10px;
    }

    .header-title {
      font-size: 1.3rem;
      font-weight: 750;
      line-height: 1.1;
    }

    .header-sub {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-top: 4px;
      line-height: 1.4;
    }

    .header-date {
      font-size: 0.72rem;
      color: rgba(203,213,255,0.9);
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,0.6);
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
    }

    /* ìš”ì•½ ë°°ì§€ */
    .summary-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .summary-badge {
      font-size: 0.76rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,0.5);
      background: rgba(15,23,42,0.9);
      color: #e5e7ff;
    }

    .risk-low {
      border-color: var(--badge-low);
      color: #bbf7d0;
      background: rgba(22,163,74,0.18);
    }

    .risk-mid {
      border-color: var(--badge-mid);
      color: #fef9c3;
      background: rgba(202,138,4,0.18);
    }

    .risk-high {
      border-color: var(--badge-high);
      color: #fee2e2;
      background: rgba(239,68,68,0.2);
    }

    .section-title {
      font-size: 0.86rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #9ca3ff;
      margin-bottom: 6px;
    }

    .empty-state {
      font-size: 0.88rem;
      color: var(--text-sub);
      text-align: center;
      padding: 30px 12px;
      line-height: 1.6;
    }

    /* ì œí’ˆ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
    .product-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }

    .product-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 11px;
      border-radius: 16px;
      background:
        radial-gradient(circle at top left, rgba(148,163,255,0.18), transparent 60%),
        rgba(12,16,40,0.95);
      border: 1px solid rgba(148,163,255,0.45);
      text-decoration: none;
      color: inherit;
      box-shadow:
        0 6px 18px rgba(0,0,0,0.45),
        0 0 0 1px rgba(15,23,42,0.8);
      transition: all 0.16s ease-out;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow:
        0 10px 24px rgba(0,0,0,0.6),
        0 0 0 1px rgba(129,140,248,0.9);
    }

    .product-thumb {
      width: 72px;
      height: 72px;
      border-radius: 14px;
      overflow: hidden;
      background: #020617;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .product-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .product-info {
      flex: 1;
      min-width: 0;
    }

    .product-name {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .product-desc {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-bottom: 5px;
      line-height: 1.4;
    }

    .product-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .product-tag {
      font-size: 0.72rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,255,0.4);
      color: #e5e7ff;
    }

    .btn-wrap {
      margin-top: 8px;
      padding-top: 6px;
      border-top: 1px solid rgba(15,23,42,0.9);
    }

    .nav-btn {
      width: 100%;
      padding: 11px 0;
      margin-top: 7px;
      border-radius: 999px;
      border: none;
      background: rgba(12,16,40,0.95);
      color: #e5e7ff;
      font-weight: 620;
      cursor: pointer;
      font-size: 0.92rem;
      box-shadow:
        0 6px 16px rgba(0,0,0,0.45),
        0 0 0 1px rgba(129,140,248,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .nav-btn span.icon {
      font-size: 1.1rem;
    }
  </style>
</head>

<body>
<div class="shell">
  <div class="card">
    <div class="top-accent"></div>

    <div class="header-wrap">
      <div>
        <div class="header-title">ì¶”ì²œ ì œí’ˆ ë¦¬ìŠ¤íŠ¸</div>
        <div class="header-sub" id="header-sub">
          ì˜¤ëŠ˜ ì§„ë‹¨ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ<br />
          í”¼ë¶€ ì»¨ë””ì…˜ì— ë§ëŠ” ì œí’ˆë“¤ì„ ê³¨ë¼ë´¤ì–´ìš”.
        </div>
      </div>
      <div class="header-date" id="header-date">-</div>
    </div>

    <div class="card-inner-scroll">
      <!-- ì§„ë‹¨ ìš”ì•½ -->
      <div id="summary-bar" class="summary-bar"></div>

      <!-- ì¶”ì²œ ì œí’ˆ ì˜ì—­ -->
      <div>
        <div class="section-title">Recommended products</div>

        <div id="empty-state" class="empty-state" style="display:none;">
          ì•„ì§ ì €ì¥ëœ ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.<br />
          ë¨¼ì € AI í”¼ë¶€ ì§„ë‹¨ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.
        </div>

        <div id="products-wrapper" style="display:none;">
          <div id="product-list" class="product-list"></div>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ ë²„íŠ¼ -->
    <div class="btn-wrap">
      <button class="nav-btn" onclick="goResult()">
        <span class="icon">ğŸ“Š</span>
        <span>ì˜¤ëŠ˜ì˜ í”¼ë¶€ ë¦¬í¬íŠ¸ë¡œ ëŒì•„ê°€ê¸°</span>
      </button>
      <button class="nav-btn" onclick="goHome()">
        <span class="icon">ğŸ </span>
        <span>ì²« í™”ë©´ìœ¼ë¡œ</span>
      </button>
    </div>
  </div>
</div>

<script>
  // ğŸ”¹ 1. ì—¬ê¸° PRODUCTS ë°°ì—´ì— "ë„¤ê°€ ì„ íƒí•œ ì¿ íŒ¡ ìƒí’ˆë“¤"ì„ ë„£ìœ¼ë©´ ë¨
  //  - link: ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ë§í¬
  //  - image: ìƒí’ˆ ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL
  //  - name: ì¹´ë“œì— ë³´ì¼ ìƒí’ˆëª…
  //  - desc: í•œ ì¤„ ì„¤ëª…
  //  - tags: ì‘ì€ íƒœê·¸ë“¤ (ì„ íƒì‚¬í•­)
  const PRODUCTS = [
    {
      id: "p1",
      name: "ì˜ˆì‹œ) ëª¨ê³µÂ·í”¼ì§€ ì¼€ì–´ ì„¸ëŸ¼",
      desc: "ë²ˆë“¤ê±°ë¦¼ì´ ê³ ë¯¼ì¼ ë•Œ ì‚¬ìš©í•˜ëŠ” ë°ì¼ë¦¬ ì„¸ëŸ¼",
      image: "https://via.placeholder.com/120x120?text=Serum",
      link: "https://www.coupang.com/", // ğŸ”´ ì—¬ê¸°ì— ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ë§í¬ ë„£ê¸°
      tags: ["ì§€ì„±Â·ë³µí•©ì„±", "ëª¨ê³µ", "ê°€ë²¼ìš´ ì‚¬ìš©ê°"]
    },
    {
      id: "p2",
      name: "ì˜ˆì‹œ) ìˆ˜ë¶„ ì¥ë²½ í¬ë¦¼",
      desc: "ì†ë‹¹ê¹€ê³¼ ê±´ì¡°í•¨ì„ ì¡ì•„ì£¼ëŠ” ë³´ìŠµ í¬ë¦¼",
      image: "https://via.placeholder.com/120x120?text=Cream",
      link: "https://www.coupang.com/",
      tags: ["ê±´ì„±", "ìˆ˜ë¶„Â·ì¥ë²½", "ì €ìê·¹"]
    },
    {
      id: "p3",
      name: "ì˜ˆì‹œ) ì €ìê·¹ ì§„ì • í† ë„ˆ",
      desc: "ì„¸ì•ˆ í›„ í”¼ë¶€ ì˜¨ë„ë¥¼ ë¹ ë¥´ê²Œ ë‚®ì¶°ì£¼ëŠ” í† ë„ˆ",
      image: "https://via.placeholder.com/120x120?text=Toner",
      link: "https://www.coupang.com/",
      tags: ["ë¯¼ê°ì„±", "ì§„ì •", "ì•½ì‚°ì„±"]
    }
  ];

  // ğŸ”¹ 2. ì§„ë‹¨ ìš”ì•½ìš© ë¦¬ìŠ¤í¬ ë±ƒì§€ ë§µ
  function mapRiskBadge(riskLevel) {
    if (riskLevel === "low") {
      return { label: "ìœ„í—˜ë„ ë‚®ìŒ", className: "summary-badge risk-low" };
    }
    if (riskLevel === "high") {
      return { label: "ìœ„í—˜ë„ ë†’ìŒ", className: "summary-badge risk-high" };
    }
    return { label: "ìœ„í—˜ë„ ë³´í†µ", className: "summary-badge risk-mid" };
  }

  // ğŸ”¹ 3. ì˜¤ëŠ˜ ë‚ ì§œ or ì§„ë‹¨ ë‚ ì§œ í‘œì‹œ
  function setTodayLabel(dateStr) {
    const el = document.getElementById("header-date");
    if (dateStr) {
      el.innerText = dateStr.replace(/-/g, "."); // 2025-11-25 â†’ 2025.11.25
      return;
    }
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, "0");
    const d = String(now.getDate()).padStart(2, "0");
    el.innerText = `${y}.${m}.${d}`;
  }

  // ğŸ”¹ 4. result.htmlì—ì„œ ë„˜ì–´ì˜¬ ë•Œ: ì„¸ì…˜ â†’ ì—†ìœ¼ë©´ ì§„ë‹¨ íˆìŠ¤í† ë¦¬ì—ì„œ ê°€ì ¸ì˜¤ê¸°
  function getBaseResult() {
    let baseResult = null;

    // 1) ë°©ê¸ˆ ì§„ë‹¨í•œ ê²°ê³¼ ìš°ì„ 
    const rawSession = sessionStorage.getItem("aiSkinResult");
    if (rawSession) {
      try {
        baseResult = JSON.parse(rawSession);
      } catch (e) {
        console.error("aiSkinResult JSON íŒŒì‹± ì˜¤ë¥˜:", e);
      }
    }

    // 2) ì„¸ì…˜ì— ì—†ìœ¼ë©´ â†’ ë¡œì»¬ íˆìŠ¤í† ë¦¬ ìµœì‹  1ê°œ
    if (!baseResult) {
      const rawHistory = localStorage.getItem("diagnosisHistory");
      if (!rawHistory) return null;

      try {
        const history = JSON.parse(rawHistory);
        if (Array.isArray(history) && history.length) {
          // history êµ¬ì¡°: { date, score, skinType, riskLevel, summary }
          baseResult = history[0];
        }
      } catch (e) {
        console.error("diagnosisHistory JSON íŒŒì‹± ì˜¤ë¥˜:", e);
        return null;
      }
    }

    return baseResult;
  }

  // ğŸ”¹ 5. ìƒë‹¨ ì§„ë‹¨ ìš”ì•½ ë±ƒì§€ ê·¸ë¦¬ê¸°
  function renderSummaryBar(result) {
    const bar = document.getElementById("summary-bar");
    bar.innerHTML = "";

    const score = typeof result.score === "number" ? result.score : null;
    const skinType = result.skinType || "í”¼ë¶€ íƒ€ì… ì •ë³´ ì—†ìŒ";
    const riskInfo = mapRiskBadge(result.riskLevel || "mid");

    if (score !== null) {
      const b1 = document.createElement("span");
      b1.className = "summary-badge";
      b1.innerText = `ì ìˆ˜: ${score}/100`;
      bar.appendChild(b1);
    }

    const b2 = document.createElement("span");
    b2.className = "summary-badge";
    b2.innerText = `í”¼ë¶€íƒ€ì…: ${skinType}`;
    bar.appendChild(b2);

    const b3 = document.createElement("span");
    b3.className = riskInfo.className;
    b3.innerText = riskInfo.label;
    bar.appendChild(b3);
  }

  // ğŸ”¹ 6. ì œí’ˆ ì¹´ë“œ ëª©ë¡ ë Œë”ë§
  function renderProductList(products) {
    const listEl = document.getElementById("product-list");
    listEl.innerHTML = "";

    products.forEach((p) => {
      const a = document.createElement("a");
      a.className = "product-card";
      a.href = p.link;            // ğŸ‘‰ ì—¬ê¸° ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ë§í¬
      a.target = "_blank";        // ìƒˆ ì°½(ì•±)ìœ¼ë¡œ ì—´ê¸°
      a.rel = "noopener noreferrer";

      a.innerHTML = `
        <div class="product-thumb">
          <img src="${p.image}" alt="${p.name}" />
        </div>
        <div class="product-info">
          <div class="product-name">${p.name}</div>
          <div class="product-desc">${p.desc || ""}</div>
          <div class="product-tags">
            ${(p.tags || [])
              .map((t) => `<span class="product-tag">${t}</span>`)
              .join("")}
          </div>
        </div>
      `;

      listEl.appendChild(a);
    });
  }

  // ğŸ”¹ 7. í˜ì´ì§€ ì´ˆê¸°í™”
  function initProductsPage() {
    const emptyState = document.getElementById("empty-state");
    const wrapper = document.getElementById("products-wrapper");

    const baseResult = getBaseResult();
    if (!baseResult) {
      emptyState.style.display = "block";
      wrapper.style.display = "none";
      setTodayLabel();
      return;
    }

    // ë‚ ì§œ í‘œì‹œ
    if (baseResult.date) {
      setTodayLabel(baseResult.date);
    } else {
      setTodayLabel();
    }

    // ìƒë‹¨ ìš”ì•½ ë±ƒì§€
    renderSummaryBar(baseResult);

    // ğŸ‘‰ ì§€ê¸ˆì€ ê°„ë‹¨íˆ PRODUCTS ì „ë¶€ ë…¸ì¶œ
    // ë‚˜ì¤‘ì— ì—¬ê¸°ì—ì„œ baseResult.skinType / issues ë³´ê³  í•„í„°ë§ë§Œ ì¶”ê°€í•˜ë©´ ë¨
    renderProductList(PRODUCTS);

    emptyState.style.display = "none";
    wrapper.style.display = "block";
  }

  // ğŸ”¹ 8. ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
  function goHome() {
    window.location.href = "index.html";
  }

  function goResult() {
    // result.htmlì—ì„œ ìë™ ì´ë™ ë°©ì§€ìš© í”Œë˜ê·¸ (ì›ë˜ ë¡œì§ ìœ ì§€)
    sessionStorage.setItem("skipAutoProduct", "1");
    window.location.href = "result.html";
  }

  window.addEventListener("DOMContentLoaded", () => {
    initProductsPage();
  });
</script>

</body>
</html>
