<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í”¼ë¶€ ì½”ì¹˜ - ê²°ê³¼ & ì±—ë´‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: radial-gradient(circle at top, #1f2937, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }
    .layout {
      width: 100%;
      max-width: 960px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 16px;
    }
    @media (max-width: 800px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      background: rgba(15,23,42,0.96);
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 20px 45px rgba(15,23,42,0.9);
      padding: 16px 14px 14px;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .img-wrap {
      margin-bottom: 10px;
      text-align: center;
    }
    .img-wrap img {
      max-width: 100%;
      max-height: 260px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.8);
      object-fit: cover;
      background: #020617;
    }
    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
    }
    .box {
      font-size: 12px;
      background: #020617;
      border-radius: 12px;
      border: 1px solid rgba(75,85,99,0.8);
      padding: 8px 9px;
      line-height: 1.6;
    }
    ul { margin: 4px 0 0 14px; }
    li { margin-bottom: 3px; }
    .product-card {
      margin-top: 6px;
      padding: 7px 8px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.7);
      background: #020617;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      font-size: 11px;
    }
    .product-main { max-width: 70%; }
    .product-name { font-weight: 600; }
    .product-desc { color: #9ca3af; }
    .product-meta { color: #a5b4fc; margin-top: 2px; }
    .product-btn {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: linear-gradient(135deg,#4f46e5,#6366f1);
      color: #eef2ff;
      text-decoration: none;
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
    }
    .back-link {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .back-link a { color: #a5b4fc; text-decoration: underline; }
    .notice {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 6px;
    }

    /* ì±—ë´‡ */
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .badge {
      font-size: 10px;
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(129,140,248,0.8);
      color: #c7d2fe;
    }
    .chat-box {
      display: flex;
      flex-direction: column;
      height: 420px;
    }
    .chat-messages {
      flex: 1;
      background: #020617;
      border-radius: 10px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 8px;
      overflow-y: auto;
      font-size: 12px;
    }
    .msg {
      max-width: 88%;
      padding: 7px 9px;
      border-radius: 10px;
      margin-bottom: 6px;
      line-height: 1.5;
      word-break: break-word;
    }
    .user {
      margin-left: auto;
      background: linear-gradient(135deg,#4f46e5,#6366f1);
    }
    .bot {
      margin-right: auto;
      background: #111827;
      border: 1px solid rgba(75,85,99,0.9);
    }
    .chat-input-wrap {
      margin-top: 8px;
      display: flex;
      gap: 6px;
    }
    #chat-input {
      flex: 1;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(107,114,128,0.9);
      background: #020617;
      color: #e5e7eb;
      outline: none;
    }
    #chat-input:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.7);
    }
    #chat-send {
      border-radius: 999px;
      border: none;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #ecfdf5;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ì™¼ìª½: ë¶„ì„ ê²°ê³¼ -->
    <div class="card" id="analysis-card">
      <div class="back-link">
        â† ì…ë ¥ì„ ë‹¤ì‹œ í•˜ê³  ì‹¶ìœ¼ë©´ <a href="index.html">ì—¬ê¸°</a>ë¥¼ ëˆŒëŸ¬ ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì„¸ìš”.
      </div>
      <h1>AI í”¼ë¶€ ë¶„ì„ ê²°ê³¼</h1>
      <p class="sub">ì‚¬ì§„ê³¼ ì…ë ¥ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë¹„ì˜ë£Œìš© ê°€ì´ë“œì…ë‹ˆë‹¤. í†µì¦Â·ì—¼ì¦ì´ ì‹¬í•˜ë©´ ê¼­ í”¼ë¶€ê³¼ ì „ë¬¸ì˜ì™€ ìƒë‹´í•˜ì„¸ìš”.</p>

      <div class="img-wrap" id="photo-wrapper" style="display:none;">
        <img id="preview-img" alt="ì…ë ¥í•œ í”¼ë¶€ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°" />
      </div>

      <div class="section-title">1. í”¼ë¶€ ìƒíƒœ ìš”ì•½</div>
      <div class="box" id="summary-box">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

      <div class="section-title">2. ì¶”ì²œ ë£¨í‹´ (ì•„ì¹¨ / ì €ë… / ìŠ¤í˜ì…œ)</div>
      <div class="box" id="routine-box"></div>

      <div class="section-title">3. ì¶”ì²œ ì„±ë¶„ &amp; ì œí’ˆ (ì¿ íŒ¡ ê²€ìƒ‰ ë§í¬)</div>
      <div class="box" id="product-box"></div>

      <p class="notice">
        â€» â€œì¿ íŒ¡ì—ì„œ ë³´ê¸°â€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í•´ë‹¹ í‚¤ì›Œë“œë¡œ ì¿ íŒ¡ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—´ë¦½ë‹ˆë‹¤.<br>
        ì‹¤ì œ ìƒí’ˆì˜ ì„±ë¶„Â·ì‚¬ìš©ë²•ì„ í•­ìƒ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.
      </p>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì±—ë´‡ -->
    <div class="card">
      <div class="chat-header">
        <div>
          <div style="font-size:14px; font-weight:600;">AI í”¼ë¶€ ì½”ì¹˜ ì±—ë´‡</div>
          <div style="font-size:11px; color:#9ca3af;">ì§€ê¸ˆ ìƒíƒœì— ë§ì¶° ììœ ë¡­ê²Œ ì§ˆë¬¸í•´ ë³´ì„¸ìš”.</div>
        </div>
        <div class="badge">BETA</div>
      </div>
      <div class="chat-box">
        <div class="chat-messages" id="chat-messages"></div>
        <form id="chat-form" class="chat-input-wrap">
          <input
            id="chat-input"
            type="text"
            placeholder="ì˜ˆ: í„± ì—¬ë“œë¦„ì´ ì‹¬í•  ë•ŒëŠ” ì–´ë–¤ ìˆœì„œë¡œ ë°”ë¥´ë©´ ì¢‹ì„ê¹Œ?"
            autocomplete="off"
          />
          <button type="submit" id="chat-send">ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ---------- ê³µí†µ ìœ í‹¸ ----------
    function createCoupangLink(keyword) {
      const encodedKeyword = encodeURIComponent(keyword);
      const searchUrl = `https://www.coupang.com/np/search?q=${encodedKeyword}`;
      const partnerCode = "YOUR_PARTNERS_CODE"; // ğŸ‘‰ ì—¬ê¸° ë„¤ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ì½”ë“œë¡œ êµì²´
      return `https://link.coupang.com/a/${partnerCode}?targetUrl=${encodeURIComponent(searchUrl)}`;
    }

    function getProductRecommendations(concern, budget) {
      const base = [];

      if (concern === "ì—¬ë“œë¦„") {
        base.push(
          { name: "BHA ì—¬ë“œë¦„ í† ë„ˆ", desc: "ë§‰íŒ í”¼ì§€Â·ê°ì§ˆì„ ë¶€ë“œëŸ½ê²Œ ì •ë¦¬í•˜ëŠ” í† ë„ˆ", tag: "ê°ì§ˆÂ·í”¼ì§€ ì¼€ì–´" },
          { name: "ë…¼ì½”ë©”ë„ì œë‹‰ ìˆ˜ë¶„í¬ë¦¼", desc: "ê¸°ë¦„ì€ ì¤„ì´ê³  ìˆ˜ë¶„ë§Œ ì±„ì›Œì£¼ëŠ” ì ¤ í¬ë¦¼", tag: "ì—¬ë“œë¦„ í”¼ë¶€ìš©" },
          { name: "ì—¬ë“œë¦„ ìŠ¤íŒŸ íŒ¨ì¹˜", desc: "ì§œì§€ ë§ê³  ë¶™ì—¬ì„œ ì§„ì •ì‹œí‚¤ëŠ” íŒ¨ì¹˜", tag: "ì‘ê¸‰ íŠ¸ëŸ¬ë¸”" }
        );
      } else if (concern === "ëª¨ê³µí”¼ë¶€ê²°") {
        base.push(
          { name: "AHA/BHA í•„ë§ í† ë„ˆ", desc: "í”¼ë¶€ê²° ê°œì„ ê³¼ ëª¨ê³µ ì •ë¦¬ì— ë„ì›€", tag: "í”¼ë¶€ê²°Â·ëª¨ê³µ ì¼€ì–´" },
          { name: "ëª¨ê³µ ì„¸ëŸ¼", desc: "í”¼ì§€ë¥¼ ì •ëˆí•˜ê³  ëª¨ê³µ ì£¼ë³€ íƒ„ë ¥ì— ë„ì›€ ë˜ëŠ” ì„¸ëŸ¼", tag: "ëª¨ê³µ ì§‘ì¤‘" },
          { name: "ê°€ë²¼ìš´ ìˆ˜ë¶„ ì ¤ í¬ë¦¼", desc: "ì§€Â·ë³µí•©ì„±ë„ ë¶€ë‹´ ì—†ëŠ” ë³´ìŠµ", tag: "ë°ì¼ë¦¬ ë³´ìŠµ" }
        );
      } else if (concern === "í™ì¡°ë¯¼ê°") {
        base.push(
          { name: "ì„¼í…”ë¼(ì‹œì¹´) ì§„ì • í† ë„ˆ", desc: "ë¶‰ì€ê¸°ì™€ ì—´ê°ì„ ì§„ì •ì‹œí‚¤ëŠ” í† ë„ˆ", tag: "ì§„ì • ì¼€ì–´" },
          { name: "ë¬´í–¥ ì €ìê·¹ ìˆ˜ë¶„í¬ë¦¼", desc: "ë¯¼ê° í”¼ë¶€ìš© ìµœì†Œ ì„±ë¶„ ìˆ˜ë¶„í¬ë¦¼", tag: "ë¯¼ê°ì„± ì „ìš©" },
          { name: "ì•½ì‚°ì„± ì €ìê·¹ í¼í´ë Œì €", desc: "ì¥ë²½ì„ ëœ ìê·¹í•˜ëŠ” ì„¸ì•ˆì œ", tag: "ì•½ì‚°ì„± í´ë Œì €" }
        );
      } else if (concern === "ì¡í‹°ìƒ‰ì†Œ") {
        base.push(
          { name: "ë¹„íƒ€ë¯¼C ì„¸ëŸ¼", desc: "í†¤ì—…ê³¼ ì¡í‹° ì™„í™”ì— ë„ì›€ ë˜ëŠ” ì„¸ëŸ¼", tag: "í†¤ì—…Â·ë¯¸ë°±" },
          { name: "ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ ì„¸ëŸ¼", desc: "í”¼ë¶€í†¤ ê· ì¼í™”ì— ë„ì›€", tag: "í†¤ ë³´ì •" },
          { name: "ìì™¸ì„ ì°¨ë‹¨ì œ SPF50+", desc: "ìƒ‰ì†Œ ê´€ë¦¬ì˜ í•µì‹¬ì¸ ì„ í¬ë¦¼", tag: "UV ì°¨ë‹¨" }
        );
      } else if (concern === "ì£¼ë¦„íƒ„ë ¥") {
        base.push(
          { name: "ë ˆí‹°ë†€ / ë ˆí‹°ë‚  ì„¸ëŸ¼", desc: "ì£¼ë¦„Â·íƒ„ë ¥ ê´€ë¦¬ ëŒ€í‘œ ì„±ë¶„", tag: "ì•ˆí‹°ì—ì´ì§•" },
          { name: "í©íƒ€ì´ë“œ í¬ë¦¼", desc: "íƒ„ë ¥ê°ê³¼ ë³´ìŠµì„ ì£¼ëŠ” í¬ë¦¼", tag: "íƒ„ë ¥ ì¼€ì–´" },
          { name: "ì§‘ì¤‘ ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©", desc: "ì£¼ 1~2íšŒ ìˆ˜ë¶„Â·íƒ„ë ¥ ë³´ì¶©", tag: "ìŠ¤í˜ì…œ ì¼€ì–´" }
        );
      } else if (concern === "ê±´ì¡°ê°ì§ˆ") {
        base.push(
          { name: "ì €ìê·¹ ìˆ˜ë¶„ í† ë„ˆ", desc: "ë ˆì´ì–´ë§í•˜ê¸° ì¢‹ì€ ì›Œí„°/ì—ì„¼ìŠ¤ í† ë„ˆ", tag: "ìˆ˜ë¶„ ë ˆì´ì–´ë§" },
          { name: "ì„¸ë¼ë§ˆì´ë“œ í¬ë¦¼", desc: "ì¥ë²½ ê°•í™”ìš© ê³ ë³´ìŠµ í¬ë¦¼", tag: "ì¥ë²½ ì¼€ì–´" },
          { name: "ìŠ¬ë¦¬í•‘íŒ©", desc: "ë°¤ ì‚¬ì´ ìˆ˜ë¶„ ì¦ë°œì„ ë§‰ì•„ì£¼ëŠ” ì˜¤ë²„ë‚˜ì´íŠ¸ ì¼€ì–´", tag: "ë‚˜ì´íŠ¸ ì¼€ì–´" }
        );
      }

      return base.map(p => ({
        ...p,
        meta:
          budget === "ê°€ì„±ë¹„"
            ? "ê°€ì„±ë¹„ ì¢‹ì€ ì œí’ˆ ìœ„ì£¼ë¡œ ì¿ íŒ¡ì—ì„œ ê³¨ë¼ë³´ì„¸ìš”."
            : budget === "ì¤‘ê°„ê°€ê²©"
            ? "ë¦¬ë·°ì™€ ì„±ë¶„ì„ í•¨ê»˜ ë³´ê³  ì¤‘ê°„ ê°€ê²©ëŒ€ë¥¼ ì„ íƒí•´ ë³´ì„¸ìš”."
            : "ì„±ë¶„ê³¼ ì‚¬ìš©ê°ì´ ì˜ ë§ìœ¼ë©´ í”„ë¦¬ë¯¸ì—„ ë¼ì¸ë„ í•œë‘ ê°œ ì„ì–´ë„ ê´œì°®ìŠµë‹ˆë‹¤."
      }));
    }

    function buildRoutine({ skinType, mainConcern, ageRange, extraNotes }) {
      const summaryParts = [];

      // íƒ€ì… ì„¤ëª…
      if (skinType === "ê±´ì„±") {
        summaryParts.push("ì„¸ì•ˆ í›„ ë°”ë¡œ ê±´ì¡°í•´ì§€ê³  ë‹¹ê¸°ëŠ” ëŠë‚Œì´ ìˆëŠ” ê±´ì„± íƒ€ì…ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ìˆ˜ë¶„Â·ìœ ë¶„ ë ˆì´ì–´ë§ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.");
      } else if (skinType === "ì§€ì„±") {
        summaryParts.push("Tì¡´ ë²ˆë“¤ê±°ë¦¼ì´ ë‘ë“œëŸ¬ì§€ëŠ” ì§€ì„± íƒ€ì…ìœ¼ë¡œ, ê³¼í•œ ìœ ë¶„ì„ ì¡°ì ˆí•˜ë©´ì„œ ìˆ˜ë¶„ì€ ìœ ì§€í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.");
      } else if (skinType === "ë³µí•©ì„±") {
        summaryParts.push("ë¶€ë¶„ì ìœ¼ë¡œëŠ” ê±´ì¡°í•˜ê³  ë¶€ë¶„ì ìœ¼ë¡œëŠ” ë²ˆë“¤ê±°ë¦¬ëŠ” ë³µí•©ì„± íƒ€ì…ìœ¼ë¡œ, ë¶€ìœ„ë³„ë¡œ ë‹¤ë¥¸ ì¼€ì–´ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤.");
      } else if (skinType === "ë¯¼ê°ì„±") {
        summaryParts.push("ìê·¹ì— ì˜ˆë¯¼í•˜ê²Œ ë°˜ì‘í•˜ëŠ” ë¯¼ê°ì„± í”¼ë¶€ì¼ ìˆ˜ ìˆì–´, ì„±ë¶„ ìˆ˜ê°€ ì ê³  ì €ìê·¹ì¸ ì œí’ˆ ìœ„ì£¼ê°€ ì¢‹ìŠµë‹ˆë‹¤.");
      } else if (skinType === "ì¤‘ì„±") {
        summaryParts.push("ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ê°€ ë¹„êµì  ì•ˆì •ì ì¸ ì¤‘ì„± í”¼ë¶€ë¡œ ë³´ì´ë©°, ê¸°ë³¸ ë£¨í‹´ë§Œ ê¾¸ì¤€íˆ ìœ ì§€í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.");
      } else {
        summaryParts.push("ì…ë ¥ëœ ì •ë³´ë§Œìœ¼ë¡œ íƒ€ì…ì„ íŠ¹ì •í•˜ê¸° ì–´ë µì§€ë§Œ, ê¸°ë³¸ì ì¸ ë³´ìŠµÂ·ìì™¸ì„  ì°¨ë‹¨ ë£¨í‹´ì„ ë°”íƒ•ìœ¼ë¡œ ì œì•ˆí•´ ë“œë¦´ê²Œìš”.");
      }

      if (mainConcern === "ì—¬ë“œë¦„") {
        summaryParts.push("ì—¬ë“œë¦„Â·íŠ¸ëŸ¬ë¸”ì´ ì£¼ ê³ ë¯¼ì´ë¼, ìê·¹ì„ ìµœì†Œí™”í•˜ë©´ì„œ ë§‰íŒ í”¼ì§€ì™€ ì—¼ì¦ì„ ê´€ë¦¬í•˜ëŠ” ë£¨í‹´ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      } else if (mainConcern === "ëª¨ê³µí”¼ë¶€ê²°") {
        summaryParts.push("ëª¨ê³µÂ·í”¼ë¶€ê²° ê°œì„ ì„ ìœ„í•´ ê°ì§ˆÂ·í”¼ì§€ë¥¼ ì¡°ì ˆí•˜ë©´ì„œ ê±´ì¡°í•˜ì§€ ì•Šê²Œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.");
      } else if (mainConcern === "í™ì¡°ë¯¼ê°") {
        summaryParts.push("í™ì¡°Â·ë¯¼ê°ì€ ì—´ê°ê³¼ ìê·¹ì„ ì¤„ì´ëŠ” ê²ƒì´ í•µì‹¬ì´ë¼, ì§„ì •Â·ë³´ìŠµ ìœ„ì£¼ì˜ ë‹¨ìˆœí•œ ë£¨í‹´ì´ ì¢‹ìŠµë‹ˆë‹¤.");
      } else if (mainConcern === "ì¡í‹°ìƒ‰ì†Œ") {
        summaryParts.push("ì¡í‹°Â·ìƒ‰ì†ŒëŠ” ìì™¸ì„  ì°¨ë‹¨ê³¼ ë¯¸ë°± ì„±ë¶„ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê¾¸ì¤€í•¨ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.");
      } else if (mainConcern === "ì£¼ë¦„íƒ„ë ¥") {
        summaryParts.push("ì£¼ë¦„Â·íƒ„ë ¥ ê´€ë¦¬ëŠ” ë ˆí‹°ë†€Â·í©íƒ€ì´ë“œ ë“± ì„±ë¶„ê³¼ ìì™¸ì„  ì°¨ë‹¨ì„ ë³‘í–‰í•´ì•¼ íš¨ê³¼ì ì…ë‹ˆë‹¤.");
      } else if (mainConcern === "ê±´ì¡°ê°ì§ˆ") {
        summaryParts.push("ê±´ì¡°Â·ê°ì§ˆì€ ì„¸ì•ˆ ë‹¨ê³„ë¶€í„° ìê·¹ì„ ì¤„ì´ê³ , ë³´ìŠµì„ ì—¬ëŸ¬ ê²¹ ìŒ“ëŠ” ë°©ì‹ì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.");
      }

      if (ageRange === "10ëŒ€") {
        summaryParts.push("10ëŒ€ì—ëŠ” ê³¼í•œ ì„±ì¸ìš© ì•ˆí‹°ì—ì´ì§•ë³´ë‹¤ëŠ”, ì—¬ë“œë¦„Â·í”¼ì§€Â·ê¸°ë³¸ ì¥ë²½ ê´€ë¦¬ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.");
      } else if (ageRange === "20ëŒ€") {
        summaryParts.push("20ëŒ€ì—ëŠ” ì¥ë²½Â·ìˆ˜ë¶„ ê´€ë¦¬ì™€ í•¨ê»˜ ëª¨ê³µÂ·ìƒ‰ì†ŒÂ·ì´ˆê¸° ì£¼ë¦„ì„ ê°€ë³ê²Œ ê´€ë¦¬í•´ ë‘ë©´ ì¢‹ìŠµë‹ˆë‹¤.");
      } else if (ageRange === "30ëŒ€") {
        summaryParts.push("30ëŒ€ë¶€í„°ëŠ” ìˆ˜ë¶„ ì €í•˜ì™€ ë¯¸ì„¸ ì£¼ë¦„ì´ ì‹œì‘ë˜ë¯€ë¡œ, ë³´ìŠµÂ·íƒ„ë ¥Â·ë¯¸ë°±ì„ í•¨ê»˜ ê³ ë ¤í•œ ë£¨í‹´ì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.");
      } else if (ageRange === "40ëŒ€ ì´ìƒ") {
        summaryParts.push("40ëŒ€ ì´í›„ì—ëŠ” íƒ„ë ¥Â·ìƒ‰ì†ŒÂ·ì£¼ë¦„ì„ ë™ì‹œì— ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ì•„, ë°¤ì—ëŠ” ì¡°ê¸ˆ ë” ì˜ì–‘ê° ìˆëŠ” ë£¨í‹´ë„ ê´œì°®ìŠµë‹ˆë‹¤.");
      }

      if (extraNotes && extraNotes.length > 0) {
        summaryParts.push(`ë˜, ë‚¨ê²¨ì£¼ì‹  ë©”ëª¨(â€œ${extraNotes.slice(0, 40)}...â€)ë„ ì°¸ê³ í•´ ë„ˆë¬´ ë³µì¡í•˜ì§€ ì•Šìœ¼ë©´ì„œ í˜„ì‹¤ì ìœ¼ë¡œ ì§€ì† ê°€ëŠ¥í•œ ë£¨í‹´ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì œì•ˆí–ˆì–´ìš”.`);
      }

      const morning = [];
      const night = [];
      const special = [];

      // ì•„ì¹¨
      morning.push("â‘  (ì„ íƒ) ë¯¸ì˜¨ìˆ˜ ì„¸ì•ˆ ë˜ëŠ” ì•½ì‚°ì„± í¼í´ë Œì €ë¡œ ê°€ë³ê²Œ ì„¸ì•ˆ");
      morning.push("â‘¡ ì§„ì •Â·ìˆ˜ë¶„ í† ë„ˆ ë˜ëŠ” ì—ì„¼ìŠ¤ 1~3íšŒ ë ˆì´ì–´ë§");
      if (mainConcern === "ì¡í‹°ìƒ‰ì†Œ" || mainConcern === "ì£¼ë¦„íƒ„ë ¥") {
        morning.push("â‘¢ ë¹„íƒ€ë¯¼C ë˜ëŠ” ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ ì„¸ëŸ¼ (ìê·¹ ì—†ìœ¼ë©´ ì—°ì† ì‚¬ìš©)");
      }
      morning.push("â‘£ í”¼ë¶€ íƒ€ì…ì— ë§ëŠ” ìˆ˜ë¶„í¬ë¦¼ / ì ¤ í¬ë¦¼");
      morning.push("â‘¤ SPF 30~50+ ì„ í¬ë¦¼ ì¶©ë¶„í•œ ì–‘ ë°”ë¥´ê¸°");

      // ì €ë…
      night.push("â‘  ë©”ì´í¬ì—…Â·ì„ í¬ë¦¼ ì‚¬ìš© ì‹œ: í´ë Œì§• ì˜¤ì¼/ë°¤ + ì•½ì‚°ì„± í¼ìœ¼ë¡œ 2ì¤‘ ì„¸ì•ˆ");
      night.push("â‘¡ ì§„ì •Â·ìˆ˜ë¶„ í† ë„ˆë¡œ ìˆ˜ë¶„Â·pH ë°¸ëŸ°ìŠ¤ ì •ë¦¬");
      if (mainConcern === "ì—¬ë“œë¦„") {
        night.push("â‘¢ BHA í† ë„ˆ ë˜ëŠ” ì—¬ë“œë¦„ ì¼€ì–´ ì„¸ëŸ¼ (ì£¼ 2~3íšŒ, ì ì‘ë˜ë©´ ì¡°ì ˆ)");
      } else if (mainConcern === "ëª¨ê³µí”¼ë¶€ê²°") {
        night.push("â‘¢ AHA/PHA ë“± í”¼ë¶€ê²° ê°œì„  í† ë„ˆÂ·ì„¸ëŸ¼ (ë¯¼ê°í•˜ë©´ ì‚¬ìš© ê°„ê²© ë„“ê²Œ)");
      } else if (mainConcern === "í™ì¡°ë¯¼ê°") {
        night.push("â‘¢ ì„¼í…”ë¼Â·íŒí…Œë†€Â·ì•Œë€í† ì¸ ë“± ì§„ì • ì—ì„¼ìŠ¤ ìœ„ì£¼ë¡œ ì‚¬ìš©");
      } else if (mainConcern === "ì£¼ë¦„íƒ„ë ¥") {
        night.push("â‘¢ ë ˆí‹°ë†€ / ë ˆí‹°ë‚  ì„¸ëŸ¼ ì†ŒëŸ‰ (ì£¼ 2íšŒ ì •ë„ë¡œ ì‹œì‘)");
      } else if (mainConcern === "ê±´ì¡°ê°ì§ˆ") {
        night.push("â‘¢ ì„¸ë¼ë§ˆì´ë“œÂ·ì§€ì§ˆ í¬ë¦¼ ë„‰ë„‰í•˜ê²Œ ë°œë¼ ì¥ë²½ ì¼€ì–´");
      }
      night.push("â‘£ í•„ìš” ì‹œ ìŠ¬ë¦¬í•‘íŒ©Â·í˜ì´ì…œì˜¤ì¼ ì†ŒëŸ‰ìœ¼ë¡œ ë§ˆë¬´ë¦¬");

      // ìŠ¤í˜ì…œ
      if (mainConcern === "ì—¬ë“œë¦„") {
        special.push("ì£¼ 1íšŒ ì •ë„, í•„ë§Â·ê°ì§ˆ ì œí’ˆ ì‚¬ìš©í•˜ëŠ” ë‚ ì—ëŠ” ë‹¤ë¥¸ ê°•í•œ ì„¸ëŸ¼ì€ ì‰¬ì–´ì£¼ì„¸ìš”.");
        special.push("í° ì—¼ì¦ì„± ì—¬ë“œë¦„ì€ ì†ìœ¼ë¡œ ì§œì§€ ë§ê³  ìŠ¤íŒŸ íŒ¨ì¹˜Â·ì—°ê³ ë¥¼ ìœ„ì£¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.");
      } else if (mainConcern === "ëª¨ê³µí”¼ë¶€ê²°") {
        special.push("ê°ì§ˆ ì œê±° ì œí’ˆ(AHA/BHA)ì€ í”¼ë¶€ ìƒíƒœ ë´ê°€ë©´ì„œ ì£¼ 1~2íšŒë§Œ ì‚¬ìš©í•´ë„ ì¶©ë¶„í•œ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.");
      } else if (mainConcern === "í™ì¡°ë¯¼ê°") {
        special.push("ëœ¨ê±°ìš´ ë¬¼ ì„¸ì•ˆ, ì‚¬ìš°ë‚˜, ê°•í•œ ìŠ¤í¬ëŸ½ì€ í™ì¡°ë¥¼ ì•…í™”ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë‹ˆ ê°€ëŠ¥í•˜ë©´ í”¼í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.");
      } else if (mainConcern === "ì¡í‹°ìƒ‰ì†Œ") {
        special.push("ìì™¸ì„  ê°•í•œ ë‚ ì—ëŠ” ì„ í¬ë¦¼ ë§ë°”ë¥´ê¸°ì™€ ëª¨ìÂ·ì–‘ì‚°ê¹Œì§€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ìƒ‰ì†Œ ê´€ë¦¬ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.");
      } else if (mainConcern === "ì£¼ë¦„íƒ„ë ¥") {
        special.push("ë ˆí‹°ë†€ ì‚¬ìš© ë‚ ì—ëŠ” í•„ë§Â·ë¯¸ë°± ì„±ë¶„ê³¼ í•¨ê»˜ ì“°ê¸°ë³´ë‹¤ ì§„ì •Â·ë³´ìŠµ ìœ„ì£¼ë¡œ ë‹¨ìˆœí•˜ê²Œ ë£¨í‹´ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.");
      } else if (mainConcern === "ê±´ì¡°ê°ì§ˆ") {
        special.push("ìƒ¤ì›Œ ì§í›„ 3ë¶„ ì´ë‚´ì— ì–¼êµ´ê³¼ ëª¸ì— ë³´ìŠµì œë¥¼ ë„‰ë„‰í•˜ê²Œ ë°”ë¥´ëŠ” '3ë¶„ ë³´ìŠµ' ìŠµê´€ì„ ë“¤ì—¬ë³´ì„¸ìš”.");
      }

      return { summary: summaryParts.join(" "), morning, night, special };
    }

    function renderAnalysis() {
      const raw = localStorage.getItem('skinInput');
      const summaryBox = document.getElementById('summary-box');
      const routineBox = document.getElementById('routine-box');
      const productBox = document.getElementById('product-box');
      const photoWrapper = document.getElementById('photo-wrapper');
      const previewImg = document.getElementById('preview-img');

      if (!raw) {
        summaryBox.textContent = "ì…ë ¥ ì •ë³´ê°€ ì—†ì–´ìš”. ì²˜ìŒ í™”ë©´ì—ì„œ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        routineBox.textContent = "-";
        productBox.textContent = "-";
        photoWrapper.style.display = "none";
        return;
      }

      const data = JSON.parse(raw);

      if (data.imageData) {
        previewImg.src = data.imageData;
        photoWrapper.style.display = "block";
      } else {
        photoWrapper.style.display = "none";
      }

      const routine = buildRoutine(data);
      const products = getProductRecommendations(data.mainConcern, data.budgetRange);

      summaryBox.textContent = routine.summary;

      routineBox.innerHTML = `
        <strong>ì•„ì¹¨ ë£¨í‹´</strong>
        <ul>${routine.morning.map(item => `<li>${item}</li>`).join("")}</ul>
        <br/>
        <strong>ì €ë… ë£¨í‹´</strong>
        <ul>${routine.night.map(item => `<li>${item}</li>`).join("")}</ul>
        ${routine.special.length ? `<br/><strong>ì£¼ 1~2íšŒ ìŠ¤í˜ì…œ ì¼€ì–´</strong><ul>${routine.special.map(item => `<li>${item}</li>`).join("")}</ul>` : ""}
      `;

      productBox.innerHTML = products
        .map(p => {
          const link = createCoupangLink(p.name);
          return `
          <div class="product-card">
            <div class="product-main">
              <div class="product-name">${p.name}</div>
              <div class="product-desc">${p.desc}</div>
              <div class="product-meta">${p.meta}</div>
            </div>
            <a class="product-btn" href="${link}" target="_blank" rel="noopener noreferrer">
              ğŸ›’ ì¿ íŒ¡ì—ì„œ ë³´ê¸°
            </a>
          </div>
        `;
        })
        .join("");
    }

    // ---------- ì±—ë´‡ ----------
    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');

    function addMessage(role, text) {
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getLocalChatReply(userText, context) {
      const txt = userText.toLowerCase();
      const concern = context?.mainConcern || "";
      const type = context?.skinType || "";

      if (txt.includes("ì—¬ë“œë¦„") || concern === "ì—¬ë“œë¦„") {
        return "ì—¬ë“œë¦„ì´ ê³ ë¯¼ì´ë¼ë©´, ì„¸ì•ˆÂ·ê°ì§ˆÂ·ë³´ìŠµÂ·ìì™¸ì„  ì°¨ë‹¨ ë„¤ ê°€ì§€ë¥¼ ê¾¸ì¤€íˆ ìœ ì§€í•˜ëŠ” ê²Œ ê°€ì¥ ì¤‘ìš”í•´ìš”. íŠ¹íˆ ì†ìœ¼ë¡œ ë§Œì§€ê±°ë‚˜ ì§œì§€ ì•ŠëŠ” ìŠµê´€ì„ ë“¤ì´ëŠ” ê²Œ ì§„ì§œ íš¨ê³¼ê°€ í½ë‹ˆë‹¤.";
      }
      if (txt.includes("ëª¨ê³µ") || txt.includes("ë¸”ë™í—¤ë“œ") || concern === "ëª¨ê³µí”¼ë¶€ê²°") {
        return "ëª¨ê³µÂ·ë¸”ë™í—¤ë“œ ê´€ë¦¬ì—ëŠ” 'ê³¼í•œ ì••ì¶œ'ë³´ë‹¤ëŠ” AHA/BHA ê°™ì€ ê°ì§ˆ ê´€ë¦¬ì™€ ê°€ë²¼ìš´ ë³´ìŠµ, ê·¸ë¦¬ê³  ì„ í¬ë¦¼ì´ ê¸°ë³¸ì´ì—ìš”. ì£¼ 1~2íšŒ ì •ë„ë¡œë§Œ ê°ì§ˆ ì¼€ì–´ë¥¼ í•´ë„ ì¶©ë¶„í•œ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.";
      }
      if (txt.includes("ê±´ì¡°") || txt.includes("ê°ì§ˆ") || concern === "ê±´ì¡°ê°ì§ˆ") {
        return "ê±´ì¡°Â·ê°ì§ˆì€ ì„¸ì•ˆë¶€í„° ë„ˆë¬´ ì„¸ê²Œ í•˜ì§€ ì•ŠëŠ” ê²Œ ì¤‘ìš”í•´ìš”. ë¯¸ì§€ê·¼í•œ ë¬¼ê³¼ ì•½ì‚°ì„± í¼ìœ¼ë¡œ ì§§ê²Œ ì„¸ì•ˆí•˜ê³ , ë°”ë¡œ ìˆ˜ë¶„ í† ë„ˆì™€ ì„¸ë¼ë§ˆì´ë“œ í¬ë¦¼ì„ ê²¹ê²¹ì´ ë°œë¼ë³´ì„¸ìš”.";
      }
      if (txt.includes("í™ì¡°") || txt.includes("ë¯¼ê°") || concern === "í™ì¡°ë¯¼ê°") {
        return "í™ì¡°Â·ë¯¼ê° í”¼ë¶€ë¼ë©´ ëœ¨ê±°ìš´ ë¬¼, ê°•í•œ ìŠ¤í¬ëŸ½, ì•Œì½”ì˜¬ì´ ë§ì´ ë“¤ì–´ê°„ ì œí’ˆì€ í”¼í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”. ì„¼í…”ë¼, íŒí…Œë†€, ì•Œë€í† ì¸ì²˜ëŸ¼ ì§„ì • ì„±ë¶„ ìœ„ì£¼ì˜ ë£¨í‹´ì„ ì¶”ì²œí•©ë‹ˆë‹¤.";
      }
      if (txt.includes("ì¡í‹°") || txt.includes("ê¸°ë¯¸") || concern === "ì¡í‹°ìƒ‰ì†Œ") {
        return "ì¡í‹°Â·ê¸°ë¯¸ëŠ” ìì™¸ì„  ì°¨ë‹¨ì´ 1ìˆœìœ„ì˜ˆìš”. ë¹„íƒ€ë¯¼C, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ ê°™ì€ ì„±ë¶„ì„ ê¾¸ì¤€íˆ ì“°ë©´ì„œ, ì„ í¬ë¦¼ì€ ì‹¤ë‚´ë¼ë„ ê°€ëŠ¥í•œ í•œ ë§¤ì¼ ë°œë¼ì£¼ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.";
      }
      if (txt.includes("ë ˆí‹°ë†€") || txt.includes("ë ˆí‹°ë‚ ") || concern === "ì£¼ë¦„íƒ„ë ¥") {
        return "ë ˆí‹°ë†€Â·ë ˆí‹°ë‚ ì€ ì²˜ìŒì—ëŠ” 2~3ì¼ì— í•œ ë²ˆ, ì†ŒëŸ‰ë§Œ ì¨ë³´ëŠ” ê²Œ ì¢‹ì•„ìš”. ê°ì§ˆÂ·ë”°ê°€ì›€ì´ ëŠê»´ì§€ë©´ ì‰¬ì–´ê°€ê³ , ê·¸ë‚ ì€ ì§„ì •Â·ë³´ìŠµ ìœ„ì£¼ë¡œë§Œ ì¼€ì–´í•˜ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.";
      }
      if (type === "ë¯¼ê°ì„±") {
        return "ë¯¼ê°ì„± í”¼ë¶€ë¼ë©´ í•œ ë²ˆì— ì—¬ëŸ¬ ì‹ ì œí’ˆì„ ì“°ê¸°ë³´ë‹¤, í•œ ê°€ì§€ì”© 2ì£¼ ì •ë„ëŠ” ë°˜ì‘ì„ ì‚´í´ë³´ë©´ì„œ ëŠ˜ë ¤ê°€ëŠ” ê²Œ ì•ˆì „í•©ë‹ˆë‹¤.";
      }

      return "ì§€ê¸ˆ ìƒíƒœì—ì„œ ë„ˆë¬´ ë³µì¡í•˜ê²Œ ë°”ê¾¸ê¸°ë³´ë‹¤ëŠ”, ì„¸ì•ˆâ€“ìˆ˜ë¶„â€“ë³´ìŠµâ€“ìì™¸ì„  ì°¨ë‹¨ ë„¤ ë‹¨ê³„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€í•˜ëŠ” ê²Œ ì œì¼ ì¤‘ìš”í•´ìš”. ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ, 'ì–¸ì œ / ì–´ë””ê°€ / ì–´ë–»ê²Œ' ë¶ˆí¸í•œì§€ ì ì–´ì£¼ë©´ ê±°ê¸°ì— ë§ì¶° ë£¨í‹´ì„ ë” ë‹¤ë“¬ì–´ ì¤„ê²Œìš”.";
    }

    chatForm.addEventListener('submit', function (e) {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;
      chatInput.value = '';
      addMessage('user', text);

      const raw = localStorage.getItem('skinInput');
      const context = raw ? JSON.parse(raw) : {};

      const reply = getLocalChatReply(text, context);
      setTimeout(() => {
        addMessage('bot', reply);
      }, 300);
    });

    // ì´ˆê¸° ì¸ì‚¬ + ë¶„ì„ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', () => {
      renderAnalysis();
      addMessage('bot', "ì•ˆë…•í•˜ì„¸ìš”, AI í”¼ë¶€ ì½”ì¹˜ì…ë‹ˆë‹¤. ë°©ê¸ˆ ë¶„ì„ëœ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¶ê¸ˆí•œ ì ì„ í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!");
    });
  </script>
</body>
</html>
