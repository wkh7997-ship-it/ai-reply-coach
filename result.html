<script>
  const API_KEY = "YOUR_OPENAI_API_KEY";   // ← 여기에 키 입력 (나중에 숨기는 방법도 알려줄게)

  async function analyzeSkin() {
    const base64Image = sessionStorage.getItem("uploadedImage");

    if (!base64Image) {
      document.getElementById("resultText").innerText = "이미지를 불러오지 못했습니다.";
      return;
    }

    document.getElementById("resultText").innerText = "AI가 분석 중입니다... 잠시만 기다려주세요.";

    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [
            {
              role: "system",
              content: "너는 전문 피부과 피부 분석 AI다. 사진을 보고 피부 상태, 문제점, 원인, 루틴, 추천 제품을 아주 간단하게 한국어로 설명해라."
            },
            {
              role: "user",
              content: [
                { type: "text", text: "이 얼굴 피부를 분석해줘." },
                {
                  type: "image_url",
                  image_url: {
                    url: base64Image   // ← 여기로 이미지 전달됨
                  }
                }
              ]
            }
          ]
        })
      });

      const data = await response.json();
      console.log(data);

      const aiMessage = data.choices[0].message.content;

      document.getElementById("resultText").innerText = aiMessage;

    } catch (error) {
      console.error(error);
      document.getElementById("resultText").innerText = "AI 분석 중 오류가 발생했습니다.";
    }
  }

  // 페이지 로드 시 자동 실행
  window.onload = analyzeSkin;
</script>
