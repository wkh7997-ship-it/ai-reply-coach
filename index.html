<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ëŒ€í™” ì½”ì¹˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --bg1: #050816;
      --bg2: #3b1d6a;
      --card-bg: rgba(8, 12, 32, 0.96);
      --text-main: #f9fafb;
      --text-sub: #a5b4fc;
      --border: rgba(148, 163, 184, 0.35);
      --safe: #22c55e;
      --warn: #eab308;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html, body { height: 100%; }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #4c1d95 0, rgba(76, 29, 149, 0.25) 18%, transparent 35%),
        radial-gradient(circle at bottom, #0b1120 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: calc(18px + env(safe-area-inset-top, 0px)) 12px calc(18px + env(safe-area-inset-bottom, 0px));
      -webkit-text-size-adjust: 100%;
    }

    .app {
      width: 100%;
      max-width: 480px;
      position: relative;
    }

    .shell {
      background: radial-gradient(circle at top, #111827 0, #020617 60%, #000 100%);
      border-radius: 32px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow:
        0 26px 60px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      padding: 18px 16px 82px;
      overflow: hidden;
      position: relative;
    }

    .screen { display: none; }
    .screen.active { display: block; }

    /* ê³µí†µ í—¤ë” */
    .app-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 18px;
    }

    .header-icon {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      padding: 3px;
      background: radial-gradient(circle at 30% 20%, #9f8cff 0, #4c1d95 45%, #111827 100%);
      box-shadow:
        0 8px 20px rgba(79, 70, 229, 0.9),
        0 0 0 1px rgba(30, 64, 175, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-icon-inner {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background:
        radial-gradient(circle at 30% 20%, #fef9c3 0, #f97316 36%, #4c1d95 70%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: 800;
    }

    .header-title {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .header-sub {
      margin-top: 3px;
      font-size: 13px;
      color: var(--text-sub);
    }

    /* ê³µí†µ íƒ€ì´í‹€/í…ìŠ¤íŠ¸ */
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .section-sub {
      font-size: 14px;
      color: #e5e7ff;
      margin-bottom: 6px;
    }

    .section-desc {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      font-size: 11px;
      color: #c7d2fe;
      background: rgba(15,23,42,0.9);
    }

    /* í™ˆ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
    .home-list {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .home-item {
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 12px 12px;
      background: radial-gradient(circle at top left,
        rgba(79,70,229,0.28) 0,
        rgba(15,23,42,0.98) 52%);
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease;
    }

    .home-item:active {
      transform: translateY(1px);
      box-shadow: 0 10px 20px rgba(15,23,42,0.9);
    }

    .home-item-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .home-item-title {
      font-size: 15px;
      font-weight: 600;
    }

    .home-item-tag {
      font-size: 11px;
      color: #c7d2fe;
    }

    .home-item-desc {
      font-size: 13px;
      color: #e5e7ff;
    }

    /* í†¤ ì„ íƒ + ì…ë ¥ */
    .tone-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .tone-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.55);
      background: rgba(15,23,42,0.96);
      color: var(--text-main);
      padding: 9px 2px;
      font-size: 13px;
      text-align: center;
      cursor: pointer;
    }

    .tone-btn.selected {
      border-color: #a5b4fc;
      background: radial-gradient(circle at top,
        rgba(79,70,229,0.7) 0,
        rgba(15,23,42,0.98) 55%);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.7);
    }

    .field-label {
      font-size: 14px;
      margin-top: 14px;
      margin-bottom: 4px;
      color: #c7d2fe;
    }

    textarea {
      width: 100%;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.98);
      color: var(--text-main);
      font-size: 15px;
      padding: 12px 14px;
      line-height: 1.5;
      min-height: 80px;
      resize: vertical;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129,140,248,0.8);
      background: rgba(15,23,42,1);
    }

    .hint {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 6px;
    }

    .btn-primary {
      width: 100%;
      border-radius: 20px;
      border: none;
      padding: 14px 16px;
      margin-top: 16px;
      font-size: 15px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      box-shadow:
        0 18px 40px rgba(79,70,229,0.9),
        0 0 0 1px rgba(129,140,248,0.75);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 10px 26px rgba(79,70,229,0.8),
        0 0 0 1px rgba(129,140,248,0.8);
    }

    .status-text {
      font-size: 12px;
      color: #a5b4fc;
      min-height: 18px;
      margin-top: 6px;
    }

    /* ê²°ê³¼ í™”ë©´ */
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .back-btn {
      border: none;
      background: none;
      color: #e5e7ff;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 4px 0;
    }

    .back-btn span.arrow {
      font-size: 16px;
      transform: translateY(1px);
    }

    .tone-chip-current {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 11px;
      color: #c7d2fe;
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
    }

    .subtitle-main {
      font-size: 15px;
      font-weight: 600;
      margin-top: 8px;
    }

    .subtitle-sub {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 3px;
      margin-bottom: 10px;
    }

    .result-wrapper {
      border-radius: 22px;
      background:
        radial-gradient(circle at top, rgba(79,70,229,0.3) 0, rgba(15,23,42,0.98) 55%);
      border: 1px solid rgba(148,163,184,0.5);
      padding: 14px 12px 12px;
    }

    .result-header-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .result-header-title {
      font-size: 15px;
      font-weight: 700;
    }

    .result-header-sub {
      font-size: 12px;
      color: #cbd5ff;
      margin-top: 2px;
    }

    .result-header-right {
      font-size: 12px;
      color: #a5b4fc;
      text-align: right;
    }

    .original-box {
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.96);
      padding: 8px 10px 8px;
      margin-bottom: 8px;
    }

    .original-label {
      font-size: 12px;
      color: #c7d2fe;
      margin-bottom: 2px;
    }

    .original-text {
      font-size: 14px;
    }

    .answer-item {
      padding: 9px 9px 9px;
      border-radius: 18px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(51,65,85,0.9);
      margin-top: 8px;
      box-shadow: 0 8px 18px rgba(15,23,42,0.9);
    }

    .answer-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .answer-text {
      font-size: 15px;
      flex: 1;
      padding-right: 4px;
    }

    .favorite-btn {
      border-radius: 999px;
      border: 1px solid #facc15;
      background: rgba(234,179,8,0.1);
      color: #facc15;
      font-size: 12px;
      padding: 3px 9px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 3px;
      white-space: nowrap;
    }

    .favorite-btn.active {
      background: rgba(234,179,8,0.35);
      color: #fef9c3;
    }

    .copy-btn {
      border-radius: 999px;
      border: none;
      padding: 5px 14px;
      font-size: 13px;
      background: rgba(79,70,229,0.96);
      color: #e5e7ff;
      cursor: pointer;
      white-space: nowrap;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
      font-size: 12px;
    }

    .chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
    }

    .chip-risk {
      border-color: var(--safe);
      color: var(--safe);
      background: rgba(34,197,94,0.12);
    }

    .chip-sense {
      border-color: #a5b4fc;
      color: #a5b4fc;
    }

    .comment-text {
      font-size: 12px;
      color: #cbd5ff;
      margin-top: 4px;
    }

    .again-row {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    .btn-outline {
      flex: 1;
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.7);
      background: transparent;
      color: #e5e7ff;
      font-size: 14px;
      padding: 10px 0;
      cursor: pointer;
    }

    .btn-outline:active {
      transform: translateY(1px);
      background: rgba(15,23,42,0.85);
    }

    /* ìŠ¤ì¼ˆë ˆí†¤ */
    .skeleton-item {
      border-radius: 18px;
      border: 1px solid rgba(51,65,85,0.85);
      background: rgba(15,23,42,0.96);
      padding: 10px;
      margin-top: 8px;
      overflow: hidden;
    }

    .skeleton-line {
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(
        110deg,
        rgba(148,163,184,0.25) 8%,
        rgba(148,163,184,0.55) 18%,
        rgba(148,163,184,0.18) 33%
      );
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
      margin-bottom: 6px;
    }

    .skeleton-line.short { width: 40%; }
    .skeleton-line.mid   { width: 65%; }
    .skeleton-line.long  { width: 90%; }

    @keyframes shimmer {
      0% { background-position: -150% 0; }
      100% { background-position: 150% 0; }
    }

    /* ë‚´ ë§íˆ¬ / ì¦ê²¨ì°¾ê¸° */
    .list-empty {
      margin-top: 16px;
      font-size: 13px;
      color: #94a3b8;
    }

    .my-style-row,
    .fav-row {
      margin-top: 8px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.96);
      padding: 8px 10px;
      font-size: 13px;
    }

    .my-style-main,
    .fav-main { font-size: 14px; }

    .my-style-sub,
    .fav-meta {
      margin-top: 4px;
      font-size: 12px;
      color: #a5b4fc;
    }

    .small-btn-row {
      margin-top: 6px;
      display: flex;
      gap: 6px;
    }

    .small-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: transparent;
      color: #e5e7ff;
      font-size: 11px;
      padding: 4px 8px;
      cursor: pointer;
    }

    /* ìº¡ì²˜ í™”ë©´ */
    .capture-box {
      margin-top: 12px;
      border-radius: 18px;
      border: 1px dashed rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.9);
      padding: 12px 10px;
      text-align: center;
    }

    .capture-input {
      margin-top: 8px;
      width: 100%;
      font-size: 13px;
      color: var(--text-main);
    }

    .capture-preview {
      margin-top: 10px;
      max-height: 200px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.7);
    }

    .capture-preview img {
      width: 100%;
      display: block;
    }

    /* í•˜ë‹¨ íƒ­ë°” (ê¸€ì í¬ê³ , ëˆˆì— ì˜ ë„ê²Œ) */
    .tabbar {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      transform: translateY(50%);
      display: flex;
      justify-content: center;
      pointer-events: none;
    }

    .tabbar-inner {
      width: 100%;
      max-width: 480px;
      padding: 0 8px;
    }

    .tabbar-bg {
      background: rgba(15,23,42,0.98);
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      box-shadow:
        0 18px 34px rgba(15,23,42,0.95),
        0 0 0 1px rgba(15,23,42,1);
      display: flex;
      align-items: stretch;
      overflow: hidden;
      pointer-events: auto;
    }

    .tab-btn {
      flex: 1;
      padding: 8px 4px 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: #9ca3af;
      font-size: 13px;
      font-weight: 600;
      position: relative;
    }

    .tab-btn .label {
      display: block;
    }

    .tab-btn.active {
      background: radial-gradient(circle at top,
        rgba(79,70,229,0.8) 0,
        rgba(15,23,42,0.98) 60%);
      color: #f9fafb;
      box-shadow: inset 0 0 0 1px rgba(129,140,248,0.9);
    }

    .tab-btn.active::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, -40%);
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fde047;
      box-shadow: 0 0 12px rgba(250, 250, 133, 0.9);
    }

    @media (max-height: 700px) {
      body {
        align-items: flex-start;
        padding-top: 16px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="shell">
      <!-- ê³µí†µ í—¤ë” -->
      <header class="app-header">
        <div class="header-icon">
          <div class="header-icon-inner">ğŸ’¬</div>
        </div>
        <div>
          <div class="header-title">AI ëŒ€í™” ì½”ì¹˜</div>
          <div class="header-sub">ì¹´í†¡ ë‹µì¥, ê°™ì´ ìƒê°í•´ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</div>
        </div>
      </header>

      <!-- ===== í™ˆ í™”ë©´ ===== -->
      <section class="screen active" id="screen-home">
        <div class="section-title">ì˜¤ëŠ˜ì€ ì–´ë””ë¶€í„° ë„ì™€ë“œë¦´ê¹Œìš”?</div>
        <div class="section-sub">ìƒí™©ì— ë§ëŠ” ë‹µì¥ Â· ë‚´ ë§íˆ¬ Â· ìº¡ì²˜ ë¶„ì„ê¹Œì§€ í•œ ë²ˆì—.</div>
        <div class="pill-row">
          <span class="pill">ì—°ì•  / ì¹œêµ¬ / ì§ì¥</span>
          <span class="pill">ìœ„í—˜ë„ Â· ì„¼ìŠ¤ ì ìˆ˜</span>
          <span class="pill">ì¦ê²¨ì°¾ê¸° ë³´ê´€</span>
        </div>

        <div class="home-list">
          <div class="home-item" data-go="reply">
            <div class="home-item-title-row">
              <div class="home-item-title">1. AIê°€ ì¹´í†¡ ë‹µì¥ ë§Œë“¤ì–´ì£¼ê¸°</div>
              <div class="home-item-tag">ë‹µì¥ 3ê°œ ì¶”ì²œ</div>
            </div>
            <div class="home-item-desc">ìƒí™© ì„ íƒ â†’ ë©”ì‹œì§€ ì…ë ¥ â†’ ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ì™€ í•¨ê»˜ ë‹µì¥ 3ê°œë¥¼ ì¶”ì²œí•´ ë“œë ¤ìš”.</div>
          </div>

          <div class="home-item" data-go="capture">
            <div class="home-item-title-row">
              <div class="home-item-title">2. ìº¡ì²˜ë¡œ ë‹µì¥ ë§Œë“¤ê¸°</div>
              <div class="home-item-tag">ì´ë¯¸ì§€ ì¸ì‹</div>
            </div>
            <div class="home-item-desc">ì¹´í†¡ ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´, ëŒ€í™”ë¥¼ ì½ê³  ì–´ìš¸ë¦¬ëŠ” ë‹µì¥ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</div>
          </div>

          <div class="home-item" data-go="mystyle">
            <div class="home-item-title-row">
              <div class="home-item-title">3. ë‚´ ë§íˆ¬ í•™ìŠµì‹œí‚¤ê¸°</div>
              <div class="home-item-tag">ë‚´ í‘œí˜„ ì €ì¥</div>
            </div>
            <div class="home-item-desc">ìì£¼ ì“°ëŠ” í‘œí˜„ê³¼ ë§íˆ¬ë¥¼ ì €ì¥í•´ ë‘ê³ , ë‚˜ì¤‘ì— ë‹µì¥ ë§Œë“¤ ë•Œ ì°¸ê³ í•  ìˆ˜ ìˆì–´ìš”.</div>
          </div>

          <div class="home-item" data-go="favorites">
            <div class="home-item-title-row">
              <div class="home-item-title">4. ì¦ê²¨ì°¾ê¸° ë‹µì¥ ëª¨ì•„ë³´ê¸°</div>
              <div class="home-item-tag">â˜… ëª¨ì•„ë³´ê¸°</div>
            </div>
            <div class="home-item-desc">ë§ˆìŒì— ë“¤ì—ˆë˜ ë‹µì¥ì„ ëª¨ì•„ë³´ê³ , ë°”ë¡œ ë³µì‚¬í•´ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
          </div>
        </div>
      </section>

      <!-- ===== í…ìŠ¤íŠ¸ ë‹µì¥ ë§Œë“¤ê¸° ===== -->
      <section class="screen" id="screen-reply">
        <div class="section-title">ì–´ë–¤ ìƒí™©ì˜ ë‹µì¥ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
        <div class="section-sub">ìƒí™©ì— ë”°ë¼ ë§íˆ¬ì™€ ë¶„ìœ„ê¸°ë¥¼ ë‹¤ë¥´ê²Œ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.</div>
        <div class="section-desc">ê°€ì¥ ë¹„ìŠ·í•œ ìƒí™©ì„ ê³¨ë¼ ì£¼ì„¸ìš”.</div>

        <div class="tone-grid" id="toneGridText">
          <button type="button" class="tone-btn" data-tone="ì—°ì• ">ì—°ì• </button>
          <button type="button" class="tone-btn" data-tone="ì¸">ì¸</button>
          <button type="button" class="tone-btn" data-tone="ì¹œêµ¬">ì¹œêµ¬</button>
          <button type="button" class="tone-btn" data-tone="ì§ì¥">ì§ì¥</button>
          <button type="button" class="tone-btn" data-tone="ê°€ì¡±">ê°€ì¡±</button>
          <button type="button" class="tone-btn" data-tone="ê¸°íƒ€">ê¸°íƒ€</button>
        </div>

        <div class="field-label">ìƒëŒ€ë°© ë©”ì‹œì§€</div>
        <textarea id="messageText" placeholder="ì˜ˆ) ë‚´ì¼ ìˆ™ì œ ê°™ì´ í• ê¹Œ?"></textarea>
        <p class="hint">ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ì–´ ì£¼ì„¸ìš”.</p>

        <button class="btn-primary" id="generateTextBtn" type="button">
          AI ì¶”ì²œ ë‹µì¥ ìƒì„±
        </button>
        <div class="status-text" id="statusText"></div>
      </section>

      <!-- ===== ê²°ê³¼ í™”ë©´ (í…ìŠ¤íŠ¸/ìº¡ì²˜ ê³µìš©) ===== -->
      <section class="screen" id="screen-result">
        <div class="top-row">
          <button class="back-btn" id="backFromResult" type="button">
            <span class="arrow">â†</span><span>ì´ì „ ë‹¨ê³„ë¡œ</span>
          </button>
          <div class="tone-chip-current" id="toneChipCurrent">ì¹œêµ¬ í†¤</div>
        </div>

        <div class="section-title" id="resultTitle">AI ì¶”ì²œ ë‹µì¥</div>
        <div class="subtitle-main" id="resultTopText">AI ì¶”ì²œ ë‹µì¥ì´ ì¤€ë¹„ë˜ëŠ” ì¤‘ì´ì—ìš”...</div>
        <div class="subtitle-sub" id="resultStatusText">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”. ì§€ê¸ˆ ëŒ€í™”ì— ë”± ë§ëŠ” ë‹µì¥ì„ ë§Œë“¤ê³  ìˆì–´ìš”.</div>

        <section class="result-wrapper">
          <div class="result-header-row">
            <div>
              <div class="result-header-title">ì¶”ì²œ ê²°ê³¼</div>
              <div class="result-header-sub">ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ëŠ” ê°€ë³ê²Œ ì°¸ê³ ë§Œ í•´ ì£¼ì„¸ìš”.</div>
            </div>
            <div class="result-header-right">
              ìµœëŒ€ 3ê°œê¹Œì§€ ì¶”ì²œ<br />
              ë§ˆìŒì— ë“œëŠ” ë‹µì¥ì€ â˜… ì¦ê²¨ì°¾ê¸°!
            </div>
          </div>

          <div class="original-box">
            <div class="original-label">ë¶„ì„ ê¸°ì¤€</div>
            <div class="original-text" id="resultOriginalText">-</div>
          </div>

          <div id="answers"></div>

          <div class="again-row">
            <button class="btn-outline" id="regenerateBtn" type="button">ë‹¤ì‹œ ìƒì„±í•˜ê¸°</button>
            <button class="btn-outline" id="goHomeFromResult" type="button">í™ˆìœ¼ë¡œ</button>
          </div>
        </section>
      </section>

      <!-- ===== ë‚´ ë§íˆ¬ í™”ë©´ ===== -->
      <section class="screen" id="screen-mystyle">
        <div class="section-title">ë‚´ ë§íˆ¬ í•™ìŠµì‹œí‚¤ê¸°</div>
        <div class="section-sub">ë‚´ê°€ ìì£¼ ì“°ëŠ” í‘œí˜„ì„ ì €ì¥í•´ ë‘ê³ , ë‚˜ì¤‘ì— ì°¸ê³ í•  ìˆ˜ ìˆì–´ìš”.</div>

        <div class="field-label">ë‚´ê°€ ìì£¼ ì“°ëŠ” í‘œí˜„</div>
        <textarea id="myStyleMain" placeholder="ì˜ˆ) ã…‹ã…‹ ë‚˜ ê·¸ê±° ì™„ì „ ì¢‹ì•„í•´"></textarea>

        <div class="field-label">ì„¤ëª… (ì–¸ì œ ì“°ëŠ” ë§ì¸ì§€)</div>
        <textarea id="myStyleDesc" placeholder="ì˜ˆ) ì¹œí•œ ì¹œêµ¬ë‘ ê°€ë³ê²Œ ë†ë‹´í•  ë•Œ ì“°ëŠ” ë§"></textarea>

        <button class="btn-primary" id="saveMyStyleBtn" type="button">ë‚´ ë§íˆ¬ ì €ì¥í•˜ê¸°</button>
        <div class="status-text" id="myStyleStatus"></div>

        <div class="field-label" style="margin-top:14px;">ì €ì¥ëœ ë‚´ ë§íˆ¬</div>
        <div id="myStyleList"></div>
        <p class="list-empty" id="myStyleEmpty" style="display:none;">ì•„ì§ ì €ì¥ëœ í‘œí˜„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </section>

      <!-- ===== ì¦ê²¨ì°¾ê¸° í™”ë©´ ===== -->
      <section class="screen" id="screen-favorites">
        <div class="section-title">ì¦ê²¨ì°¾ê¸° ë‹µì¥ ëª¨ì•„ë³´ê¸°</div>
        <div class="section-sub">ë§ˆìŒì— ë“¤ì—ˆë˜ ë‹µì¥ì„ ë‹¤ì‹œ êº¼ë‚´ì„œ ë°”ë¡œ ë³µì‚¬í•´ ì“¸ ìˆ˜ ìˆì–´ìš”.</div>

        <div id="favList"></div>
        <p class="list-empty" id="favEmpty" style="display:none;">ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </section>

      <!-- ===== ìº¡ì²˜ í™”ë©´ ===== -->
      <section class="screen" id="screen-capture">
        <div class="section-title">ìº¡ì²˜ë¡œ ë‹µì¥ ë§Œë“¤ê¸°</div>
        <div class="section-sub">ì¹´í†¡ ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´, ìƒí™©ì„ ì½ê³  ì–´ìš¸ë¦¬ëŠ” ë‹µì¥ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</div>
        <div class="section-desc">ì´ë¯¸ì§€ ì¸ì‹ íŠ¹ì„±ìƒ, ì¸ì‹ì´ ì™„ë²½í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”.</div>

        <div class="field-label">ìƒí™© ì„ íƒ</div>
        <div class="tone-grid" id="toneGridCapture">
          <button type="button" class="tone-btn" data-tone="ì—°ì• ">ì—°ì• </button>
          <button type="button" class="tone-btn" data-tone="ì¸">ì¸</button>
          <button type="button" class="tone-btn" data-tone="ì¹œêµ¬">ì¹œêµ¬</button>
          <button type="button" class="tone-btn" data-tone="ì§ì¥">ì§ì¥</button>
          <button type="button" class="tone-btn" data-tone="ê°€ì¡±">ê°€ì¡±</button>
          <button type="button" class="tone-btn" data-tone="ê¸°íƒ€">ê¸°íƒ€</button>
        </div>

        <div class="capture-box">
          <div>ì¹´í†¡ ëŒ€í™”ê°€ ì˜ ë³´ì´ë„ë¡ ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
          <input class="capture-input" id="captureInput" type="file" accept="image/*" />
          <div class="capture-preview" id="capturePreview" style="display:none;">
            <img id="capturePreviewImg" alt="ìº¡ì²˜ ë¯¸ë¦¬ë³´ê¸°" />
          </div>
        </div>

        <button class="btn-primary" id="generateFromCaptureBtn" type="button">
          ìº¡ì²˜ë¡œ AI ë‹µì¥ ë§Œë“¤ê¸°
        </button>
        <div class="status-text" id="captureStatus"></div>
      </section>
    </section>

    <!-- í•˜ë‹¨ íƒ­ë°” -->
    <div class="tabbar">
      <div class="tabbar-inner">
        <div class="tabbar-bg">
          <button class="tab-btn active" data-tab="home" type="button">
            <span class="label">í™ˆ</span>
          </button>
          <button class="tab-btn" data-tab="reply" type="button">
            <span class="label">ë‹µì¥ ë§Œë“¤ê¸°</span>
          </button>
          <button class="tab-btn" data-tab="capture" type="button">
            <span class="label">ìº¡ì²˜</span>
          </button>
          <button class="tab-btn" data-tab="mystyle" type="button">
            <span class="label">ë‚´ ë§íˆ¬</span>
          </button>
          <button class="tab-btn" data-tab="favorites" type="button">
            <span class="label">ì¦ê²¨ì°¾ê¸°</span>
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // ===== í™”ë©´ ê´€ë¦¬ & íˆìŠ¤í† ë¦¬ (í° ë’¤ë¡œê°€ê¸° ì§€ì›) =====
    const screens = {
      home: document.getElementById("screen-home"),
      reply: document.getElementById("screen-reply"),
      result: document.getElementById("screen-result"),
      mystyle: document.getElementById("screen-mystyle"),
      favorites: document.getElementById("screen-favorites"),
      capture: document.getElementById("screen-capture"),
    };

    let currentScreen = "home";
    let lastResultSource = "text"; // "text" | "capture"

    function setScreen(name) {
      Object.entries(screens).forEach(([key, el]) => {
        if (!el) return;
        el.classList.toggle("active", key === name);
      });
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.tab === name);
      });
      currentScreen = name;
    }

    function showScreen(name, push = true) {
      if (!screens[name]) return;
      setScreen(name);
      if (push) {
        history.pushState({ screen: name }, "", "");
      }
    }

    // ì´ˆê¸° íˆìŠ¤í† ë¦¬ ì„¸íŒ…
    window.addEventListener("load", () => {
      if (!history.state || !history.state.screen) {
        history.replaceState({ screen: "home" }, "", "");
      } else {
        const scr = history.state.screen;
        if (screens[scr]) setScreen(scr);
        else setScreen("home");
      }
    });

    // í° ë’¤ë¡œê°€ê¸°(popstate)
    window.addEventListener("popstate", (event) => {
      const state = event.state;
      if (state && state.screen && screens[state.screen]) {
        setScreen(state.screen);
      } else {
        // homeì—ì„œ í•œ ë²ˆ ë” ë’¤ë¡œ â†’ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘(ì¢…ë£Œ)
        setScreen("home");
      }
    });

    // íƒ­ë°”
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;
        if (tab === "result") return;
        // ì´ë¯¸ ê·¸ í™”ë©´ì´ë©´ íˆìŠ¤í† ë¦¬ ì•ˆ ìŒ“ë„ë¡
        if (tab === currentScreen) return;
        showScreen(tab);
      });
    });

    // í™ˆ ì¹´ë“œ í´ë¦­
    document.querySelectorAll(".home-item").forEach(item => {
      item.addEventListener("click", () => {
        const go = item.dataset.go;
        if (!go) return;
        if (go === currentScreen) return;
        if (go === "favorites") refreshFavorites();
        showScreen(go);
      });
    });

    // ===== í…ìŠ¤íŠ¸ ë‹µì¥ ìƒì„± =====
    let selectedToneText = "ì¹œêµ¬";
    let selectedToneCapture = "ì¹œêµ¬";
    let lastMessageText = "";

    const toneGridText = document.getElementById("toneGridText");
    const toneBtnsText = Array.from(toneGridText.querySelectorAll(".tone-btn"));
    toneBtnsText.forEach(btn => {
      btn.addEventListener("click", () => {
        toneBtnsText.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedToneText = btn.dataset.tone || "ì¹œêµ¬";
        statusText.textContent = "";
      });
    });
    (toneBtnsText.find(b => b.dataset.tone === "ì¹œêµ¬") || toneBtnsText[0])?.classList.add("selected");

    const toneGridCapture = document.getElementById("toneGridCapture");
    const toneBtnsCapture = Array.from(toneGridCapture.querySelectorAll(".tone-btn"));
    toneBtnsCapture.forEach(btn => {
      btn.addEventListener("click", () => {
        toneBtnsCapture.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedToneCapture = btn.dataset.tone || "ì¹œêµ¬";
        captureStatus.textContent = "";
      });
    });
    (toneBtnsCapture.find(b => b.dataset.tone === "ì¹œêµ¬") || toneBtnsCapture[0])?.classList.add("selected");

    const messageText = document.getElementById("messageText");
    const generateTextBtn = document.getElementById("generateTextBtn");
    const statusText = document.getElementById("statusText");

    const toneChipCurrent = document.getElementById("toneChipCurrent");
    const resultTitle = document.getElementById("resultTitle");
    const resultTopText = document.getElementById("resultTopText");
    const resultStatusText = document.getElementById("resultStatusText");
    const resultOriginalText = document.getElementById("resultOriginalText");
    const answersEl = document.getElementById("answers");

    function parseLine(line) {
      const parts = line.split("||").map(p => p.trim());
      return {
        text: parts[0] || "",
        risk: parts[1] || "",
        sense: parts[2] || "",
        comment: parts[3] || ""
      };
    }

    function formatScore(raw, label) {
      if (!raw) return "";
      const s = raw.toString().trim();
      if (!s) return "";
      if (/^\d+$/.test(s)) return `${label} ${s}`;
      if (s.includes(label)) return s;
      return `${label} ${s}`;
    }

    function showSkeleton() {
      answersEl.innerHTML = "";
      for (let i = 0; i < 3; i++) {
        const sk = document.createElement("div");
        sk.className = "skeleton-item";
        sk.innerHTML = `
          <div class="skeleton-line long"></div>
          <div class="skeleton-line mid"></div>
          <div class="skeleton-line short"></div>
        `;
        answersEl.appendChild(sk);
      }
    }

    async function callReplyAPI(text, tone) {
      try {
        const res = await fetch("/reply", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, tone })
        });
        let data = {};
        try { data = await res.json(); } catch (e) {}

        if (!res.ok) {
          resultStatusText.textContent = data.error || "ë‹µì¥ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          answersEl.innerHTML = "";
          return;
        }

        const raw = (data.reply || data.replies || "").toString();
        const lines = raw
          .split("\n")
          .map(l => l.trim())
          .filter(Boolean)
          .slice(0, 3);

        answersEl.innerHTML = "";

        if (lines.length === 0) {
          resultTopText.textContent = "ìƒì„±ëœ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤.";
          resultStatusText.textContent = "ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ë³´ì„¸ìš”.";
          return;
        }

        resultTopText.textContent = "AI ì¶”ì²œ ë‹µì¥ì´ ì¤€ë¹„ëì–´ìš”!";
        resultStatusText.textContent = "ë§ˆìŒì— ë“œëŠ” ë‹µì¥ì„ ê³¨ë¼ì„œ ë³µì‚¬í•´ ì‚¬ìš©í•´ ë³´ì„¸ìš”.";

        lines.forEach((line, idx) => {
          const { text: rawText, risk, sense, comment } = parseLine(line);
          const answerText = rawText.replace(/^\d+\.\s*/, "").trim() || rawText.trim();

          const riskLabel  = formatScore(risk, "ìœ„í—˜ë„");
          const senseLabel = formatScore(sense, "ì„¼ìŠ¤");

          const wrapper = document.createElement("div");
          wrapper.className = "answer-item";
          wrapper.dataset.text = answerText;
          wrapper.dataset.risk = riskLabel;
          wrapper.dataset.sense = senseLabel;
          wrapper.dataset.comment = comment || "";
          wrapper.dataset.tone = toneChipCurrent.textContent || "";

          wrapper.innerHTML = `
            <div class="answer-top-row">
              <div class="answer-text">${idx + 1}. ${answerText}</div>
              <button class="favorite-btn" type="button">â˜… ì¦ê²¨ì°¾ê¸°</button>
              <button class="copy-btn" type="button">ë³µì‚¬</button>
            </div>
            <div class="chips">
              ${riskLabel ? `<span class="chip chip-risk">${riskLabel}</span>` : ""}
              ${senseLabel ? `<span class="chip chip-sense">${senseLabel}</span>` : ""}
            </div>
            ${comment ? `<div class="comment-text">${comment}</div>` : ""}
          `;

          const favBtn = wrapper.querySelector(".favorite-btn");
          const copyBtn = wrapper.querySelector(".copy-btn");

          favBtn.addEventListener("click", () => toggleFavoriteFromCard(wrapper, favBtn));
          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(answerText).then(() => {
              copyBtn.textContent = "ë³µì‚¬ë¨";
              setTimeout(() => (copyBtn.textContent = "ë³µì‚¬"), 1200);
            });
          });

          answersEl.appendChild(wrapper);
        });
      } catch (err) {
        console.error(err);
        resultStatusText.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        answersEl.innerHTML = "";
      }
    }

    function startTextFlow() {
      const text = messageText.value.trim();
      if (!text) {
        statusText.textContent = "ë¨¼ì € ìƒëŒ€ë°© ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        return;
      }
      statusText.textContent = "";

      lastMessageText = text;
      lastResultSource = "text";

      toneChipCurrent.textContent = `${selectedToneText} í†¤`;
      resultTitle.textContent = "AI ì¶”ì²œ ë‹µì¥";
      resultTopText.textContent = "AI ì¶”ì²œ ë‹µì¥ì´ ì¤€ë¹„ë˜ëŠ” ì¤‘ì´ì—ìš”...";
      resultStatusText.textContent = "AIê°€ ë‹µì¥ì„ ë§Œë“œëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.";
      resultOriginalText.textContent = text;

      showScreen("result");
      showSkeleton();
      callReplyAPI(text, selectedToneText);
    }

    generateTextBtn.addEventListener("click", startTextFlow);

    // ===== ìº¡ì²˜ ë‹µì¥ ìƒì„± =====
    const captureInput = document.getElementById("captureInput");
    const capturePreview = document.getElementById("capturePreview");
    const capturePreviewImg = document.getElementById("capturePreviewImg");
    const generateFromCaptureBtn = document.getElementById("generateFromCaptureBtn");
    const captureStatus = document.getElementById("captureStatus");

    captureInput.addEventListener("change", () => {
      const file = captureInput.files && captureInput.files[0];
      if (!file) {
        capturePreview.style.display = "none";
        return;
      }
      const reader = new FileReader();
      reader.onload = e => {
        capturePreviewImg.src = e.target.result;
        capturePreview.style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    async function callCaptureAPI(file, tone) {
      try {
        const form = new FormData();
        form.append("image", file);
        form.append("tone", tone);

        const res = await fetch("/capture-reply", {
          method: "POST",
          body: form
        });

        let data = {};
        try { data = await res.json(); } catch (e) {}

        if (!res.ok) {
          resultStatusText.textContent = data.error || "ìº¡ì²˜ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          answersEl.innerHTML = "";
          return;
        }

        const raw = (data.reply || data.replies || "").toString();
        const lines = raw
          .split("\n")
          .map(l => l.trim())
          .filter(Boolean)
          .slice(0, 3);

        answersEl.innerHTML = "";

        if (lines.length === 0) {
          resultTopText.textContent = "ìƒì„±ëœ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤.";
          resultStatusText.textContent = "ìº¡ì²˜ ì´ë¯¸ì§€ê°€ ì˜ ë³´ì´ê²Œ ë‹¤ì‹œ ì˜¬ë ¤ ë³´ì„¸ìš”.";
          return;
        }

        resultTopText.textContent = "AI ì¶”ì²œ ë‹µì¥ì´ ì¤€ë¹„ëì–´ìš”!";
        resultStatusText.textContent = "ìº¡ì²˜ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” ë‹µì¥ì„ ê³¨ë¼ ë³´ì„¸ìš”.";

        lines.forEach((line, idx) => {
          const { text: rawText, risk, sense, comment } = parseLine(line);
          const answerText = rawText.replace(/^\d+\.\s*/, "").trim() || rawText.trim();

          const riskLabel  = formatScore(risk, "ìœ„í—˜ë„");
          const senseLabel = formatScore(sense, "ì„¼ìŠ¤");

          const wrapper = document.createElement("div");
          wrapper.className = "answer-item";
          wrapper.dataset.text = answerText;
          wrapper.dataset.risk = riskLabel;
          wrapper.dataset.sense = senseLabel;
          wrapper.dataset.comment = comment || "";
          wrapper.dataset.tone = toneChipCurrent.textContent || "";

          wrapper.innerHTML = `
            <div class="answer-top-row">
              <div class="answer-text">${idx + 1}. ${answerText}</div>
              <button class="favorite-btn" type="button">â˜… ì¦ê²¨ì°¾ê¸°</button>
              <button class="copy-btn" type="button">ë³µì‚¬</button>
            </div>
            <div class="chips">
              ${riskLabel ? `<span class="chip chip-risk">${riskLabel}</span>` : ""}
              ${senseLabel ? `<span class="chip chip-sense">${senseLabel}</span>` : ""}
            </div>
            ${comment ? `<div class="comment-text">${comment}</div>` : ""}
          `;

          const favBtn = wrapper.querySelector(".favorite-btn");
          const copyBtn = wrapper.querySelector(".copy-btn");

          favBtn.addEventListener("click", () => toggleFavoriteFromCard(wrapper, favBtn));
          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(answerText).then(() => {
              copyBtn.textContent = "ë³µì‚¬ë¨";
              setTimeout(() => (copyBtn.textContent = "ë³µì‚¬"), 1200);
            });
          });

          answersEl.appendChild(wrapper);
        });
      } catch (err) {
        console.error(err);
        resultStatusText.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        answersEl.innerHTML = "";
      }
    }

    function startCaptureFlow() {
      const file = captureInput.files && captureInput.files[0];
      if (!file) {
        captureStatus.textContent = "ë¨¼ì € ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
        return;
      }
      captureStatus.textContent = "";

      lastMessageText = "";
      lastResultSource = "capture";

      toneChipCurrent.textContent = `${selectedToneCapture} í†¤`;
      resultTitle.textContent = "ìº¡ì²˜ ê¸°ë°˜ AI ì¶”ì²œ ë‹µì¥";
      resultTopText.textContent = "ìº¡ì²˜ë¥¼ ë¶„ì„í•´ì„œ ë‹µì¥ì„ ë§Œë“œëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      resultStatusText.textContent = "ì´ë¯¸ì§€ì—ì„œ ëŒ€í™”ë¥¼ ì½ëŠ” ì¤‘ì´ì—ìš”. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.";
      resultOriginalText.textContent = "ì˜¬ë ¤ì£¼ì‹  ìº¡ì²˜ ì´ë¯¸ì§€ì˜ ëŒ€í™”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹µì¥ì„ ì¶”ì²œí•©ë‹ˆë‹¤.";

      showScreen("result");
      showSkeleton();
      callCaptureAPI(file, selectedToneCapture);
    }

    generateFromCaptureBtn.addEventListener("click", startCaptureFlow);

    // ê²°ê³¼ í™”ë©´ ë²„íŠ¼
    document.getElementById("backFromResult").addEventListener("click", () => {
      // ë‚´ë¶€ ë’¤ë¡œê°€ê¸° â†’ ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬ í•œ ë‹¨ê³„ ë’¤ë¡œ
      history.back();
    });

    document.getElementById("goHomeFromResult").addEventListener("click", () => {
      showScreen("home");
    });

    document.getElementById("regenerateBtn").addEventListener("click", () => {
      if (lastResultSource === "capture") {
        const file = captureInput.files && captureInput.files[0];
        if (!file) return;
        resultTopText.textContent = "ìº¡ì²˜ë¥¼ ë‹¤ì‹œ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
        resultStatusText.textContent = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.";
        showSkeleton();
        callCaptureAPI(file, selectedToneCapture);
      } else {
        if (!lastMessageText) return;
        resultTopText.textContent = "AI ì¶”ì²œ ë‹µì¥ì„ ë‹¤ì‹œ ë§Œë“œëŠ” ì¤‘ì…ë‹ˆë‹¤...";
        resultStatusText.textContent = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.";
        showSkeleton();
        callReplyAPI(lastMessageText, selectedToneText);
      }
    });

    // ===== ë‚´ ë§íˆ¬ localStorage =====
    const myStyleMain = document.getElementById("myStyleMain");
    const myStyleDesc = document.getElementById("myStyleDesc");
    const saveMyStyleBtn = document.getElementById("saveMyStyleBtn");
    const myStyleStatus = document.getElementById("myStyleStatus");
    const myStyleList = document.getElementById("myStyleList");
    const myStyleEmpty = document.getElementById("myStyleEmpty");

    function loadMyStyles() {
      try {
        return JSON.parse(localStorage.getItem("aiCoachMyStyle") || "[]");
      } catch {
        return [];
      }
    }

    function saveMyStyles(arr) {
      localStorage.setItem("aiCoachMyStyle", JSON.stringify(arr));
    }

    function renderMyStyles() {
      const list = loadMyStyles();
      myStyleList.innerHTML = "";
      if (list.length === 0) {
        myStyleEmpty.style.display = "block";
        return;
      }
      myStyleEmpty.style.display = "none";
      list.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "my-style-row";
        row.innerHTML = `
          <div class="my-style-main">${item.text}</div>
          ${item.desc ? `<div class="my-style-sub">${item.desc}</div>` : ""}
          <div class="small-btn-row">
            <button class="small-btn" data-idx="${idx}" data-action="copy">ë³µì‚¬</button>
            <button class="small-btn" data-idx="${idx}" data-action="delete">ì‚­ì œ</button>
          </div>
        `;
        row.addEventListener("click", e => {
          const btn = e.target.closest(".small-btn");
          if (!btn) return;
          const idx = parseInt(btn.dataset.idx, 10);
          const action = btn.dataset.action;
          const current = loadMyStyles();
          if (action === "copy") {
            navigator.clipboard.writeText(current[idx].text || "").then(() => {
              myStyleStatus.textContent = "í‘œí˜„ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.";
              setTimeout(() => (myStyleStatus.textContent = ""), 1200);
            });
          } else if (action === "delete") {
            current.splice(idx, 1);
            saveMyStyles(current);
            renderMyStyles();
          }
        });
        myStyleList.appendChild(row);
      });
    }

    saveMyStyleBtn.addEventListener("click", () => {
      const text = myStyleMain.value.trim();
      const desc = myStyleDesc.value.trim();
      if (!text) {
        myStyleStatus.textContent = "ë¨¼ì € ë‚´ í‘œí˜„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        return;
      }
      const list = loadMyStyles();
      list.unshift({
        text,
        desc,
        createdAt: Date.now()
      });
      saveMyStyles(list);
      myStyleMain.value = "";
      myStyleDesc.value = "";
      myStyleStatus.textContent = "ë‚´ ë§íˆ¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.";
      renderMyStyles();
      setTimeout(() => (myStyleStatus.textContent = ""), 1500);
    });

    // ===== ì¦ê²¨ì°¾ê¸° localStorage =====
    function loadFavorites() {
      try {
        return JSON.parse(localStorage.getItem("aiCoachFavorites") || "[]");
      } catch {
        return [];
      }
    }

    function saveFavorites(arr) {
      localStorage.setItem("aiCoachFavorites", JSON.stringify(arr));
    }

    function toggleFavoriteFromCard(card, favBtn) {
      const text = card.dataset.text || "";
      if (!text) return;
      const risk = card.dataset.risk || "";
      const sense = card.dataset.sense || "";
      const comment = card.dataset.comment || "";
      const tone = card.dataset.tone || "";

      let favs = loadFavorites();
      const idx = favs.findIndex(f => f.text === text && f.tone === tone);
      if (idx >= 0) {
        favs.splice(idx, 1);
        favBtn.classList.remove("active");
        saveFavorites(favs);
      } else {
        favs.unshift({
          text,
          risk,
          sense,
          comment,
          tone,
          createdAt: Date.now()
        });
        favBtn.classList.add("active");
        saveFavorites(favs);
      }
    }

    const favList = document.getElementById("favList");
    const favEmpty = document.getElementById("favEmpty");

    function refreshFavorites() {
      const favs = loadFavorites();
      favList.innerHTML = "";
      if (favs.length === 0) {
        favEmpty.style.display = "block";
        return;
      }
      favEmpty.style.display = "none";
      favs.forEach((f, idx) => {
        const row = document.createElement("div");
        row.className = "fav-row";
        const toneText = f.tone || "";
        row.innerHTML = `
          <div class="fav-main">${idx + 1}. ${f.text}</div>
          <div class="fav-meta">
            ${toneText ? `${toneText} Â· ` : ""}${f.risk || ""}${f.risk && f.sense ? " Â· " : ""}${f.sense || ""}
          </div>
          ${f.comment ? `<div class="comment-text">${f.comment}</div>` : ""}
          <div class="small-btn-row">
            <button class="small-btn" data-idx="${idx}" data-action="copy">ë³µì‚¬</button>
            <button class="small-btn" data-idx="${idx}" data-action="delete">ì‚­ì œ</button>
          </div>
        `;
        row.addEventListener("click", e => {
          const btn = e.target.closest(".small-btn");
          if (!btn) return;
          const i = parseInt(btn.dataset.idx, 10);
          const action = btn.dataset.action;
          const current = loadFavorites();
          if (action === "copy") {
            navigator.clipboard.writeText(current[i].text || "");
          } else if (action === "delete") {
            current.splice(i, 1);
            saveFavorites(current);
            refreshFavorites();
          }
        });
        favList.appendChild(row);
      });
    }

    // ì´ˆê¸° ë Œë”
    renderMyStyles();
    refreshFavorites();
  </script>
</body>
</html>
