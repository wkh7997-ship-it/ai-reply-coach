<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ëŒ€í™” ì½”ì¹˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json" />

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --bg1: #050816;
      --bg2: #3b1d6a;
      --card-bg: rgba(8, 12, 32, 0.96);
      --border: rgba(255, 255, 255, 0.12);
      --text-main: #f9fafb;
      --text-sub: #a5b4fc;
      --text-muted: #9ca3af;
      --safe: #22c55e;
      --warn: #eab308;
      --danger: #f97316;
      --radius-xl: 24px;
      --radius-lg: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #3b1d6a 0, #050816 45%, #020617 100%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px 28px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 20px 18px 22px;
    }

    @media (min-width: 420px) {
      .card {
        padding: 24px 22px 26px;
      }
    }

    .app-header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }

    .app-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 11px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      width: fit-content;
      font-size: 11px;
      letter-spacing: 0.02em;
      color: var(--text-sub);
      text-transform: uppercase;
    }

    .app-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .title-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #a855f7, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .title-icon span {
      font-size: 16px;
    }

    .title-text h1 {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.03em;
    }

    .title-text p {
      margin-top: 2px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .badge-beta {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.75);
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .section-title span {
      font-size: 11px;
      font-weight: 400;
      color: var(--text-muted);
    }

    label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 5px;
      display: block;
    }

    select,
    textarea {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    select {
      height: 40px;
    }

    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.6);
      background: rgba(15, 23, 42, 0.95);
    }

    textarea {
      resize: vertical;
      min-height: 90px;
      max-height: 220px;
      line-height: 1.55;
    }

    .field-group {
      margin-bottom: 14px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .btn-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 16px;
      padding: 11px 14px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: white;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      box-shadow: 0 14px 30px rgba(79, 70, 229, 0.55);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.08s ease;
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.5);
      opacity: 0.95;
    }

    .btn-primary[disabled] {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
    }

    .btn-secondary span {
      font-size: 10px;
    }

    .btn-secondary:active {
      opacity: 0.8;
    }

    .status-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .status-text strong {
      color: var(--text-sub);
      font-weight: 500;
    }

    .error-banner {
      margin-top: 8px;
      border-radius: 12px;
      padding: 7px 9px;
      font-size: 11px;
      background: rgba(248, 113, 113, 0.09);
      border: 1px solid rgba(248, 113, 113, 0.6);
      color: #fecaca;
      display: none;
    }

    .error-banner.visible {
      display: block;
    }

    /* ê²°ê³¼ ì˜ì—­ */

    .result-section {
      margin-top: 18px;
      padding-top: 12px;
      border-top: 1px dashed rgba(148, 163, 184, 0.45);
    }

    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .result-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .result-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .result-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .result-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: var(--text-sub);
    }

    .replies {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .reply-card {
      position: relative;
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(79, 70, 229, 0.18), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 10px 11px 10px 11px;
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 8px;
    }

    .reply-accent {
      width: 3px;
      border-radius: 999px;
      background: var(--safe);
      margin-right: 6px;
      grid-row: 1 / span 2;
    }

    .reply-content {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .reply-text {
      font-size: 14px;
      line-height: 1.55;
      padding-right: 54px;
    }

    .reply-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .pill-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .pill {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.85);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #e5e7eb;
    }

    .pill-label {
      font-size: 9px;
      text-transform: uppercase;
      opacity: 0.7;
    }

    .pill-value {
      font-weight: 600;
      font-size: 10px;
    }

    .pill-risk-low {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .pill-risk-mid {
      border-color: rgba(234, 179, 8, 0.8);
      color: #fef3c7;
    }

    .pill-risk-high {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fee2e2;
    }

    .pill-sense {
      border-color: rgba(129, 140, 248, 0.8);
      color: #e0e7ff;
    }

    .pill-desc {
      max-width: 56%;
      color: var(--text-muted);
    }

    .copy-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      border: none;
      border-radius: 999px;
      padding: 5px 9px;
      font-size: 11px;
      background: rgba(79, 70, 229, 0.18);
      color: #e0e7ff;
      border: 1px solid rgba(129, 140, 248, 0.9);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .copy-btn span {
      font-size: 11px;
    }

    .copy-btn:active {
      transform: translateY(1px);
      opacity: 0.9;
    }

    /* í† ìŠ¤íŠ¸ */

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(80px);
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(129, 140, 248, 0.9);
      color: #e5e7eb;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.9);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.2s ease, opacity 0.2s ease;
      z-index: 40;
    }

    .toast-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
    }

    /* ë¹ˆ ìƒíƒœ í…ìŠ¤íŠ¸ */

    .empty-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <main class="app-shell">
    <section class="card">
      <header class="app-header">
        <div class="app-pill">
          <div class="app-pill-dot"></div>
          AI ëŒ€í™” ì½”ì¹˜ Â· ì¹´í†¡ ë‹µì¥ ë„ìš°ë¯¸
        </div>

        <div class="title-row">
          <div class="title-main">
            <div class="title-icon">
              <span>ğŸ’¬</span>
            </div>
            <div class="title-text">
              <h1>AI ëŒ€í™” ì½”ì¹˜</h1>
              <p>ì¹´í†¡ ë‹µì¥, ê°™ì´ ìƒê°í•´ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</p>
            </div>
          </div>
          <div class="badge-beta">ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ í‘œì‹œ</div>
        </div>
      </header>

      <section>
        <div class="section-title">
          ìƒí™© ì„ íƒ
          <span>ëŒ€í™” ìƒëŒ€ì— ë§ëŠ” í†¤ì„ ê³¨ë¼ì£¼ì„¸ìš”.</span>
        </div>
        <div class="field-group">
          <label for="tone">ìƒí™©</label>
          <select id="tone">
            <option value="ê¸°ë³¸">ê¸°ë³¸ Â· ë¬´ë‚œí•œ ë‹µì¥</option>
            <option value="ì—°ì• ">ì—°ì•  Â· ì¸ / í˜¸ê° ìƒëŒ€</option>
            <option value="ì§ì¥">ì§ì¥ Â· ìƒì‚¬ / ë™ë£Œ</option>
            <option value="ì¹œêµ¬">ì¹œêµ¬ Â· í¸í•œ ì‚¬ì´</option>
            <option value="ê°€ì¡±">ê°€ì¡± Â· ì†”ì§í•˜ì§€ë§Œ ë”°ëœ»í•˜ê²Œ</option>
          </select>
        </div>

        <div class="section-title" style="margin-top: 10px;">
          ìƒëŒ€ë°© ë©”ì‹œì§€
          <span>ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.</span>
        </div>
        <div class="field-group">
          <label for="message">ìƒëŒ€ë°©ì´ ë³´ë‚¸ ë©”ì‹œì§€</label>
          <textarea id="message" placeholder="ì˜ˆ) ì˜¤ëŠ˜ ë­í• ê¹Œ?&#10;í˜¹ì€ ìƒëŒ€ê°€ ë³´ë‚¸ ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”."></textarea>
          <p class="hint">ëŒ€í™” íë¦„ì„ ê°™ì´ ë„£ì–´ì£¼ë©´ ë” ìì—°ìŠ¤ëŸ¬ìš´ ë‹µì¥ì´ ë§Œë“¤ì–´ì ¸ìš”.</p>
        </div>

        <div class="btn-row">
          <button id="generateBtn" class="btn-primary">
            <span id="generateLabel">ë‹µì¥ ìƒì„±</span>
          </button>
          <button id="resetBtn" type="button" class="btn-secondary">
            â†º ë‹¤ì‹œ ì…ë ¥í•˜ê¸°
          </button>
          <p class="status-text">
            <strong>Tip.</strong> ì¡°ê¸ˆ ì• ë§¤í•œ ë‹µì¥ì€ ë³µì‚¬ í›„ ì§ì ‘ í•œë‘ ë‹¨ì–´ë§Œ ê³ ì³ ì¨ë„ ì¶©ë¶„í•´ìš”.
          </p>
          <div id="errorBanner" class="error-banner"></div>
        </div>
      </section>

      <section class="result-section" id="resultSection" style="display:none;">
        <div class="result-header">
          <div class="result-header-left">
            <div class="result-title">AI ì¶”ì²œ ë‹µì¥</div>
            <div class="result-sub">ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ë¥¼ ì°¸ê³ í•´ ê³¨ë¼ ì“°ì„¸ìš”.</div>
          </div>
          <div class="result-chip" id="toneChip">ê¸°ë³¸ í†¤</div>
        </div>

        <div class="replies" id="repliesContainer">
          <!-- JSê°€ ì¹´ë“œ 3ê°œë¥¼ ë Œë”ë§ -->
        </div>

        <p class="empty-hint" id="emptyHint" style="display:none;">
          ì•„ì§ ìƒì„±ëœ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ê³  &lt;ë‹µì¥ ìƒì„±&gt;ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </p>
      </section>
    </section>

    <div class="toast" id="toast">
      <div class="toast-dot"></div>
      <span id="toastMessage">í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
    </div>
  </main>

  <script>
    const toneSelect = document.getElementById("tone");
    const messageInput = document.getElementById("message");
    const generateBtn = document.getElementById("generateBtn");
    const generateLabel = document.getElementById("generateLabel");
    const resetBtn = document.getElementById("resetBtn");
    const resultSection = document.getElementById("resultSection");
    const repliesContainer = document.getElementById("repliesContainer");
    const toneChip = document.getElementById("toneChip");
    const errorBanner = document.getElementById("errorBanner");
    const emptyHint = document.getElementById("emptyHint");
    const toast = document.getElementById("toast");
    const toastMessage = document.getElementById("toastMessage");

    function setLoading(isLoading) {
      if (isLoading) {
        generateBtn.disabled = true;
        generateLabel.textContent = "ìƒì„± ì¤‘...";
      } else {
        generateBtn.disabled = false;
        generateLabel.textContent = "ë‹µì¥ ìƒì„±";
      }
    }

    function showError(msg) {
      errorBanner.textContent = msg;
      errorBanner.classList.add("visible");
    }

    function clearError() {
      errorBanner.textContent = "";
      errorBanner.classList.remove("visible");
    }

    function showToast(msg) {
      toastMessage.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 1600);
    }

    function riskClass(risk) {
      const n = Number(risk);
      if (isNaN(n)) return "pill-risk-mid";
      if (n <= 30) return "pill-risk-low";
      if (n <= 60) return "pill-risk-mid";
      return "pill-risk-high";
    }

    function accentColor(risk) {
      const n = Number(risk);
      if (isNaN(n)) return "var(--warn)";
      if (n <= 30) return "var(--safe)";
      if (n <= 60) return "var(--warn)";
      return "var(--danger)";
    }

    function renderReplies(lines) {
      repliesContainer.innerHTML = "";

      if (!lines || !lines.length) {
        resultSection.style.display = "block";
        emptyHint.style.display = "block";
        return;
      }

      emptyHint.style.display = "none";
      resultSection.style.display = "block";

      lines.forEach((line, idx) => {
        const trimmed = line.trim();
        if (!trimmed) return;

        const parts = trimmed.split("||").map(p => p.trim());
        const sentence = parts[0] || "";
        const risk = parts[1] || "?";
        const sense = parts[2] || "?";
        const desc = parts[3] || "";

        const card = document.createElement("article");
        card.className = "reply-card";

        const accent = document.createElement("div");
        accent.className = "reply-accent";
        accent.style.background = accentColor(risk);

        const content = document.createElement("div");
        content.className = "reply-content";

        const textEl = document.createElement("div");
        textEl.className = "reply-text";
        textEl.textContent = sentence;

        const metaRow = document.createElement("div");
        metaRow.className = "reply-meta-row";

        const pillRowEl = document.createElement("div");
        pillRowEl.className = "pill-row";

        const pillRisk = document.createElement("div");
        pillRisk.className = `pill ${riskClass(risk)}`;
        pillRisk.innerHTML = `<span class="pill-label">ìœ„í—˜ë„</span><span class="pill-value">${risk}</span>`;

        const pillSense = document.createElement("div");
        pillSense.className = "pill pill-sense";
        pillSense.innerHTML = `<span class="pill-label">ì„¼ìŠ¤</span><span class="pill-value">${sense}</span>`;

        pillRowEl.appendChild(pillRisk);
        pillRowEl.appendChild(pillSense);

        const descEl = document.createElement("div");
        descEl.className = "pill pill-desc";
        descEl.textContent = desc || "í†¤ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì…ë‹ˆë‹¤.";

        metaRow.appendChild(pillRowEl);
        metaRow.appendChild(descEl);

        const copyBtn = document.createElement("button");
        copyBtn.className = "copy-btn";
        copyBtn.type = "button";
        copyBtn.innerHTML = `<span>ë³µì‚¬</span>`;
        copyBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(sentence);
            showToast("ë‹µì¥ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
          } catch (e) {
            showToast("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ê¸¸ê²Œ ëˆŒëŸ¬ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
          }
        });

        content.appendChild(textEl);
        content.appendChild(metaRow);

        card.appendChild(accent);
        card.appendChild(content);
        card.appendChild(copyBtn);

        repliesContainer.appendChild(card);
      });
    }

    generateBtn.addEventListener("click", async () => {
      clearError();
      const text = messageInput.value.trim();
      const tone = toneSelect.value;

      if (!text) {
        showError("ë¨¼ì € ìƒëŒ€ë°© ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        messageInput.focus();
        return;
      }

      setLoading(true);

      try {
        const res = await fetch("/reply", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text, tone })
        });

        const data = await res.json();

        if (!res.ok) {
          console.error("API error:", data);
          showError("AI ë‹µì¥ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
          setLoading(false);
          return;
        }

        const raw = (data.reply || "").trim();
        const lines = raw.split(/\r?\n/).filter(l => l.trim().length > 0);

        toneChip.textContent = `${tone} í†¤`;
        renderReplies(lines);
        showToast("AI ì¶”ì²œ ë‹µì¥ì„ ìƒì„±í–ˆì–´ìš”.");
      } catch (err) {
        console.error(err);
        showError("ì„œë²„ì™€ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.");
      } finally {
        setLoading(false);
      }
    });

    resetBtn.addEventListener("click", () => {
      messageInput.value = "";
      messageInput.focus();
      repliesContainer.innerHTML = "";
      resultSection.style.display = "none";
      emptyHint.style.display = "none";
      clearError();
    });

    // PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ (ìˆëŠ” ê²½ìš°ë§Œ)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("/service-worker.js")
          .catch((err) => {
            console.warn("Service worker registration failed:", err);
          });
      });
    }
  </script>
</body>
</html>


