<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ëŒ€í™” ì½”ì¹˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-soft: #a855f7;
      --bg1: #050816;
      --bg2: #111827;
      --card-bg: rgba(8, 12, 32, 0.96);
      --text-main: #f9fafb;
      --text-sub: #a5b4fc;
      --border: rgba(148, 163, 184, 0.35);
      --safe: #22c55e;
      --warn: #eab308;
      --danger: #ef4444;
      --nav-bg: rgba(15, 23, 42, 0.98);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html, body {
      height: 100%;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #4c1d95 0, rgba(76, 29, 149, 0.4) 20%, transparent 40%),
        radial-gradient(circle at bottom, #020617 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: calc(20px + env(safe-area-inset-top, 0px)) 12px calc(20px + env(safe-area-inset-bottom, 0px));
      -webkit-text-size-adjust: 100%;
    }

    .app {
      width: 100%;
      max-width: 480px;
      border-radius: 32px;
      background: radial-gradient(circle at top left, rgba(79, 70, 229, 0.25) 0, rgba(15, 23, 42, 0.98) 42%, #020617 100%);
      box-shadow:
        0 28px 80px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .app-inner {
      flex: 1;
      padding: 20px 18px 12px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ê³µí†µ ì¹´ë“œ */

    .card {
      background: var(--card-bg);
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 18px 18px 20px;
      box-shadow:
        0 22px 60px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    /* í—¤ë” */

    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 18px;
    }

    .header-icon {
      width: 44px;
      height: 44px;
      border-radius: 18px;
      padding: 2px;
      background: radial-gradient(circle at 30% 20%, #f9a8ff 0, #4c1d95 45%, #020617 100%);
      box-shadow:
        0 8px 20px rgba(129, 140, 248, 0.9),
        0 0 0 1px rgba(59, 130, 246, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-icon-inner {
      width: 100%;
      height: 100%;
      border-radius: 15px;
      background:
        radial-gradient(circle at 30% 20%, #f9fafb 0, #e5e7eb 35%, #4c1d95 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .header-title {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .header-sub {
      margin-top: 2px;
      font-size: 13px;
      color: var(--text-sub);
    }

    /* ë·° ì „í™˜ */

    .view {
      display: none;
      flex-direction: column;
      gap: 16px;
      height: 100%;
    }

    .view.active {
      display: flex;
    }

    /* í™ˆ í™”ë©´ */

    .home-question {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .home-desc {
      font-size: 13px;
      color: #c7d2fe;
      margin-bottom: 14px;
    }

    .tone-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 14px;
    }

    .tone-chip {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.7);
      color: #e5e7ff;
      cursor: pointer;
    }

    .tone-chip.active {
      border-color: #a855f7;
      background: radial-gradient(circle at top left, rgba(168, 85, 247, 0.6), rgba(79, 70, 229, 0.9));
      box-shadow: 0 0 0 1px rgba(165, 180, 252, 0.6);
    }

    .home-menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .home-item {
      border-radius: 18px;
      padding: 12px 14px;
      background: radial-gradient(circle at top left,
        rgba(79, 70, 229, 0.2) 0,
        rgba(17, 24, 39, 0.98) 50%,
        #020617 100%);
      border: 1px solid rgba(148, 163, 184, 0.45);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .home-item-main {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .home-item-sub {
      font-size: 12px;
      color: #cbd5f5;
    }

    .home-item-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: rgba(55, 65, 81, 0.9);
      color: #e5e7ff;
    }

    .home-item-icon {
      font-size: 20px;
    }

    /* ì…ë ¥ í™”ë©´ */

    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .section-sub {
      font-size: 12px;
      color: #a5b4fc;
      margin-bottom: 10px;
    }

    .field-label {
      font-size: 13px;
      margin-bottom: 6px;
      color: #c7d2fe;
    }

    textarea {
      width: 100%;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-main);
      font-size: 15px;
      padding: 12px 14px;
      outline: none;
      resize: vertical;
      min-height: 110px;
      line-height: 1.5;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.8);
      background: rgba(15, 23, 42, 1);
    }

    .hint {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
      margin-bottom: 14px;
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 20px;
      padding: 13px 16px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, #6366f1, #a855f7);
      box-shadow:
        0 16px 36px rgba(79, 70, 229, 0.8),
        0 0 0 1px rgba(129, 140, 248, 0.6);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 10px 24px rgba(79, 70, 229, 0.75),
        0 0 0 1px rgba(129, 140, 248, 0.6);
    }

    .status-text {
      margin-top: 8px;
      font-size: 12px;
      color: #a5b4fc;
      min-height: 14px;
    }

    /* ê²°ê³¼ í™”ë©´ */

    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .result-title {
      font-size: 18px;
      font-weight: 800;
    }

    .result-sub {
      font-size: 11px;
      color: #c4c6ff;
    }

    .result-message-box {
      margin-top: 10px;
      margin-bottom: 10px;
      padding: 10px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(55, 65, 81, 0.85);
      font-size: 14px;
    }

    .result-message-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    .answers-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }

    .answer-card {
      border-radius: 20px;
      background: radial-gradient(circle at top left,
        rgba(79, 70, 229, 0.27) 0,
        rgba(15, 23, 42, 0.98) 46%,
        rgba(15, 23, 42, 0.98) 100%);
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 11px 12px 12px;
    }

    .answer-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .answer-index {
      font-size: 14px;
      font-weight: 700;
    }

    .answer-text {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.5;
    }

    .answer-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-top: 5px;
      margin-bottom: 6px;
    }

    .tag {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.85);
      background: rgba(15, 23, 42, 0.9);
    }

    .tag-safe {
      border-color: var(--safe);
      color: var(--safe);
    }

    .tag-warn {
      border-color: var(--warn);
      color: var(--warn);
    }

    .tag-danger {
      border-color: var(--danger);
      color: var(--danger);
    }

    .answer-comment {
      margin-top: 4px;
      font-size: 12px;
      color: #e5e7eb;
      padding: 6px 8px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.8);
    }

    .answer-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 6px;
    }

    .chip-btn {
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(79, 70, 229, 0.1);
      color: #e5e7ff;
    }

    .chip-btn.copy {
      background: rgba(79, 70, 229, 0.9);
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.7);
    }

    .chip-btn.fav {
      background: rgba(234, 179, 8, 0.12);
      color: #facc15;
    }

    .chip-btn:active {
      transform: translateY(1px);
      opacity: 0.9;
    }

    .result-buttons-row {
      display: flex;
      gap: 10px;
      margin-top: 6px;
    }

    .btn-secondary {
      flex: 1;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7ff;
      padding: 10px 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary:active {
      transform: translateY(1px);
      background: rgba(30, 64, 175, 0.8);
    }

    /* ìº¡ì²˜ í™”ë©´ */

    .capture-upload {
      border-radius: 18px;
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      font-size: 13px;
      color: #e5e7ff;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .capture-preview {
      margin-top: 8px;
      max-height: 200px;
      border-radius: 14px;
      overflow: hidden;
    }

    .capture-preview img {
      width: 100%;
      display: block;
    }

    /* ì¦ê²¨ì°¾ê¸° */

    .empty-text {
      font-size: 13px;
      color: #9ca3af;
      padding: 8px 2px;
    }

    /* í•˜ë‹¨ íƒ­ ë„¤ë¹„ */

    .tab-bar {
      background: var(--nav-bg);
      border-top: 1px solid rgba(30, 64, 175, 0.7);
      padding: 8px 10px calc(8px + env(safe-area-inset-bottom, 0px));
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .tab-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
      padding: 6px 4px;
      border-radius: 14px;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .tab-item.active {
      background: radial-gradient(circle at top, rgba(129, 140, 248, 0.25), rgba(15, 23, 42, 1));
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.6);
      transform: translateY(-1px);
    }

    .tab-icon {
      font-size: 18px;
    }

    .tab-label {
      font-size: 13px;
      font-weight: 600;
      color: #e5e7ff;
    }

    @media (max-height: 700px) {
      .app-inner {
        padding-top: 14px;
      }
      .header {
        margin-bottom: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-inner">
      <header class="header">
        <div class="header-icon">
          <div class="header-icon-inner">ğŸ’¬</div>
        </div>
        <div>
          <div class="header-title">AI ëŒ€í™” ì½”ì¹˜</div>
          <div class="header-sub">ì¹´í†¡ ë‹µì¥, ê°™ì´ ìƒê°í•´ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</div>
        </div>
      </header>

      <!-- ë·°: í™ˆ -->
      <section id="view-home" class="view active">
        <section class="card">
          <div class="home-question">ì˜¤ëŠ˜ì€ ì–´ë””ë¶€í„° ë„ì™€ë“œë¦´ê¹Œìš”?</div>
          <div class="home-desc">ìƒí™©ì— ë§ëŠ” ë‹µì¥, ë‚´ ë§íˆ¬ ë°˜ì˜, ìì£¼ ì“°ëŠ” ë‹µì¥ ì €ì¥ê¹Œì§€ í•œ ë²ˆì—.</div>

          <div class="tone-chips" id="toneChips">
            <button class="tone-chip active" data-tone="ê¸°ë³¸">ê¸°ë³¸</button>
            <button class="tone-chip" data-tone="ì—°ì• ">ì—°ì• </button>
            <button class="tone-chip" data-tone="ì¸">ì¸</button>
            <button class="tone-chip" data-tone="ì¹œêµ¬">ì¹œêµ¬</button>
            <button class="tone-chip" data-tone="ì§ì¥">ì§ì¥</button>
            <button class="tone-chip" data-tone="ê°€ì¡±">ê°€ì¡±</button>
          </div>

          <div class="home-menu">
            <div class="home-item" data-goto="view-input">
              <div>
                <div class="home-item-main">1. AIê°€ ì¹´í†¡ ë‹µì¥ ë§Œë“¤ì–´ì£¼ê¸°</div>
                <div class="home-item-sub">ìƒëŒ€ê°€ ë³´ë‚¸ ë©”ì‹œì§€ â†’ ë”± ë§ëŠ” ë‹µì¥ 3ê°œ ì¶”ì²œ</div>
              </div>
              <div class="home-item-pill">ë°”ë¡œ ì‹œì‘</div>
            </div>

            <div class="home-item" data-goto="view-my-style">
              <div>
                <div class="home-item-main">2. ë‚´ ë§íˆ¬ í•™ìŠµì‹œí‚¤ê¸°</div>
                <div class="home-item-sub">ìì£¼ ì“°ëŠ” í‘œí˜„, ë§íˆ¬ ì˜ˆì‹œë¥¼ ì €ì¥í•´ ë‘˜ ìˆ˜ ìˆì–´ìš”.</div>
              </div>
              <div class="home-item-icon">âœï¸</div>
            </div>

            <div class="home-item" data-goto="view-favorites">
              <div>
                <div class="home-item-main">3. ì¦ê²¨ì°¾ê¸° ë‹µì¥ ëª¨ì•„ë³´ê¸°</div>
                <div class="home-item-sub">ë§ˆìŒì— ë“¤ì—ˆë˜ ë‹µì¥ì„ ë‹¤ì‹œ êº¼ë‚´ ì“¸ ìˆ˜ ìˆì–´ìš”.</div>
              </div>
              <div class="home-item-icon">â­</div>
            </div>

            <div class="home-item" data-goto="view-capture">
              <div>
                <div class="home-item-main">4. ìº¡ì²˜ë¡œ ë‹µì¥ ë§Œë“¤ê¸°</div>
                <div class="home-item-sub">ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µì¥ì„ ì¶”ì²œí•´ ë“œë ¤ìš”.</div>
              </div>
              <div class="home-item-icon">ğŸ“·</div>
            </div>
          </div>
        </section>
      </section>

      <!-- ë·°: í…ìŠ¤íŠ¸ ì…ë ¥ -->
      <section id="view-input" class="view">
        <section class="card">
          <div class="section-title-row">
            <div>AIê°€ ì¹´í†¡ ë‹µì¥ ë§Œë“¤ì–´ì£¼ê¸°</div>
            <button type="button" class="chip-btn" id="backToHomeFromInput">â† ì²˜ìŒìœ¼ë¡œ</button>
          </div>
          <div class="section-sub">ìƒí™©(ì—°ì• /ì¹œêµ¬/ì§ì¥)ì— ë§ê²Œ ë‹µì¥ í†¤ì„ ë°”ê¿”ë“œë ¤ìš”.</div>

          <div class="field">
            <div class="field-label">ìƒëŒ€ë°© ë©”ì‹œì§€</div>
            <textarea id="messageInput" placeholder="ì˜ˆ) ë‚´ì¼ ë­í•´? ì‹œê°„ ë˜ë©´ ë³´ì :)"></textarea>
          </div>
          <p class="hint">ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ì–´ì£¼ì„¸ìš”.</p>

          <button class="btn-primary" id="generateFromTextBtn">
            <span>AI ì¶”ì²œ ë‹µì¥ ìƒì„±</span>
          </button>
          <div class="status-text" id="inputStatus"></div>
        </section>
      </section>

      <!-- ë·°: ê²°ê³¼ -->
      <section id="view-result" class="view">
        <section class="card">
          <div class="result-header">
            <div>
              <div class="result-title">AI ì¶”ì²œ ë‹µì¥</div>
              <div class="result-sub">ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ëŠ” ê°€ë³ê²Œ ì°¸ê³ ë§Œ í•´ì£¼ì„¸ìš”.</div>
            </div>
            <span class="result-sub" id="resultToneLabel"></span>
          </div>

          <div class="result-message-box">
            <div class="result-message-label">ìƒëŒ€ë°© ë©”ì‹œì§€</div>
            <div id="resultMessageText">-</div>
          </div>

          <div class="status-text" id="resultStatus">AIê°€ ë‹µì¥ì„ ìƒê° ì¤‘ì…ë‹ˆë‹¤...</div>

          <div class="answers-list" id="answersList"></div>

          <div class="result-buttons-row">
            <button type="button" class="btn-secondary" id="regenerateBtn">ë‹¤ì‹œ ìƒì„±í•˜ê¸°</button>
            <button type="button" class="btn-secondary" id="goHomeBtn">ì²˜ìŒìœ¼ë¡œ</button>
          </div>
        </section>
      </section>

      <!-- ë·°: ë‚´ ë§íˆ¬ (ê°„ë‹¨ ë©”ëª¨ìš©) -->
      <section id="view-my-style" class="view">
        <section class="card">
          <div class="section-title-row">
            <div>ë‚´ ë§íˆ¬ í•™ìŠµì‹œí‚¤ê¸°</div>
            <button type="button" class="chip-btn" id="backToHomeFromMyStyle">â† ì²˜ìŒìœ¼ë¡œ</button>
          </div>
          <div class="section-sub">ìì£¼ ì“°ëŠ” í‘œí˜„, ë§íˆ¬ ì˜ˆì‹œë¥¼ ì ì–´ë‘ë©´ ë‹µì¥ ë§Œë“¤ ë•Œ ì°¸ê³ í•  ìˆ˜ ìˆì–´ìš”. (ì´ ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.)</div>
          <textarea id="myStyleText" placeholder="ì˜ˆ) ë‚œ ë§ ëì— ~ë‹¹, ~ì¥¬ë¥¼ ìì£¼ ì¨. / ì¹œêµ¬í•œí…ŒëŠ” ë°˜ë§, ì§ì¥ì—ì„  ì¡´ëŒ“ë§ ìœ„ì£¼ë¡œ ì¨."></textarea>
          <div class="status-text" id="myStyleStatus"></div>
          <button class="btn-secondary" id="saveMyStyleBtn">ë§íˆ¬ ë©”ëª¨ ì €ì¥</button>
        </section>
      </section>

      <!-- ë·°: ì¦ê²¨ì°¾ê¸° -->
      <section id="view-favorites" class="view">
        <section class="card">
          <div class="section-title-row">
            <div>ì¦ê²¨ì°¾ê¸° ë‹µì¥ ëª¨ì•„ë³´ê¸°</div>
            <button type="button" class="chip-btn" id="backToHomeFromFav">â† ì²˜ìŒìœ¼ë¡œ</button>
          </div>
          <div class="section-sub">ë§ˆìŒì— ë“¤ì—ˆë˜ ë‹µì¥ì„ ë‹¤ì‹œ êº¼ë‚´ì„œ ë°”ë¡œ ë³µì‚¬í•´ ì“¸ ìˆ˜ ìˆì–´ìš”.</div>

          <div id="favoritesContainer" class="answers-list"></div>
          <div class="result-buttons-row">
            <button type="button" class="btn-secondary" id="clearFavBtn">ì¦ê²¨ì°¾ê¸° ëª¨ë‘ ì‚­ì œ</button>
          </div>
        </section>
      </section>

      <!-- ë·°: ìº¡ì²˜ ì—…ë¡œë“œ -->
      <section id="view-capture" class="view">
        <section class="card">
          <div class="section-title-row">
            <div>ìº¡ì²˜ë¡œ ë‹µì¥ ë§Œë“¤ê¸°</div>
            <button type="button" class="chip-btn" id="backToHomeFromCapture">â† ì²˜ìŒìœ¼ë¡œ</button>
          </div>
          <div class="section-sub">ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ í•œ ì¥ì„ ì˜¬ë ¤ì£¼ì‹œë©´, ê·¸ ìƒí™©ì— ë§ëŠ” ë‹µì¥ì„ ì¶”ì²œí•´ ë“œë ¤ìš”.</div>

          <div class="capture-upload">
            <label>
              <strong>ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ ì„ íƒ</strong><br />
              <input type="file" id="captureInput" accept="image/*" />
            </label>
            <div class="capture-preview" id="capturePreview" style="display:none;">
              <img id="capturePreviewImg" alt="ìº¡ì²˜ ë¯¸ë¦¬ë³´ê¸°" />
            </div>
          </div>

          <p class="hint">ê°œì¸ì •ë³´ê°€ í¬í•¨ëœ ìº¡ì²˜ëŠ” ê¼­ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì˜ë¼ì„œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.</p>

          <button class="btn-primary" id="generateFromCaptureBtn">
            <span>ìº¡ì²˜ë¡œ AI ì¶”ì²œ ë‹µì¥ ìƒì„±</span>
          </button>
          <div class="status-text" id="captureStatus"></div>
        </section>
      </section>
    </div>

    <!-- í•˜ë‹¨ íƒ­ë°” -->
    <nav class="tab-bar">
      <div class="tab-item active" data-tab="view-home">
        <div class="tab-icon">ğŸ </div>
        <div class="tab-label">í™ˆ</div>
      </div>
      <div class="tab-item" data-tab="view-input">
        <div class="tab-icon">ğŸ’¬</div>
        <div class="tab-label">ë‹µì¥ ë§Œë“¤ê¸°</div>
      </div>
      <div class="tab-item" data-tab="view-my-style">
        <div class="tab-icon">âœï¸</div>
        <div class="tab-label">ë‚´ ë§íˆ¬</div>
      </div>
      <div class="tab-item" data-tab="view-favorites">
        <div class="tab-icon">â­</div>
        <div class="tab-label">ì¦ê²¨ì°¾ê¸°</div>
      </div>
    </nav>
  </div>

  <script>
    const API_BASE = "https://ai-chat-backend-z0jd.onrender.com";

    const views = document.querySelectorAll(".view");
    const tabItems = document.querySelectorAll(".tab-item");
    const toneChips = document.querySelectorAll(".tone-chip");

    const messageInput = document.getElementById("messageInput");
    const inputStatus = document.getElementById("inputStatus");
    const resultToneLabel = document.getElementById("resultToneLabel");
    const resultMessageText = document.getElementById("resultMessageText");
    const resultStatus = document.getElementById("resultStatus");
    const answersList = document.getElementById("answersList");

    const generateFromTextBtn = document.getElementById("generateFromTextBtn");
    const regenerateBtn = document.getElementById("regenerateBtn");
    const goHomeBtn = document.getElementById("goHomeBtn");
    const backToHomeFromInput = document.getElementById("backToHomeFromInput");
    const backToHomeFromMyStyle = document.getElementById("backToHomeFromMyStyle");
    const backToHomeFromFav = document.getElementById("backToHomeFromFav");
    const backToHomeFromCapture = document.getElementById("backToHomeFromCapture");

    const myStyleText = document.getElementById("myStyleText");
    const myStyleStatus = document.getElementById("myStyleStatus");
    const saveMyStyleBtn = document.getElementById("saveMyStyleBtn");
    const favoritesContainer = document.getElementById("favoritesContainer");
    const clearFavBtn = document.getElementById("clearFavBtn");

    const captureInput = document.getElementById("captureInput");
    const capturePreview = document.getElementById("capturePreview");
    const capturePreviewImg = document.getElementById("capturePreviewImg");
    const generateFromCaptureBtn = document.getElementById("generateFromCaptureBtn");
    const captureStatus = document.getElementById("captureStatus");

    let currentTone = "ê¸°ë³¸";
    let currentView = "view-home";
    let lastMessage = "";
    let lastMode = "text"; // "text" | "capture"
    let lastCaptureFile = null;

    // ===== ë·° ì „í™˜ + ë’¤ë¡œê°€ê¸° ì²˜ë¦¬ =====
    function showView(id, pushHistory = true) {
      views.forEach(v => v.classList.toggle("active", v.id === id));
      currentView = id;

      tabItems.forEach(t => {
        const target = t.dataset.tab;
        t.classList.toggle("active", target === id || (id === "view-result" && target === "view-input") || (id === "view-capture" && target === "view-input"));
      });

      if (pushHistory) {
        history.pushState({ viewId: id }, "", "#" + id);
      }
    }

    window.addEventListener("popstate", (e) => {
      const viewId = e.state && e.state.viewId ? e.state.viewId : "view-home";
      showView(viewId, false);
    });

    // ì´ˆê¸° ìƒíƒœ push
    history.replaceState({ viewId: "view-home" }, "", "#view-home");

    // í™ˆ ì¹´ë“œ í´ë¦­
    document.querySelectorAll(".home-item").forEach(item => {
      item.addEventListener("click", () => {
        const target = item.getAttribute("data-goto");
        if (target) showView(target);
      });
    });

    // íƒ­ í´ë¦­
    tabItems.forEach(tab => {
      tab.addEventListener("click", () => {
        const target = tab.dataset.tab;
        if (target) showView(target);
      });
    });

    // ìƒë‹¨ 'ì²˜ìŒìœ¼ë¡œ' ë²„íŠ¼ë“¤
    backToHomeFromInput.onclick = () => showView("view-home");
    backToHomeFromMyStyle.onclick = () => showView("view-home");
    backToHomeFromFav.onclick = () => showView("view-home");
    backToHomeFromCapture.onclick = () => showView("view-home");

    // ===== í†¤ ì„ íƒ =====
    toneChips.forEach(chip => {
      chip.addEventListener("click", () => {
        toneChips.forEach(c => c.classList.remove("active"));
        chip.classList.add("active");
        currentTone = chip.dataset.tone || "ê¸°ë³¸";
      });
    });

    // ===== ì‘ë‹µ íŒŒì‹± & ë Œë”ë§ =====
    function parseLine(line) {
      const parts = line.split("||").map(p => p.trim());
      return {
        text: parts[0] || "",
        risk: parts[1] || "",
        sense: parts[2] || "",
        comment: parts[3] || ""
      };
    }

    function riskClass(risk) {
      const n = parseInt(risk, 10);
      if (isNaN(n)) return "";
      if (n <= 30) return "tag-safe";
      if (n <= 60) return "tag-warn";
      return "tag-danger";
    }

    function addToFavorites(item) {
      const stored = JSON.parse(localStorage.getItem("ai_reply_favs") || "[]");
      stored.push(item);
      localStorage.setItem("ai_reply_favs", JSON.stringify(stored));
      renderFavorites();
    }

    function renderFavorites() {
      const stored = JSON.parse(localStorage.getItem("ai_reply_favs") || "[]");
      favoritesContainer.innerHTML = "";
      if (!stored.length) {
        favoritesContainer.innerHTML = '<div class="empty-text">ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŒì— ë“œëŠ” ë‹µì¥ì—ì„œ â­ ì¦ê²¨ì°¾ê¸°ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.</div>';
        return;
      }
      stored.forEach((item, idx) => {
        const card = document.createElement("div");
        card.className = "answer-card";
        card.innerHTML = `
          <div class="answer-top-row">
            <div class="answer-index">${idx + 1}. ì¦ê²¨ì°¾ê¸° ë‹µì¥</div>
          </div>
          <div class="answer-text">${item.text}</div>
          <div class="answer-meta">
            ${item.risk ? `<span class="tag ${riskClass(item.risk)}">ìœ„í—˜ë„ ${item.risk}</span>` : ""}
            ${item.sense ? `<span class="tag">ì„¼ìŠ¤ ${item.sense}</span>` : ""}
          </div>
          ${item.comment ? `<div class="answer-comment">${item.comment}</div>` : ""}
          <div class="answer-actions">
            <button type="button" class="chip-btn copy">ë³µì‚¬</button>
          </div>
        `;
        card.querySelector(".chip-btn.copy").addEventListener("click", () => {
          navigator.clipboard.writeText(item.text).then(() => {
            const btn = card.querySelector(".chip-btn.copy");
            const old = btn.textContent;
            btn.textContent = "ë³µì‚¬ë¨";
            setTimeout(() => btn.textContent = old, 1200);
          });
        });
        favoritesContainer.appendChild(card);
      });
    }

    function renderAnswers(replyString) {
      answersList.innerHTML = "";
      const lines = replyString.split("\n").map(l => l.trim()).filter(Boolean).slice(0, 3);

      if (!lines.length) {
        resultStatus.textContent = "ì¶”ì²œ ë‹µì¥ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        return;
      }

      resultStatus.textContent = "";

      lines.forEach((line, idx) => {
        const { text, risk, sense, comment } = parseLine(line);
        const card = document.createElement("div");
        card.className = "answer-card";

        card.innerHTML = `
          <div class="answer-top-row">
            <div class="answer-index">${idx + 1}. </div>
            <div class="answer-text">${text}</div>
          </div>
          <div class="answer-meta">
            ${risk ? `<span class="tag ${riskClass(risk)}">ìœ„í—˜ë„ ${risk}</span>` : ""}
            ${sense ? `<span class="tag">ì„¼ìŠ¤ ${sense}</span>` : ""}
          </div>
          ${comment ? `<div class="answer-comment">${comment}</div>` : ""}
          <div class="answer-actions">
            <button type="button" class="chip-btn fav">â­ ì¦ê²¨ì°¾ê¸°</button>
            <button type="button" class="chip-btn copy">ë³µì‚¬</button>
          </div>
        `;

        const copyBtn = card.querySelector(".chip-btn.copy");
        const favBtn = card.querySelector(".chip-btn.fav");

        copyBtn.addEventListener("click", () => {
          navigator.clipboard.writeText(text).then(() => {
            const old = copyBtn.textContent;
            copyBtn.textContent = "ë³µì‚¬ë¨";
            setTimeout(() => copyBtn.textContent = old, 1200);
          });
        });

        favBtn.addEventListener("click", () => {
          addToFavorites({ text, risk, sense, comment });
          const old = favBtn.textContent;
          favBtn.textContent = "ì¶”ê°€ë¨";
          setTimeout(() => favBtn.textContent = old, 1200);
        });

        answersList.appendChild(card);
      });
    }

    // ===== API í˜¸ì¶œ =====
    async function fetchRepliesFromText(message, tone) {
      const res = await fetch(API_BASE + "/reply", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: message, tone })
      });
      if (!res.ok) throw new Error("API ì˜¤ë¥˜");
      const data = await res.json();
      return data.reply || "";
    }

    async function fetchRepliesFromCapture(file, tone) {
      const form = new FormData();
      form.append("image", file);
      form.append("tone", tone || "ê¸°ë³¸");
      const res = await fetch(API_BASE + "/capture-reply", {
        method: "POST",
        body: form
      });
      if (!res.ok) throw new Error("API ì˜¤ë¥˜");
      const data = await res.json();
      return data.reply || "";
    }

    // ===== í…ìŠ¤íŠ¸ì—ì„œ ìƒì„± =====
    generateFromTextBtn.addEventListener("click", async () => {
      const text = messageInput.value.trim();
      if (!text) {
        inputStatus.textContent = "ë¨¼ì € ìƒëŒ€ë°© ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        return;
      }

      lastMessage = text;
      lastMode = "text";

      resultMessageText.textContent = text;
      resultToneLabel.textContent = `ìƒí™©: ${currentTone}`;
      resultStatus.textContent = "AIê°€ ë‹µì¥ì„ ìƒê° ì¤‘ì…ë‹ˆë‹¤...";
      answersList.innerHTML = "";
      inputStatus.textContent = "";

      showView("view-result");

      try {
        const replyStr = await fetchRepliesFromText(text, currentTone);
        renderAnswers(replyStr);
      } catch (e) {
        console.error(e);
        resultStatus.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
      }
    });

    // ë‹¤ì‹œ ìƒì„±í•˜ê¸°
    regenerateBtn.addEventListener("click", async () => {
      if (!lastMessage) return;
      resultStatus.textContent = "AIê°€ ìƒˆë¡œìš´ ë‹µì¥ì„ ìƒê° ì¤‘ì…ë‹ˆë‹¤...";
      answersList.innerHTML = "";
      try {
        let replyStr;
        if (lastMode === "text") {
          replyStr = await fetchRepliesFromText(lastMessage, currentTone);
        } else if (lastMode === "capture" && lastCaptureFile) {
          replyStr = await fetchRepliesFromCapture(lastCaptureFile, currentTone);
        }
        renderAnswers(replyStr);
      } catch (e) {
        console.error(e);
        resultStatus.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    });

    goHomeBtn.addEventListener("click", () => showView("view-home"));

    // ===== ë§íˆ¬ ë©”ëª¨ ì €ì¥ =====
    function loadMyStyle() {
      const saved = localStorage.getItem("ai_reply_mystyle") || "";
      myStyleText.value = saved;
    }

    saveMyStyleBtn.addEventListener("click", () => {
      localStorage.setItem("ai_reply_mystyle", myStyleText.value || "");
      myStyleStatus.textContent = "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë¼ìš”)";
      setTimeout(() => myStyleStatus.textContent = "", 2000);
    });

    // ===== ì¦ê²¨ì°¾ê¸° ì‚­ì œ =====
    clearFavBtn.addEventListener("click", () => {
      if (confirm("ì¦ê²¨ì°¾ê¸°í•œ ëª¨ë“  ë‹µì¥ì„ ì‚­ì œí• ê¹Œìš”?")) {
        localStorage.removeItem("ai_reply_favs");
        renderFavorites();
      }
    });

    // ===== ìº¡ì²˜ ì—…ë¡œë“œ =====
    captureInput.addEventListener("change", () => {
      const file = captureInput.files && captureInput.files[0];
      lastCaptureFile = file || null;
      if (file) {
        const url = URL.createObjectURL(file);
        capturePreviewImg.src = url;
        capturePreview.style.display = "block";
      } else {
        capturePreview.style.display = "none";
      }
    });

    generateFromCaptureBtn.addEventListener("click", async () => {
      if (!captureInput.files || !captureInput.files[0]) {
        captureStatus.textContent = "ë¨¼ì € ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
        return;
      }
      const file = captureInput.files[0];
      lastCaptureFile = file;
      lastMode = "capture";
      lastMessage = "(ìº¡ì²˜ ì´ë¯¸ì§€ ê¸°ë°˜)";

      resultMessageText.textContent = "ìº¡ì²˜ ì´ë¯¸ì§€ ê¸°ë°˜ìœ¼ë¡œ ë‹µì¥ì„ ìƒì„±í–ˆì–´ìš”.";
      resultToneLabel.textContent = `ìƒí™©: ${currentTone}`;
      resultStatus.textContent = "AIê°€ ìº¡ì²˜ ë‚´ìš©ì„ ì½ê³  ë‹µì¥ì„ ìƒê° ì¤‘ì…ë‹ˆë‹¤...";
      answersList.innerHTML = "";
      captureStatus.textContent = "";

      showView("view-result");

      try {
        const replyStr = await fetchRepliesFromCapture(file, currentTone);
        renderAnswers(replyStr);
      } catch (e) {
        console.error(e);
        resultStatus.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
      }
    });

    // ì´ˆê¸° ë¡œë”© ì‹œ
    loadMyStyle();
    renderFavorites();
  </script>
</body>
</html>
