<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ëŒ€í™” ì½”ì¹˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="manifest" href="/manifest.json" />

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --card-bg: rgba(8, 12, 32, 0.96);
      --text-main: #f9fafb;
      --text-sub: #a5b4fc;
      --border: rgba(148, 163, 184, 0.35);
      --safe: #22c55e;
      --warn: #eab308;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html, body { height: 100%; }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #4c1d95 0, rgba(76, 29, 149, 0.25) 18%, transparent 35%),
        radial-gradient(circle at bottom, #0b1120 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: calc(32px + env(safe-area-inset-top, 0px)) 16px 40px;
      -webkit-text-size-adjust: 100%;
    }

    .app { width: 100%; max-width: 480px; }

    .card {
      background: var(--card-bg);
      border-radius: 28px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 20px 18px 70px; /* ì•„ë˜ìª½ì— ë„¤ë¹„ê²Œì´ì…˜ ê³µê°„ */
      box-shadow:
        0 26px 60px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(18px);
      position: relative;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 12px;
    }

    .header-icon {
      width: 42px;
      height: 42px;
      border-radius: 18px;
      padding: 2px;
      background: radial-gradient(circle at 30% 20%, #9f8cff 0, #4c1d95 45%, #111827 100%);
      box-shadow:
        0 8px 18px rgba(79, 70, 229, 0.9),
        0 0 0 1px rgba(30, 64, 175, 0.45);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 14px;
    }

    .header-text-main {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .header-text-sub {
      margin-top: 4px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .screen { display: none; }
    .screen.active { display: block; }

    .status-text {
      font-size: 13px;
      color: #a5b4fc;
      min-height: 18px;
      margin-top: 6px;
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 20px;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      box-shadow:
        0 18px 38px rgba(79, 70, 229, 0.85),
        0 0 0 1px rgba(129, 140, 248, 0.7);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 18px;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 10px 26px rgba(79, 70, 229, 0.75),
        0 0 0 1px rgba(129, 140, 248, 0.7);
    }

    .btn-outline {
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.7);
      background: transparent;
      color: #e5e7ff;
      font-size: 14px;
      padding: 10px 0;
      cursor: pointer;
      width: 100%;
    }

    .btn-outline:active {
      transform: translateY(1px);
      background: rgba(15,23,42,0.85);
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      font-size: 11px;
      color: #c7d2fe;
      background: rgba(15,23,42,0.9);
      margin-right: 4px;
    }

    .home-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .home-sub {
      font-size: 13px;
      color: #a5b4fc;
      margin-bottom: 16px;
    }

    .home-menu {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .home-menu-btn {
      width: 100%;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7ff;
      font-size: 14px;
      text-align: left;
      padding: 10px 12px;
      cursor: pointer;
    }

    .home-menu-btn strong { display: block; font-size: 15px; margin-bottom: 3px; }

    /* ê³µí†µ ìƒë‹¨ ë°” */

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .back-btn {
      border: none;
      background: none;
      color: #e5e7ff;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 3px;
      cursor: pointer;
      padding: 4px 0;
    }

    .back-btn span.arrow {
      font-size: 16px;
      transform: translateY(1px);
    }

    .tone-chip-current {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      color: #c7d2fe;
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    /* ===== í†¤ ì„ íƒ ===== */
    .tone-title-main {
      margin-top: 8px;
      font-size: 17px;
      font-weight: 700;
    }

    .tone-title-sub {
      margin-top: 8px;
      font-size: 14px;
    }

    .tone-desc {
      margin-top: 4px;
      font-size: 12px;
      color: #a5b4fc;
    }

    .tone-grid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .tone-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-main);
      padding: 10px 10px;
      font-size: 14px;
      text-align: center;
      cursor: pointer;
    }

    .tone-btn.selected {
      border-color: #a5b4fc;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.6);
      background: radial-gradient(circle at top, rgba(79,70,229,0.55), rgba(15,23,42,0.98));
    }

    .tone-hint {
      margin-top: 8px;
      font-size: 12px;
      color: #94a3b8;
    }

    /* ===== ë©”ì‹œì§€ ì…ë ¥ ===== */
    .subtitle-bar {
      margin-top: 4px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, #4f46e5, #a855f7, #22c55e);
      background-size: 200% 100%;
      animation: slideBar 1.4s linear infinite;
    }

    @keyframes slideBar {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    .subtitle-sub {
      margin-top: 10px;
      font-size: 13px;
      color: #a5b4fc;
    }

    .field-label {
      font-size: 14px;
      margin-top: 14px;
      margin-bottom: 6px;
      color: #c7d2fe;
    }

    .textarea-wrap { position: relative; }

    textarea {
      width: 100%;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-main);
      font-size: 16px;
      padding: 12px 14px;
      min-height: 80px;
      line-height: 1.5;
      resize: vertical;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.75);
      background: rgba(15, 23, 42, 1);
    }

    .hint {
      font-size: 13px;
      color: #94a3b8;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    /* ===== ê²°ê³¼ ===== */
    .result-wrapper {
      margin-top: 8px;
      border-radius: 22px;
      background:
        radial-gradient(circle at top, rgba(79, 70, 229, 0.25) 0, rgba(15, 23, 42, 0.98) 55%);
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 14px 12px 12px;
    }

    .result-header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 10px;
    }

    .result-header-title {
      font-size: 15px;
      font-weight: 700;
    }

    .result-header-sub {
      font-size: 12px;
      color: #cbd5f5;
      margin-top: 2px;
    }

    .result-header-right {
      font-size: 12px;
      color: #a5b4fc;
      white-space: nowrap;
      text-align: right;
    }

    .original-box {
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 10px 10px 8px;
      margin-bottom: 10px;
      background: rgba(15,23,42,0.96);
    }

    .original-label {
      font-size: 13px;
      color: #c7d2fe;
      margin-bottom: 4px;
    }

    .original-text { font-size: 14px; }

    .answer-item {
      padding: 9px 9px 10px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.9);
      margin-top: 8px;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.9);
    }

    .answer-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .answer-text {
      font-size: 15px;
      flex: 1;
      padding-right: 4px;
    }

    .chips {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 2px;
      font-size: 12px;
    }

    .chip {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
    }

    .chip.score { white-space: nowrap; }

    .chip.safe {
      border-color: var(--safe);
      color: var(--safe);
      background: rgba(34, 197, 94, 0.12);
    }

    .chip.warn {
      border-color: var(--warn);
      color: var(--warn);
      background: rgba(234, 179, 8, 0.12);
    }

    .chip.danger {
      border-color: var(--danger);
      color: var(--danger);
      background: rgba(239, 68, 68, 0.12);
    }

    .copy-btn {
      border-radius: 999px;
      border: none;
      padding: 5px 10px;
      font-size: 13px;
      background: rgba(79, 70, 229, 0.96);
      color: #e5e7ff;
      cursor: pointer;
      white-space: nowrap;
    }

    .copy-btn:active {
      transform: translateY(1px);
      background: rgba(79, 70, 229, 1);
    }

    .fav-btn {
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.4);
      background: rgba(15, 23, 42, 0.8);
      color: #facc15;
      font-size: 13px;
      padding: 4px 10px;
      cursor: pointer;
      margin-right: 4px;
      display: inline-flex;
      align-items: center;
      gap: 3px;
      white-space: nowrap;
    }

    .fav-btn.active {
      background: rgba(250, 204, 21, 0.2);
      border-color: #facc15;
    }

    /* ì¦ê²¨ì°¾ê¸° ë¦¬ìŠ¤íŠ¸ */

    .favorites-list {
      margin-top: 8px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.85);
      max-height: 260px;
      overflow-y: auto;
      padding: 8px 10px;
      font-size: 13px;
    }

    .fav-item {
      border-bottom: 1px solid rgba(51,65,85,0.7);
      padding: 6px 0;
    }

    .fav-item:last-child { border-bottom: none; }

    .fav-meta {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .favorites-empty {
      font-size: 12px;
      color: #9ca3af;
    }

    /* ìŠ¤ì¼ˆë ˆí†¤ */

    .skeleton-item {
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.85);
      margin-top: 8px;
      padding: 10px;
      overflow: hidden;
    }

    .skeleton-line {
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(
        110deg,
        rgba(148, 163, 184, 0.25) 8%,
        rgba(148, 163, 184, 0.45) 18%,
        rgba(148, 163, 184, 0.18) 33%
      );
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
      margin-bottom: 6px;
    }

    .skeleton-line.short { width: 40%; }
    .skeleton-line.mid   { width: 65%; }
    .skeleton-line.long  { width: 90%; }

    @keyframes shimmer {
      0% { background-position: -150% 0; }
      100% { background-position: 150% 0; }
    }

    /* ë‚´ ë§íˆ¬ / ìº¡ì²˜ ì„¤ëª… */

    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .section-sub {
      font-size: 13px;
      color: #a5b4fc;
      margin-bottom: 8px;
    }

    .section-body {
      font-size: 13px;
      color: #e5e7ff;
    }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */

    .nav-bottom {
      position: absolute;
      left: 14px;
      right: 14px;
      bottom: 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.95);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 6px 8px;
      font-size: 11px;
      color: #9ca3af;
    }

    .nav-item {
      flex: 1;
      text-align: center;
      cursor: pointer;
      padding: 4px 0;
      border-radius: 999px;
    }

    .nav-item span.icon {
      display: block;
      font-size: 15px;
      margin-bottom: 2px;
    }

    .nav-item.active {
      background: rgba(79,70,229,0.3);
      color: #e5e7ff;
    }

    @media (max-height: 680px) {
      body {
        align-items: flex-start;
        padding-top: 20px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="card">
      <!-- ===== í™ˆ í™”ë©´ ===== -->
      <section class="screen active" id="screen-home">
        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">AI ëŒ€í™” ì½”ì¹˜</div>
            <div class="header-text-sub">ì¹´í†¡ ë‹µì¥, ê°™ì´ ìƒê°í•´ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</div>
          </div>
        </header>

        <div class="home-title">ì˜¤ëŠ˜ì€ ì–´ë””ë¶€í„° ë„ì™€ë“œë¦´ê¹Œìš”?</div>
        <p class="home-sub">
          ìƒí™©ì— ë§ëŠ” ë‹µì¥, ë‚´ ë§íˆ¬ ë°˜ì˜, ìì£¼ ì“°ëŠ” ë‹µì¥ ì €ì¥ê¹Œì§€ í•œ ë²ˆì—.
        </p>

        <div>
          <span class="tag">ì¹´í†¡ ë‹µì¥</span>
          <span class="tag">ì—°ì•  / ì¹œêµ¬ / ì§ì¥</span>
        </div>

        <div class="home-menu">
          <button class="home-menu-btn" data-screen-target="screen-compose">
            <strong>1. AIê°€ ì¹´í†¡ ë‹µì¥ ë§Œë“¤ì–´ì£¼ê¸°</strong>
            <span>ìƒí™© ì„ íƒ â†’ ë©”ì‹œì§€ ì…ë ¥ â†’ ë‹µì¥ 3ê°œ ì¶”ì²œ</span>
          </button>
          <button class="home-menu-btn" data-screen-target="screen-style">
            <strong>2. ë‚´ ë§íˆ¬ í•™ìŠµì‹œí‚¤ê¸°</strong>
            <span>ìì£¼ ì“°ëŠ” í‘œí˜„, ë§íˆ¬ ì˜ˆì‹œë¥¼ ì €ì¥í•´ ë†“ì„ ìˆ˜ ìˆì–´ìš”.</span>
          </button>
          <button class="home-menu-btn" data-screen-target="screen-favorites">
            <strong>3. ì¦ê²¨ì°¾ê¸° ë‹µì¥ ëª¨ì•„ë³´ê¸°</strong>
            <span>ë§ˆìŒì— ë“¤ì—ˆë˜ ë‹µì¥ì„ ë‹¤ì‹œ êº¼ë‚´ ì“¸ ìˆ˜ ìˆì–´ìš”.</span>
          </button>
          <button class="home-menu-btn" data-screen-target="screen-capture">
            <strong>4. ìº¡ì²˜ë¡œ ë‹µì¥ ë§Œë“¤ê¸° (ì¤€ë¹„ ì¤‘)</strong>
            <span>ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µì¥ì„ ì¶”ì²œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</span>
          </button>
        </div>
      </section>

      <!-- ===== í†¤ ì„ íƒ + ë©”ì‹œì§€ ì…ë ¥ ===== -->
      <section class="screen" id="screen-compose-tone">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-home" type="button">
            <span class="arrow">â†</span><span>í™ˆìœ¼ë¡œ</span>
          </button>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">ìƒí™© ì„ íƒ</div>
            <div class="header-text-sub">
              ì§€ê¸ˆ ì–´ë–¤ ìƒí™©ì˜ ëŒ€í™”ì¸ê°€ìš”?
            </div>
          </div>
        </header>

        <div class="tone-title-main">ì–´ë–¤ ìƒí™©ì˜ ë‹µì¥ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
        <p class="tone-title-sub">ìƒí™©ì— ë”°ë¼ í†¤ì„ ë‹¤ë¥´ê²Œ ì¶”ì²œí•´ë“œë ¤ìš”.</p>
        <p class="tone-desc">ê°€ì¥ ê°€ê¹Œìš´ ìƒí™©ì„ ê³¨ë¼ ì£¼ì„¸ìš”.</p>

        <div class="tone-grid" id="toneGrid">
          <button type="button" class="tone-btn" data-tone="ì—°ì• ">ì—°ì• </button>
          <button type="button" class="tone-btn" data-tone="ì¸">ì¸</button>
          <button type="button" class="tone-btn" data-tone="ì¹œêµ¬">ì¹œêµ¬</button>
          <button type="button" class="tone-btn" data-tone="ì§ì¥">ì§ì¥</button>
          <button type="button" class="tone-btn" data-tone="ê°€ì¡±">ê°€ì¡±</button>
          <button type="button" class="tone-btn" data-tone="ê¸°íƒ€">ê¸°íƒ€</button>
        </div>

        <p class="tone-hint">ë‚˜ì¤‘ì— ì–¸ì œë“ ì§€ ìƒí™©ì„ ë‹¤ì‹œ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.</p>

        <button class="btn-primary" id="toComposeInputBtn" type="button">
          ë‹¤ìŒ (ë©”ì‹œì§€ ì…ë ¥í•˜ê¸°)
        </button>
        <div class="status-text" id="statusTone"></div>
      </section>

      <section class="screen" id="screen-compose">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-compose-tone" type="button">
            <span class="arrow">â†</span><span>ìƒí™© ë‹¤ì‹œ ì„ íƒ</span>
          </button>
          <div class="tone-chip-current" id="toneChip">ì¹œêµ¬ í†¤</div>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">AI ì¶”ì²œ ë‹µì¥</div>
            <div class="header-text-sub" id="inputSubtitle">
              ìƒëŒ€ë°© í†¡ì„ ë¶™ì—¬ ë„£ìœ¼ë©´, ë‹µì¥ì„ 3ê°€ì§€ë¡œ ì¶”ì²œí•´ë“œë ¤ìš”
            </div>
          </div>
        </header>

        <div class="subtitle-bar"></div>
        <p class="subtitle-sub">
          ë„ˆë¬´ ê¸¸ê²Œ ì“°ì§€ ì•Šìœ¼ì…”ë„ ê´œì°®ì•„ìš”. í•µì‹¬ ëŒ€í™”ë§Œ ë„£ì–´ì£¼ì…”ë„ ì´í•´í•©ë‹ˆë‹¤.
        </p>

        <div class="field-label">ìƒëŒ€ë°© ë©”ì‹œì§€</div>
        <div class="textarea-wrap">
          <textarea id="message" placeholder="ì˜ˆ) ë‚´ì¼ ë­í•´?"></textarea>
        </div>
        <p class="hint">ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ì–´ì£¼ì„¸ìš”.</p>

        <button class="btn-primary" id="generateBtn" type="button">
          AI ì¶”ì²œ ë‹µì¥ ìƒì„±
        </button>
        <div class="status-text" id="statusReply"></div>
      </section>

      <!-- ===== ê²°ê³¼ í™”ë©´ ===== -->
      <section class="screen" id="screen-result">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-compose" type="button">
            <span class="arrow">â†</span><span>ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</span>
          </button>
          <div class="tone-chip-current" id="toneChipResult">ì¹œêµ¬ í†¤</div>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">AI ì¶”ì²œ ë‹µì¥</div>
            <div class="header-text-sub" id="resultStatus">
              AIê°€ ë‹µì¥ì„ ë§Œë“œëŠ” ì¤‘ì´ì—ìš”â€¦
            </div>
          </div>
        </header>

        <section class="result-wrapper">
          <div class="result-header-row">
            <div>
              <div class="result-header-title">ì¶”ì²œ ê²°ê³¼</div>
              <div class="result-header-sub">
                ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ëŠ” ê°€ë³ê²Œ ì°¸ê³ ë§Œ í•´ì£¼ì„¸ìš”
              </div>
            </div>
            <div class="result-header-right">
              ìµœëŒ€ 3ê°œê¹Œì§€ ì¶”ì²œ<br />
              ë§ˆìŒì— ë“œëŠ” ë‹µì¥ì€ ì¦ê²¨ì°¾ê¸°!
            </div>
          </div>

          <div class="original-box">
            <div class="original-label">ìƒëŒ€ë°© ë©”ì‹œì§€</div>
            <div class="original-text" id="originalText">-</div>
          </div>

          <div id="answers"></div>

          <div style="margin-top:14px; display:flex; gap:10px;">
            <button class="btn-outline" id="regenerateBtn" type="button">ë‹¤ì‹œ ìƒì„±í•˜ê¸°</button>
            <button class="btn-outline" data-screen-target="screen-home" type="button">í™ˆìœ¼ë¡œ</button>
          </div>
        </section>
      </section>

      <!-- ===== ë‚´ ë§íˆ¬ ê´€ë¦¬ ===== -->
      <section class="screen" id="screen-style">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-home" type="button">
            <span class="arrow">â†</span><span>í™ˆìœ¼ë¡œ</span>
          </button>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">ë‚´ ë§íˆ¬ í•™ìŠµ</div>
            <div class="header-text-sub">
              ìì£¼ ì“°ëŠ” ë§íˆ¬ë¥¼ ì €ì¥í•´ ë‘ë©´, ë‹µì¥ì— ì°¸ê³ í•´ ë“œë¦½ë‹ˆë‹¤.
            </div>
          </div>
        </header>

        <div class="section-title">ë‚´ ë§íˆ¬ ì˜ˆì‹œ ì ì–´ë‘ê¸°</div>
        <p class="section-sub">
          ì˜ˆë¥¼ ë“¤ì–´ ì´ëŸ° ì‹ìœ¼ë¡œ ì—¬ëŸ¬ ì¤„ë¡œ ì ì–´ë‘ë©´ ì¢‹ì•„ìš”.
          <br />ì˜ˆ) ã…‹ã…‹ ìì£¼ ì”€ / ë§ ëì— ~í•¨ / í¸í•œ ë°˜ë§ / ì´ëª¨í‹°ì½˜ ë§ì´ / ã…ã…
        </p>

        <textarea id="styleExamples" placeholder="ìì£¼ ì“°ëŠ” í‘œí˜„, ë§íˆ¬ ì˜ˆì‹œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—¬ëŸ¬ ê°œ ì ì–´ì£¼ì„¸ìš”."></textarea>
        <button type="button" id="saveStyleBtn" class="btn-primary" style="margin-top:10px;">
          ë§íˆ¬ ì €ì¥í•˜ê¸°
        </button>
        <div id="styleStatus" class="status-text"></div>
      </section>

      <!-- ===== ì¦ê²¨ì°¾ê¸° ===== -->
      <section class="screen" id="screen-favorites">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-home" type="button">
            <span class="arrow">â†</span><span>í™ˆìœ¼ë¡œ</span>
          </button>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">ì¦ê²¨ì°¾ê¸° ë‹µì¥</div>
            <div class="header-text-sub">
              ë§ˆìŒì— ë“¤ì–´ì„œ ì €ì¥í•´ë‘” ë‹µì¥ë“¤ì„ í•œ ë²ˆì— ë³¼ ìˆ˜ ìˆì–´ìš”.
            </div>
          </div>
        </header>

        <div class="favorites-list" id="favoritesList"></div>
      </section>

      <!-- ===== ìº¡ì²˜ ì•ˆë‚´ (ì¤€ë¹„ì¤‘) ===== -->
      <section class="screen" id="screen-capture">
        <div class="top-row">
          <button class="back-btn" data-screen-target="screen-home" type="button">
            <span class="arrow">â†</span><span>í™ˆìœ¼ë¡œ</span>
          </button>
        </div>

        <header class="header">
          <div class="header-icon">
            <img src="/icon-192.png" alt="AI ëŒ€í™” ì½”ì¹˜ ì•„ì´ì½˜" />
          </div>
          <div>
            <div class="header-text-main">ìº¡ì²˜ë¡œ ë‹µì¥ (ì¤€ë¹„ ì¤‘)</div>
            <div class="header-text-sub">
              ì¹´í†¡ ëŒ€í™” ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µì¥ì„ ì¶”ì²œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
            </div>
          </div>
        </header>

        <div class="section-title">ê³§ ì¶”ê°€ë  ê¸°ëŠ¥ì´ì—ìš” ğŸš§</div>
        <p class="section-body">
          - ëŒ€í™”ì°½ì„ ìº¡ì²˜í•´ì„œ ì˜¬ë¦¬ë©´, AIê°€ ìƒí™©ì„ ìë™ìœ¼ë¡œ ì½ê³  ë‹µì¥ì„ ì¶”ì²œí•´ ì¤„ ì˜ˆì •ì´ì—ìš”.<br />
          - ìš•ì„¤/ë¯¼ê°í•œ í‘œí˜„ì´ í¬í•¨ëœ ê²½ìš°ì—ë„ ì•ˆì „í•˜ê²Œ í•„í„°ë§í•´ì„œ ë‹µì¥ì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤.<br /><br />
          ìš°ì„ ì€ <strong>í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸° ë°©ì‹</strong>ìœ¼ë¡œ ì‚¬ìš©í•´ ë³´ì‹œê³ ,  
          ì´í›„ ìº¡ì²˜ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ë©´ ì—…ë°ì´íŠ¸ ì•ˆë‚´ë¥¼ ë“œë¦´ê²Œìš”.
        </p>
      </section>

      <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
      <nav class="nav-bottom">
        <div class="nav-item active" data-screen-target="screen-home">
          <span class="icon">ğŸ </span>í™ˆ
        </div>
        <div class="nav-item" data-screen-target="screen-compose-tone">
          <span class="icon">ğŸ’¬</span>ë‹µì¥ ë§Œë“¤ê¸°
        </div>
        <div class="nav-item" data-screen-target="screen-style">
          <span class="icon">âœï¸</span>ë‚´ ë§íˆ¬
        </div>
        <div class="nav-item" data-screen-target="screen-favorites">
          <span class="icon">â­</span>ì¦ê²¨ì°¾ê¸°
        </div>
      </nav>
    </section>
  </main>

  <script>
    const LS_KEYS = {
      STYLE_EXAMPLES: "aiCoach_styleExamples",
      FAVORITES: "aiCoach_favorites"
    };

    // ===== í™”ë©´ ì „í™˜ ê³µí†µ =====
    const screens = Array.from(document.querySelectorAll(".screen"));
    const navItems = Array.from(document.querySelectorAll(".nav-item"));
    const homeMenuButtons = Array.from(document.querySelectorAll(".home-menu-btn"));
    const backButtons = Array.from(document.querySelectorAll(".back-btn"));

    function showScreen(id) {
      screens.forEach(s => s.classList.remove("active"));
      const target = document.getElementById(id);
      if (target) target.classList.add("active");

      navItems.forEach(i => {
        const targetId = i.getAttribute("data-screen-target");
        if (targetId === id) i.classList.add("active");
        else i.classList.remove("active");
      });
    }

    navItems.forEach(i => {
      i.addEventListener("click", () => {
        const target = i.getAttribute("data-screen-target");
        if (target) showScreen(target);
      });
    });

    homeMenuButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-screen-target");
        if (target) showScreen(target);
      });
    });

    backButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-screen-target");
        if (target) showScreen(target);
      });
    });

    // ===== í†¤ ì„ íƒ =====
    const toneButtons = Array.from(document.querySelectorAll(".tone-btn"));
    const statusTone  = document.getElementById("statusTone");
    const toneChip    = document.getElementById("toneChip");
    const toneChipResult = document.getElementById("toneChipResult");
    const toComposeInputBtn = document.getElementById("toComposeInputBtn");

    let selectedTone = "ì¹œêµ¬";

    toneButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        toneButtons.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedTone = btn.dataset.tone || "ì¹œêµ¬";
        statusTone.textContent = "";
      });
    });

    const defaultBtn = toneButtons.find(b => b.dataset.tone === "ì¹œêµ¬") || toneButtons[0];
    if (defaultBtn) {
      defaultBtn.classList.add("selected");
      selectedTone = defaultBtn.dataset.tone;
    }

    toComposeInputBtn.addEventListener("click", () => {
      if (!selectedTone) {
        statusTone.textContent = "ë¨¼ì € ìƒí™©ì„ í•˜ë‚˜ ì„ íƒí•´ ì£¼ì„¸ìš”.";
        return;
      }
      toneChip.textContent = selectedTone + " í†¤";
      showScreen("screen-compose");
      document.getElementById("message").focus();
    });

    // ===== ë‚´ ë§íˆ¬ ê´€ë¦¬ =====
    const styleExamplesEl = document.getElementById("styleExamples");
    const saveStyleBtn = document.getElementById("saveStyleBtn");
    const styleStatus = document.getElementById("styleStatus");

    function loadStyleFromStorage() {
      try {
        const saved = localStorage.getItem(LS_KEYS.STYLE_EXAMPLES);
        if (saved) styleExamplesEl.value = saved;
      } catch (e) {}
    }

    function saveStyleToStorage() {
      const value = styleExamplesEl.value.trim();
      try {
        if (value) {
          localStorage.setItem(LS_KEYS.STYLE_EXAMPLES, value);
          styleStatus.textContent = "ë§íˆ¬ê°€ ì €ì¥ë˜ì—ˆì–´ìš”. ì´í›„ ë‹µì¥ì— ì°¸ê³ í•´ ë³¼ê²Œìš”.";
        } else {
          localStorage.removeItem(LS_KEYS.STYLE_EXAMPLES);
          styleStatus.textContent = "ë§íˆ¬ ì˜ˆì‹œë¥¼ ëª¨ë‘ ì§€ì› ì–´ìš”.";
        }
      } catch (e) {
        styleStatus.textContent = "ë§íˆ¬ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.";
      }
    }

    function getStyleExamples() {
      try {
        return localStorage.getItem(LS_KEYS.STYLE_EXAMPLES) || "";
      } catch (e) {
        return "";
      }
    }

    saveStyleBtn.addEventListener("click", saveStyleToStorage);

    // ===== ì¦ê²¨ì°¾ê¸° ë¡œì§ =====
    const favoritesList = document.getElementById("favoritesList");

    function loadFavorites() {
      try {
        const raw = localStorage.getItem(LS_KEYS.FAVORITES);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function saveFavorites(list) {
      try {
        localStorage.setItem(LS_KEYS.FAVORITES, JSON.stringify(list));
      } catch (e) {}
    }

    function addFavorite(item) {
      const list = loadFavorites();
      list.unshift(item);
      if (list.length > 200) list.pop();
      saveFavorites(list);
    }

    function renderFavorites() {
      const list = loadFavorites();
      favoritesList.innerHTML = "";
      if (list.length === 0) {
        favoritesList.innerHTML = `<div class="favorites-empty">ì•„ì§ ì €ì¥ëœ ì¦ê²¨ì°¾ê¸° ë‹µì¥ì´ ì—†ì–´ìš”.</div>`;
        return;
      }
      list.forEach(f => {
        const div = document.createElement("div");
        div.className = "fav-item";
        div.innerHTML = `
          <div>${f.text}</div>
          <div class="fav-meta">${f.tone || "í†¤ ë¯¸ì§€ì •"} Â· ${f.date || ""}</div>
        `;
        favoritesList.appendChild(div);
      });
    }

    // ì¦ê²¨ì°¾ê¸° í™”ë©´ ì§„ì… ì‹œ í•­ìƒ ìƒˆë¡œ ë Œë”
    document.getElementById("screen-favorites").addEventListener("transitionstart", renderFavorites);
    // (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„  transitionstartê°€ ì•ˆ ë¨¹ì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ ì‹œì—ë„ ë Œë”)
    document.querySelector('[data-screen-target="screen-favorites"]').addEventListener("click", renderFavorites);

    // ===== ê²°ê³¼ í™”ë©´ & ë‹µì¥ ìƒì„± =====
    const msgEl         = document.getElementById("message");
    const generateBtn   = document.getElementById("generateBtn");
    const statusReply   = document.getElementById("statusReply");
    const inputSubtitle = document.getElementById("inputSubtitle");
    const resultStatus  = document.getElementById("resultStatus");
    const originalText  = document.getElementById("originalText");
    const answersEl     = document.getElementById("answers");
    const regenerateBtn = document.getElementById("regenerateBtn");

    function showSkeleton() {
      answersEl.innerHTML = "";
      for (let i = 0; i < 3; i++) {
        const sk = document.createElement("div");
        sk.className = "skeleton-item";
        sk.innerHTML = `
          <div class="skeleton-line long"></div>
          <div class="skeleton-line mid"></div>
          <div class="skeleton-line short"></div>
        `;
        answersEl.appendChild(sk);
      }
    }

    function parseLine(line) {
      const parts = line.split("||").map(p => p.trim());
      return {
        text: parts[0] || "",
        risk: parts[1] || "",
        sense: parts[2] || "",
        comment: parts[3] || ""
      };
    }

    function parseLevel(raw) {
      const s = (raw || "").toString();
      if (s.includes("ë†’ìŒ")) return { level: "ë†’ìŒ", score: "85" };
      if (s.includes("ì¤‘ê°„")) return { level: "ì¤‘ê°„", score: "55" };
      if (s.includes("ë‚®ìŒ")) return { level: "ë‚®ìŒ", score: "25" };

      const n = parseInt(s, 10);
      if (!isNaN(n)) {
        if (n <= 30) return { level: "ë‚®ìŒ", score: String(n) };
        if (n <= 60) return { level: "ì¤‘ê°„", score: String(n) };
        return { level: "ë†’ìŒ", score: String(n) };
      }
      return { level: "ë‚®ìŒ", score: "25" };
    }

    function levelClass(level) {
      if (level === "ë‚®ìŒ") return "safe";
      if (level === "ì¤‘ê°„") return "warn";
      return "danger";
    }

    async function generateReplies(text, tone) {
      try {
        const styleExamples = getStyleExamples();

        const res = await fetch("/reply", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, tone, styleExamples })
        });

        let data = {};
        try {
          data = await res.json();
        } catch (e) {
          data = {};
        }

        if (!res.ok) {
          resultStatus.textContent = data.error || "ë‹µì¥ ìƒì„± ì¤‘ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          answersEl.innerHTML = "";
          console.error("Reply error status:", res.status, data);
          return;
        }

        const replyRaw = (data.reply || "").toString();
        const lines = replyRaw
          .split("\n")
          .map(l => l.trim())
          .filter(Boolean)
          .slice(0, 3);

        if (lines.length === 0) {
          resultStatus.textContent = "ìƒì„±ëœ ë‹µì¥ì´ ì—†ìŠµë‹ˆë‹¤. ë¬¸ì¥ì„ ì¡°ê¸ˆ ë°”ê¿”ì„œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
          answersEl.innerHTML = "";
          return;
        }

        resultStatus.textContent = "AI ì¶”ì²œ ë‹µì¥ì´ ì¤€ë¹„ëì–´ìš”!";
        answersEl.innerHTML = "";

        const now = new Date();
        const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}-${String(now.getDate()).padStart(2,"0")}`;

        lines.forEach((line, idx) => {
          const { text: rawText, risk, sense, comment } = parseLine(line);
          const answerText = rawText.replace(/^\d+\.\s*/, "");

          const riskInfo  = parseLevel(risk);
          const senseInfo = parseLevel(sense);

          const item = document.createElement("div");
          item.className = "answer-item";

          item.innerHTML = `
            <div class="answer-top-row">
              <div class="answer-text">${idx + 1}. ${answerText}</div>
              <button class="fav-btn" type="button">
                <span>â˜…</span><span>ì¦ê²¨ì°¾ê¸°</span>
              </button>
              <button class="copy-btn" type="button">ë³µì‚¬</button>
            </div>
            <div class="chips">
              <span class="chip score ${levelClass(riskInfo.level)}">ìœ„í—˜ë„ ${riskInfo.score}</span>
              <span class="chip score">ì„¼ìŠ¤ ${senseInfo.score}</span>
              ${comment ? `<span class="chip">${comment}</span>` : ""}
            </div>
          `;

          const copyBtn = item.querySelector(".copy-btn");
          const favBtn  = item.querySelector(".fav-btn");

          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(answerText).then(() => {
              copyBtn.textContent = "ë³µì‚¬ë¨";
              setTimeout(() => (copyBtn.textContent = "ë³µì‚¬"), 1200);
            });
          });

          favBtn.addEventListener("click", () => {
            favBtn.classList.add("active");
            favBtn.querySelector("span:last-child").textContent = "ì €ì¥ë¨";
            addFavorite({ text: answerText, tone, date: dateStr });
          });

          answersEl.appendChild(item);
        });
      } catch (err) {
        console.error("Reply fetch error:", err);
        resultStatus.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        answersEl.innerHTML = "";
      } finally {
        inputSubtitle.textContent = "ìƒëŒ€ë°© í†¡ì„ ë¶™ì—¬ ë„£ìœ¼ë©´, ë‹µì¥ì„ 3ê°€ì§€ë¡œ ì¶”ì²œí•´ë“œë ¤ìš”";
        generateBtn.disabled = false;
      }
    }

    function startGenerateFlow() {
      const text = msgEl.value.trim();
      if (!text) {
        statusReply.textContent = "ë¨¼ì € ìƒëŒ€ë°© ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        return;
      }

      statusReply.textContent = "";
      generateBtn.disabled = true;
      inputSubtitle.textContent = "AI ì¶”ì²œ ë‹µì¥ì„ ìƒì„± ì¤‘ì´ì—ìš”â€¦";

      resultStatus.textContent = "AIê°€ ë‹µì¥ì„ ë§Œë“œëŠ” ì¤‘ì´ì—ìš”â€¦";
      originalText.textContent = text;
      answersEl.innerHTML = "";
      toneChipResult.textContent = selectedTone + " í†¤";
      showSkeleton();

      showScreen("screen-result");

      generateReplies(text, selectedTone || "ê¸°ë³¸");
    }

    generateBtn.addEventListener("click", startGenerateFlow);
    regenerateBtn.addEventListener("click", startGenerateFlow);

    // ì´ˆê¸° ë¡œë“œ ì‹œ
    loadStyleFromStorage();
    renderFavorites();
  </script>
</body>
</html>
