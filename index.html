<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ëŒ€í™” ì½”ì¹˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-start: #111827;
      --bg-end: #1f2937;
      --accent: #6366f1;
      --accent-soft: #eef2ff;
      --card-light: #ffffff;
      --card-dark: #020617;
      --text-main: #0f172a;
      --text-sub: #6b7280;
      --safe: #22c55e;
      --warn: #eab308;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #4c6fff55 0, transparent 50%),
        radial-gradient(circle at bottom right, #ec489955 0, transparent 55%),
        linear-gradient(135deg, var(--bg-start), var(--bg-end));
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .page {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
    }

    .screen {
      flex: 1;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .screen.active {
      display: flex;
    }

    .card {
      width: 100%;
      background: var(--card-light);
      border-radius: 24px;
      padding: 22px 18px 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.55);
    }

    .header-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .logo-circle {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background: radial-gradient(circle at top left, #4f46e5, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #ffffff;
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.6);
    }

    .title {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-main);
      letter-spacing: -0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 6px;
      margin-top: 14px;
    }

    select,
    textarea {
      width: 100%;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      font-size: 15px;
      outline: none;
    }

    select:focus,
    textarea:focus {
      border-color: #a5b4fc;
      box-shadow: 0 0 0 1px #c7d2fe;
    }

    textarea {
      resize: vertical;
      min-height: 130px;
    }

    .hint {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 14px 18px;
      background: var(--accent);
      color: #ffffff;
      font-size: 16px;
      font-weight: 700;
      margin-top: 22px;
      cursor: pointer;
    }

    .btn-primary:active {
      filter: brightness(0.95);
    }

    .btn-secondary {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 12px 18px;
      background: transparent;
      color: #e5e7eb;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin-top: 18px;
    }

    /* ê²°ê³¼ í™”ë©´ ì¹´ë“œ */
    .result-card {
      width: 100%;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 24px;
      padding: 20px 16px 18px;
      box-shadow: 0 22px 50px rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .result-title {
      font-size: 20px;
      font-weight: 800;
    }

    .result-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .reply-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .reply-card {
      position: relative;
      display: flex;
      gap: 10px;
    }

    .reply-bar {
      width: 5px;
      border-radius: 999px;
      background: var(--safe);
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .reply-content {
      flex: 1;
      background: #f5f3ff;
      border-radius: 16px;
      padding: 12px 14px 10px;
      color: #111827;
    }

    .reply-text {
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .reply-meta {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #4b5563;
      flex-wrap: wrap;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      color: #111827;
      background: #e5e7eb;
    }

    .badge-safe {
      background: rgba(34, 197, 94, 0.16);
      color: var(--safe);
    }

    .badge-warn {
      background: rgba(234, 179, 8, 0.16);
      color: var(--warn);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.16);
      color: var(--danger);
    }

    .copy-btn {
      margin-left: auto;
      border: none;
      border-radius: 999px;
      background: var(--accent);
      color: #ffffff;
      font-size: 12px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .copy-btn:active {
      opacity: 0.95;
    }
  </style>
</head>
<body>
  <div class="page">

    <!-- ì…ë ¥ í™”ë©´ -->
    <div class="screen active" id="screenInput">
      <div class="card">
        <div class="header-row">
          <div class="logo-circle">ğŸ’¬</div>
          <div>
            <div class="title">AI ëŒ€í™” ì½”ì¹˜</div>
            <div class="subtitle">ì¹´í†¡ ë‹µì¥, ê°™ì´ ìƒê°í•´ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</div>
          </div>
        </div>

        <label for="context">ìƒí™© ì„ íƒ</label>
        <select id="context">
          <option value="basic">ê¸°ë³¸</option>
          <option value="love">ì—°ì• </option>
          <option value="friend">ì¹œêµ¬</option>
          <option value="work">ì§ì¥</option>
          <option value="family">ê°€ì¡±</option>
        </select>

        <label for="message">ìƒëŒ€ë°© ë©”ì‹œì§€</label>
        <textarea
          id="message"
          placeholder="ì˜ˆ) ìš”ì¦˜ ì™œ ì´ë ‡ê²Œ ì—°ë½ì´ ëœ¸í•´?"
        ></textarea>
        <div class="hint">ë‹µì¥ì„ ë§Œë“¤ê³  ì‹¶ì€ ì¹´í†¡ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ì–´ ì£¼ì„¸ìš”.</div>

        <button class="btn-primary" id="generateBtn">ë‹µì¥ ìƒì„±</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="screen" id="screenResult">
      <div class="result-card">
        <div class="result-header">
          <div>
            <div class="result-title">AI ì¶”ì²œ ë‹µì¥</div>
            <div class="result-sub">ìœ„í—˜ë„Â·ì„¼ìŠ¤ ì ìˆ˜ë¥¼ í•¨ê»˜ ì°¸ê³ í•´ ë³´ì„¸ìš”.</div>
          </div>
          <div class="pill">ë² íƒ€ ë²„ì „</div>
        </div>

        <div class="reply-list" id="replyList"></div>

        <button class="btn-secondary" id="backBtn">
          â† ë‹¤ë¥¸ ë©”ì‹œì§€ë¡œ ë‹¤ì‹œ í•´ë³´ê¸°
        </button>
      </div>
    </div>

  </div>

  <script>
    const generateBtn = document.getElementById("generateBtn");
    const contextEl = document.getElementById("context");
    const messageEl = document.getElementById("message");
    const replyListEl = document.getElementById("replyList");
    const screenInput = document.getElementById("screenInput");
    const screenResult = document.getElementById("screenResult");
    const backBtn = document.getElementById("backBtn");

    function showResultScreen() {
      screenInput.classList.remove("active");
      screenResult.classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function showInputScreen() {
      screenResult.classList.remove("active");
      screenInput.classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // ë‹µì¥ ìƒì„± ìš”ì²­
    generateBtn.addEventListener("click", async () => {
      const text = messageEl.value.trim();
      if (!text) {
        alert("ìƒëŒ€ë°© ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        return;
      }

      generateBtn.disabled = true;
      generateBtn.textContent = "ìƒì„± ì¤‘...";

      try {
        const res = await fetch("/reply", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            text,
            context: contextEl.value,
          }),
        });

        const data = await res.json();
        renderReplies(data.reply || "");
        showResultScreen();
      } catch (e) {
        console.error(e);
        alert("ë‹µì¥ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = "ë‹µì¥ ìƒì„±";
      }
    });

    // ê²°ê³¼ â†’ ì…ë ¥ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    backBtn.addEventListener("click", () => {
      showInputScreen();
    });

    // ë°±ì—”ë“œì—ì„œ ì˜¨ ë¬¸ìì—´ì„ íŒŒì‹±í•´ì„œ ì¹´ë“œ ì—¬ëŸ¬ ê°œë¡œ ë§Œë“¤ê¸°
    function renderReplies(raw) {
      replyListEl.innerHTML = "";

      const parsed = parseLegacyReplies(raw);

      if (parsed.length === 0) {
        const empty = document.createElement("div");
        empty.style.color = "#9ca3af";
        empty.style.fontSize = "13px";
        empty.textContent = "ì¶”ì²œ ë‹µì¥ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
        replyListEl.appendChild(empty);
        return;
      }

      parsed.forEach((item) => {
        const card = createReplyCard(item);
        replyListEl.appendChild(card);
      });
    }

    // ì§€ê¸ˆ ë„¤ ë°±ì—”ë“œê°€ ì£¼ëŠ” í˜•ì‹:
    // AI ì¶”ì²œ ë‹µì¥
    // 1. ë¬¸ì¥ë³µì‚¬
    // ìœ„í—˜ë„: 10 / ì„¼ìŠ¤: 80 / ì„¤ëª…: ì–´ì©Œê³ ...
    // 2. ...
    // ì´ëŸ° í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•œë‹¤.
    function parseLegacyReplies(raw) {
      const lines = raw
        .split("\n")
        .map((l) => l.trim())
        .filter((l) => l.length > 0);

      const result = [];

      for (let i = 0; i < lines.length; i++) {
        // "1. ë¬¸ì¥..." í˜•íƒœ ì°¾ê¸°
        const m = lines[i].match(/^(\d+)\.\s*(.+)$/);
        if (!m) continue;

        // ë¬¸ì¥ ë¶€ë¶„
        let text = m[2] || "";
        // ë’¤ì— ë¶™ì€ "ë³µì‚¬" ê¸€ìëŠ” ì œê±°
        text = text.replace(/ë³µì‚¬\s*$/g, "").trim();

        // ë‹¤ìŒ ì¤„ì— "ìœ„í—˜ë„: 10 / ì„¼ìŠ¤: 80 / ì„¤ëª…: ..." ìˆì„ ê²ƒìœ¼ë¡œ ê°€ì •
        let risk = null;
        let sense = null;
        let desc = "";

        if (i + 1 < lines.length) {
          const info = lines[i + 1];
          const rm = info.match(/ìœ„í—˜ë„:\s*(\d+)/);
          const sm = info.match(/ì„¼ìŠ¤:\s*(\d+)/);
          const dm = info.match(/ì„¤ëª…:\s*(.+)$/);

          if (rm) risk = parseInt(rm[1], 10);
          if (sm) sense = parseInt(sm[1], 10);
          if (dm) desc = dm[1].trim();
        }

        result.push({ text, risk, sense, desc });
      }

      return result;
    }

    // ì¹´ë“œ ë§Œë“¤ê¸°
    function createReplyCard(item) {
      const { text, risk, sense, desc } = item;

      let riskLabel = "ìœ„í—˜ë„ ì •ë³´ ì—†ìŒ";
      let riskClass = "";
      if (typeof risk === "number" && !isNaN(risk)) {
        if (risk <= 30) {
          riskLabel = "ìœ„í—˜ë„ ë‚®ìŒ";
          riskClass = "badge-safe";
        } else if (risk <= 60) {
          riskLabel = "ì£¼ì˜ í•„ìš”";
          riskClass = "badge-warn";
        } else {
          riskLabel = "ìœ„í—˜ ê°€ëŠ¥ì„± ë†’ìŒ";
          riskClass = "badge-danger";
        }
      }

      const wrapper = document.createElement("div");
      wrapper.className = "reply-card";

      const bar = document.createElement("div");
      bar.className = "reply-bar";
      if (riskClass === "badge-safe") bar.style.background = "var(--safe)";
      else if (riskClass === "badge-warn") bar.style.background = "var(--warn)";
      else if (riskClass === "badge-danger")
        bar.style.background = "var(--danger)";

      const content = document.createElement("div");
      content.className = "reply-content";

      const textEl = document.createElement("div");
      textEl.className = "reply-text";
      textEl.textContent = text;

      const meta = document.createElement("div");
      meta.className = "reply-meta";

      if (riskClass) {
        const badge = document.createElement("span");
        badge.className = `badge ${riskClass}`;
        badge.textContent = riskLabel;
        meta.appendChild(badge);
      }

      if (typeof sense === "number" && !isNaN(sense)) {
        const senseBadge = document.createElement("span");
        senseBadge.className = "badge";
        senseBadge.textContent = `ì„¼ìŠ¤ ${sense}`;
        meta.appendChild(senseBadge);
      }

      if (desc) {
        const descSpan = document.createElement("span");
        descSpan.textContent = desc;
        meta.appendChild(descSpan);
      }

      const copyBtn = document.createElement("button");
      copyBtn.className = "copy-btn";
      copyBtn.textContent = "ë³µì‚¬";
      copyBtn.addEventListener("click", () => {
        navigator.clipboard
          .writeText(text)
          .then(() => alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."))
          .catch(() => alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."));
      });

      meta.appendChild(copyBtn);

      content.appendChild(textEl);
      content.appendChild(meta);

      wrapper.appendChild(bar);
      wrapper.appendChild(content);

      return wrapper;
    }
  </script>
</body>
</html>















